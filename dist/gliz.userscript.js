// ==UserScript==
// @name         BM ⟐ Gliz
// @version      1.70.5
// @description  A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided "as is" under the MPL-2.0 license. The "Blue Marble" icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.
// @author       GGizzi
// @license      MPL-2.0
// @icon         https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true
// @updateURL    https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @downloadURL  https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @match        https://wplace.live/*
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM.setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @resource     Style-File https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz-style.user.css?vr=1.70.4
// ==/UserScript==

(()=>{function na(b){b=atob(b);const a=new Uint8Array(b.length);for(let c=0;c<b.length;c++)a[c]=b.charCodeAt(c);return a}var ba=(b,a,c)=>{if(a.has(b))throw TypeError("Cannot add the same private member more than once");return a instanceof WeakSet?a.add(b):a.set(b,c)},E=(b,a,c)=>{if(!a.has(b))throw TypeError("Cannot access private method");return c},V=class{constructor(b,a){ba(this,G);this.name=b;this.version=a;this.t=null;this.cb="bgz-o";this.W=this.v=null;this.ma=[]}C(b){this.t=b}j(){return this.ma.length>0&&(this.W=this.ma.pop()),this}p(b){b?.appendChild(this.v);this.W=this.v=null;this.ma=[]}m(b={},a=()=>{}){return a(this,E(this,G,L).call(this,"div",{},b)),this}Y(b={}){E(this,G,L).call(this,"p",{},b);return this}bb(){E(this,G,L).call(this,"small",{},{textContent:"By GGizzi \u2022 SwingTheVine",style:"margin-top: auto;"});return this}Fa(b={},a=()=>{}){return a(this,E(this,G,L).call(this,"img",{},b)),this}ab(){E(this,G,L).call(this,"h1",{},{textContent:"\u2237WGLIZ\u2237"});return this}Ha(){E(this,G,L).call(this,"hr",{},{});return this}ha(b={},a=()=>{}){const c=E(this,G,L).call(this,"label",{textContent:b.textContent??""});delete b.textContent;b=E(this,G,L).call(this,"input",{type:"checkbox"},b);return c.insertBefore(b,c.firstChild),this.j(),a(this,c,b),this}k(b={},a=()=>{}){return a(this,E(this,G,L).call(this,"button",{},b)),this}ra(b={},a=()=>{}){return a(this,E(this,G,L).call(this,"input",{},b)),this}Ea(b={},a=()=>{}){return a(this,E(this,G,L).call(this,"textarea",{},b)),this}Z(b,a,c=!1){(b=document.getElementById(b.replace(/^#/,"")))&&(b instanceof HTMLInputElement?b.value=a:c?b.textContent=a:b.innerHTML=a)}o(){var b="#bgz-A",a="#bgz-z";let c,d=!1,f=0,e=null,g=0,h=0,k=0,q=0;if(b=document.querySelector("#"==b?.[0]?b:"#"+b),a=document.querySelector("#"==a?.[0]?a:"#"+a),b&&a){var r=()=>{if(d){const l=Math.abs(h-q);(Math.abs(g-k)>.5||l>.5)&&(g=k,h=q,b.style.transform=`translate(${g}px, ${h}px)`,b.style.left="0px",b.style.top="0px",b.style.right="");e=requestAnimationFrame(r)}},p=null,m=(l,t)=>{d=!0;p=b.getBoundingClientRect();c=l-p.left;f=t-p.top;(l=window.getComputedStyle(b).transform)&&"none"!==l?(l=new DOMMatrix(l),g=l.m41,h=l.m42):(g=p.left,h=p.top);k=g;q=h;document.body.style.userSelect="none";a.classList.add("dragging");e&&cancelAnimationFrame(e);r()},u=()=>{d=!1;e&&(cancelAnimationFrame(e),e=null);document.body.style.userSelect="";a.classList.remove("dragging")};a.addEventListener("mousedown",function(l){l.preventDefault();m(l.clientX,l.clientY)});a.addEventListener("touchstart",function(l){const t=l?.touches?.[0];t&&(m(t.clientX,t.clientY),l.preventDefault())},{passive:!1});document.addEventListener("mousemove",function(l){d&&p&&(k=l.clientX-c,q=l.clientY-f)},{passive:!0});document.addEventListener("touchmove",function(l){if(d&&p){const t=l?.touches?.[0];t&&(k=t.clientX-c,q=t.clientY-f,l.preventDefault())}},{passive:!1});document.addEventListener("mouseup",u);document.addEventListener("touchend",u);document.addEventListener("touchcancel",u)}else this.sa(`Can not drag! ${b?"":"moveMe"} ${b||a?"":"and "}${a?"":"MoveThis "}was not found!`)}A(b){(0,console.info)(`${this.name}: ${b}`);this.Z("bgz-o","Status: "+b,!0)}sa(b){(0,console.error)(`${this.name}: ${b}`);this.Z("bgz-o","Error: "+b,!0)}};var G=new WeakSet;var L=function(b,a={},c={}){b=document.createElement(b);this.v?(this.W?.appendChild(b),this.ma.push(this.W),this.W=b):(this.v=b,this.W=b);for(const [d,f]of Object.entries(a))b[d]=f;for(const [d,f]of Object.entries(c))b[d]=f;return b};var M,Z=[{id:0,h:!1,name:"Transparent",i:[0,0,0]},{id:1,h:!1,name:"Black",i:[0,0,0]},{id:2,h:!1,name:"Dark Gray",i:[60,60,60]},{id:3,h:!1,name:"Gray",i:[120,120,120]},{id:4,h:!1,name:"Light Gray",i:[210,210,210]},{id:5,h:!1,name:"White",i:[255,255,255]},{id:6,h:!1,name:"Deep Red",i:[96,0,24]},{id:7,h:!1,name:"Red",i:[237,28,36]},{id:8,h:!1,name:"Orange",i:[255,127,39]},{id:9,h:!1,name:"Gold",i:[246,170,9]},{id:10,h:!1,name:"Yellow",i:[249,221,59]},{id:11,h:!1,name:"Light Yellow",i:[255,250,188]},{id:12,h:!1,name:"Dark Green",i:[14,185,104]},{id:13,h:!1,name:"Green",i:[19,230,123]},{id:14,h:!1,name:"Light Green",i:[135,255,94]},{id:15,h:!1,name:"Dark Teal",i:[12,129,110]},{id:16,h:!1,name:"Teal",i:[16,174,166]},{id:17,h:!1,name:"Light Teal",i:[19,225,190]},{id:18,h:!1,name:"Dark Blue",i:[40,80,158]},{id:19,h:!1,name:"Blue",i:[64,147,228]},{id:20,h:!1,name:"Cyan",i:[96,247,242]},{id:21,h:!1,name:"Indigo",i:[107,80,246]},{id:22,h:!1,name:"Light Indigo",i:[153,177,251]},{id:23,h:!1,name:"Dark Purple",i:[120,12,153]},{id:24,h:!1,name:"Purple",i:[170,56,185]},{id:25,h:!1,name:"Light Purple",i:[224,159,249]},{id:26,h:!1,name:"Dark Pink",i:[203,0,122]},{id:27,h:!1,name:"Pink",i:[236,31,128]},{id:28,h:!1,name:"Light Pink",i:[243,141,169]},{id:29,h:!1,name:"Dark Brown",i:[104,70,52]},{id:30,h:!1,name:"Brown",i:[149,104,42]},{id:31,h:!1,name:"Beige",i:[248,178,119]},{id:32,h:!0,name:"Medium Gray",i:[170,170,170]},{id:33,h:!0,name:"Dark Red",i:[165,14,30]},{id:34,h:!0,name:"Light Red",i:[250,128,114]},{id:35,h:!0,name:"Dark Orange",i:[228,92,26]},{id:36,h:!0,name:"Light Tan",i:[214,181,148]},{id:37,h:!0,name:"Dark Goldenrod",i:[156,132,49]},{id:38,h:!0,name:"Goldenrod",i:[197,173,49]},{id:39,h:!0,name:"Light Goldenrod",i:[232,212,95]},{id:40,h:!0,name:"Dark Olive",i:[74,107,58]},{id:41,h:!0,name:"Olive",i:[90,148,74]},{id:42,h:!0,name:"Light Olive",i:[132,197,115]},{id:43,h:!0,name:"Dark Cyan",i:[15,121,159]},{id:44,h:!0,name:"Light Cyan",i:[187,250,242]},{id:45,h:!0,name:"Light Blue",i:[125,199,255]},{id:46,h:!0,name:"Dark Indigo",i:[77,49,184]},{id:47,h:!0,name:"Dark Slate Blue",i:[74,66,132]},{id:48,h:!0,name:"Slate Blue",i:[122,113,196]},{id:49,h:!0,name:"Light Slate Blue",i:[181,174,241]},{id:50,h:!0,name:"Light Brown",i:[219,164,99]},{id:51,h:!0,name:"Dark Beige",i:[209,128,81]},{id:52,h:!0,name:"Light Beige",i:[255,197,165]},{id:53,h:!0,name:"Dark Peach",i:[155,82,73]},{id:54,h:!0,name:"Peach",i:[209,128,120]},{id:55,h:!0,name:"Light Peach",i:[250,182,164]},{id:56,h:!0,name:"Dark Tan",i:[123,99,82]},{id:57,h:!0,name:"Tan",i:[156,132,107]},{id:58,h:!0,name:"Dark Slate",i:[51,57,65]},{id:59,h:!0,name:"Slate",i:[109,117,141]},{id:60,h:!0,name:"Light Slate",i:[179,185,209]},{id:61,h:!0,name:"Dark Stone",i:[109,100,63]},{id:62,h:!0,name:"Stone",i:[148,140,107]},{id:63,h:!0,name:"Light Stone",i:[205,197,158]}],ia=class{constructor({displayName:b="My template",ia:a=0,Sa:c="",url:d="",file:f=null,coords:e=null,O:g=null,M:h=1E3}={}){this.o=null;this.displayName=b;this.ia=a;this.Sa=c;this.url=d;this.file=f;this.coords=e;this.O=g;this.M=h;this.D=this.C=0;this.B={};this.Ea={};this.q=new Set;this.I=null;b=Array.isArray(Z)?Z:[];this.da=new Set(b.filter(k=>"transparent"!==(k?.name||"").toLowerCase()&&Array.isArray(k?.i)).map(k=>`${k.i[0]},${k.i[1]},${k.i[2]}`));this.da.add("222,250,206");this.da.add("other");this.$=new Map(b.filter(k=>Array.isArray(k?.i)).map(k=>[`${k.i[0]},${k.i[1]},${k.i[2]}`,{id:k.id,h:!!k.h,name:k.name}]));try{const k=b.find(q=>"transparent"===(q?.name||"").toLowerCase());k&&Array.isArray(k.i)&&this.$.set("222,250,206",{id:k.id,h:!!k.h,name:k.name})}catch(k){}try{this.$.set("other",{id:"other",h:!1,name:"Other"})}catch(k){}}async N(){const b=M===!0?this.file:await createImageBitmap(this.file),a=b.width,c=b.height;this.C=a*c;try{this.o=new OffscreenCanvas(a,c);var d=this.o.getContext("2d",{Ya:!0,willReadFrequently:!0});d.imageSmoothingEnabled=!1;d.clearRect(0,0,a,c);d.drawImage(b,0,0);var f=d.getImageData(0,0,a,c).data,e=d=0,g=new Map;for(var h=0;h<c;h++)for(var k=0;k<a;k++){var q=4*(h*a+k),r=f[q],p=f[q+1],m=f[q+2];if(0!==f[q+3]){222===r&&250===p&&206===m&&e++;var u=this.da.has(`${r},${p},${m}`)?`${r},${p},${m}`:"other";if(u=="other"&&!M)return{Ma:f,Ra:d,ka:!0};d++;g.set(u,(g.get(u)||0)+1)}}this.D=d;f={};for(const [t,v]of g.entries())f[t]={count:v,enabled:!0,fa:0};this.B=f}catch(t){this.D=Math.max(0,this.C)}g={};f={};r=new OffscreenCanvas(this.M,this.M);p=r.getContext("2d",{Ya:!0,willReadFrequently:!0});for(m=this.coords[3];m<c+this.coords[3];){u=Math.min(this.M-m%this.M,c-(m-this.coords[3]));for(d=this.coords[2];d<a+this.coords[2];){e=Math.min(this.M-d%this.M,a-(d-this.coords[2]));h=3*e;k=3*u;r.width=h;r.height=k;p.imageSmoothingEnabled=!1;p.clearRect(0,0,h,k);p.drawImage(b,d-this.coords[2],m-this.coords[3],e,u,0,0,3*e,3*u);q=p.getImageData(0,0,h,k);for(var l=0;l<k;l++)for(let t=0;t<h;t++){const v=4*(l*h+t);222===q.data[v]&&250===q.data[v+1]&&206===q.data[v+2]?((t+l)%2==0?(q.data[v]=0,q.data[v+1]=0,q.data[v+2]=0):(q.data[v]=255,q.data[v+1]=255,q.data[v+2]=255),q.data[v+3]=32):t%3!=1||l%3!=1?q.data[v+3]=0:this.da.has(`${q.data[v]},${q.data[v+1]},${q.data[v+2]}`)}p.putImageData(q,0,0);h=`${(this.coords[0]+Math.floor(d/1E3)).toString().padStart(4,"0")},${(this.coords[1]+Math.floor(m/1E3)).toString().padStart(4,"0")},${(d%1E3).toString().padStart(3,"0")},${(m%1E3).toString().padStart(3,"0")}`;g[h]=await createImageBitmap(r);this.q.add(h.split(",").slice(0,2).join(","));k=await (await r.convertToBlob()).arrayBuffer();k=Array.from(new Uint8Array(k));q="";for(l=0;l<k.length;l++)q+=String.fromCharCode(k[l]);f[h]=btoa(q);d+=e}m+=u}return{Ma:g,Ra:f,ka:M=!0,ja:this.o}}},S=class{constructor(){this.o=JSON.parse(GM_getValue("GGImgList",'{"uuid":"", "l": []}'))}C(b,a,c){const d=parseFloat((b.length*.75/1024).toFixed(1)),f={};f.name=a;f.coords=c;f.date=(new Date).toISOString();f.size=d;f.key="temp_key";f.active=!0;this.o.l.forEach(e=>{e.active=!1});this.o.l[0]=f;GM.setValue("GGImgList",JSON.stringify(this.o));GM.setValue("temp_key",b)}D(b){const a=b.split(";")[0].split(":")[1];b=atob(b.split(",")[1]);const c=new Uint8Array(b.length);for(let d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return new Blob([c],{type:a})}};const ca=new class{constructor(){this.duration=0;this.D=this.endTime=this.startTime=null;this.o=!1;this.C=null}N(b,a){!b||b<=0||(this.o&&this.I(),this.duration=b,this.startTime=new Date(a),this.endTime=new Date(this.startTime.getTime()+this.duration*1E3),this.o=!0,this.S(),this.D=setInterval(()=>{this.S()},1E3))}ca(b,a){!b||b<=0||!this.o||(this.I(),this.N(b,a))}I(){this.D&&(clearInterval(this.D),this.D=null);this.o=!1}S(){const b=Math.max(0,this.endTime-new Date);if(b<=0)this.aa();else{if(!document.querySelector("#bgz-timer")){const a=Object.values(document.querySelectorAll(".z-30")).filter(d=>d.nodeName=="BUTTON"&&d.querySelector("canvas"));if(a.length<=0)return;const c=document.createElement("div");c.className="text-xs";c.id="bgz-timer";c.style="position:fixed;bottom:0px;color:chartreuse";a[0].appendChild(c)}this.C=document.querySelector("#bgz-timer");this.C.textContent=`(Full in: ${this.ba(b)})`}}aa(){this.I();this.C&&(this.C.textContent="(FULL)")}ba(b){b=Math.floor(b/1E3);const a=Math.floor(b/60),c=Math.floor(a/60);return c>0?`${c}h ${a%60}m ${b%60}s`:a>0?`${a}m ${b%60}s`:`${b}s`}},U=new S;var da=new WeakSet;var oa=async function(){GM.setValue("GGTemplates",JSON.stringify(this.ga))};var pa=async function(b){b=b.Xa;if(Object.keys(b).length>0){for(const e in b){const g=e;var a=b[e];if(b.hasOwnProperty(e)){var c=g.split(" "),d=Number(c?.[0]);c=c?.[1]||"0";const h=a.name||`Template ${d||""}`,k=a.tb;a={};let q=0;const r=new Map;for(const m in k)if(k.hasOwnProperty(m)){var f=na(k[m]);f=await createImageBitmap(new Blob([f],{type:"image/png"}));a[m]=f;try{const u=f.width,l=f.height,t=(new OffscreenCanvas(u,l)).getContext("2d",{Ya:!0,willReadFrequently:!0});t.imageSmoothingEnabled=!1;t.clearRect(0,0,u,l);t.drawImage(f,0,0);const v=t.getImageData(0,0,u,l).data;for(f=0;f<l;f++)for(let w=0;w<u;w++){if(w%this.Ua!==1||f%this.Ua!==1)continue;const x=4*(f*u+w),H=v[x],F=v[x+1],A=v[x+2];if(v[x+3]<64)continue;if(222===H&&250===F&&206===A)continue;q++;const N=this.da.has(`${H},${F},${A}`)?`${H},${F},${A}`:"other";r.set(N,(r.get(N)||0)+1)}}catch(u){}}const p=new ia({displayName:h,ia:d||this.H?.length||0,Sa:c||""});p.O=a;p.D=q;d={};for(const [m,u]of r.entries())d[m]={count:u,enabled:!0,fa:0};p.B=d;try{Object.keys(a).forEach(m=>{p.q?.add(m.split(",").slice(0,2).join(","))})}catch(m){}try{if(d=b?.[g]?.ob)for(const [m,u]of Object.entries(d))p.B[m]?p.B[m].enabled=!!u?.enabled:p.B[m]={count:u?.count||0,enabled:!!u?.enabled,fa:u?.fa||0}}catch(m){}p.I=g;this.H.push(p)}}try{const e=document.querySelector("#bgz-9");e&&(e.className="oklch");window.postMessage({source:"bmz-gliz",pa:"bgz-b"},"*")}catch(e){}}};var qa=new WeakSet;var W=GM_info.script.name.toString(),X=GM_info.script.version.toString();!function(b){const a=document.createElement("script");a.setAttribute("bgz-E",W);a.setAttribute("bgz-B","color: cornflowerblue;");a.textContent=`(${b})();`;document.documentElement?.appendChild(a);a.remove()}(()=>{const b=document.currentScript,a=b?.getAttribute("bgz-E")||"BM \u27d0 Gliz",c=b?.getAttribute("bgz-B")||"",d=new Map;window.addEventListener("message",e=>{var g=e.data.source;const h=e.data.endpoint,k=e.data.Aa;e=e.data.za;if(Date.now(),"bmz-gliz"==g&&k&&e&&!h)g=d.get(k),"function"==typeof g?g(e):(0,console.warn)(`%c${a}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`,c,"",k),d.delete(k)});const f=window.fetch;window.fetch=async function(...e){try{const [q,r]=e;var g=typeof q==="string"?q:q?.url;const p=r?.method||(q instanceof Request?q.method:"GET");g&&p==="GET"&&g.includes("/tiles/")&&window.postMessage({source:"load",endpoint:g})}catch(q){console.warn("Verrify request.",q)}g=await f.apply(this,e);const h=g.clone(),k=(e[0]instanceof Request?e[0]?.url:e[0])||"ignore";e=h.headers.get("content-type")||"";if(e.includes("application/json"))h.json().then(q=>{window.postMessage({source:"bmz-gliz",endpoint:k,fb:q},"*")}).catch(()=>{});else if(e.includes("image/")&&!k.includes("openfreemap")&&!k.includes("maps")){window.postMessage({source:"load",endpoint:k});const q=Date.now(),r=await h.blob();return(new Promise(p=>{const m=crypto.randomUUID();d.set(m,u=>{p(new Response(u,{headers:h.headers,status:h.status,statusText:h.statusText}))});window.postMessage({source:"bmz-gliz",endpoint:k,Aa:m,za:r,blink:q})})).catch(()=>{Date.now()})}return g}});var v = GM_getResourceText("Style-File");GM_addStyle(v);S=document.createElement("link");S.href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap";S.rel="preload";S.as="style";S.onload=function(){this.onload=null;this.rel="stylesheet"};document.head?.appendChild(S);new class{constructor(){}observe(b,a=!1,c=!1){b.observe(null,{childList:a,subtree:c})}};var I=new V(W,X),n=(new V(W,X),new class{constructor(b,a,c){ba(this,da);this.name=b;this.version=a;this.v=c;this.ka=null;this.M=1E3;this.Ua=3;this.H=[];this.ga=null;this.Ja=!0;this.S=new Map;this.g={};this.Ba=!0;this.Qa=this.Oa=this.La=-1;this.ta=this.N=!1;this.C="";this.rb=new MouseEvent("click",{bubbles:!0,cancelable:!0});this.g.J={enabled:!1,T:{x:100,y:100,j:0}};this.g.F={active:!1,color:"#C300FF",type:1};this.g.G={h:!1,na:!0,la:!1,select:!1};this.g.alpha="d0";this.g.backgroundColor="#f8f4f0";this.g.ea=[];this.g.version=this.version;this.ub=Z.filter(d=>d.h===!1).map(d=>d.i);this.kb=Z.map(d=>d.i);this.Ab()}async Ab(){try{this.ca(this.g).every(a=>this.ca(JSON.parse(GM_getValue("Settings","{}"))).includes(a))?this.g=this.eb():(this.g.uuid=crypto.randomUUID(),this.o())}catch(a){console.warn(a),this.g.uuid=crypto.randomUUID(),this.o()}this.backgroundColor=this.g.backgroundColor;this.g.alpha=this.g.alpha;this.K=this.g.J.enabled;this.D=this.g.J.T;this.ea=this.g.ea;this.I=U.o;if(Object.keys(this.I).length>0&&this.I.constructor===Object&&this.I.uuid!=="")try{var b=JSON.parse(GM_getValue("GGTemplates","{}"));if(this.g.uuid==this.I.uuid&&b.constructor===Object&&Object.keys(b).length>0&&this.version==this.g.version)this.Bb(b);else{GM_deleteValue("GGTemplates");U.o.uuid=this.g.uuid;GM.setValue("GGImgList",JSON.stringify(U.o));const a=Object.values(this.I.l).filter(e=>e.active===!0)[0],c=a.name,d=a.coords,f=U.D(GM_getValue(a.key,""));M=!1;(await this.aa(f,c,d)).ja?this.v.A("\u27d0 Drew successfully!"):this.v.A("\u27d0 Error loading image...")}}catch(a){console.warn(a)}else this.I.uuid=this.g.uuid}ca(b,a=""){let c=[];for(let d in b)typeof b[d]==="object"&&b[d]!==null?(c.push(a+d),c=c.concat(this.ca(b[d],a+d+"."))):c.push(a+d);return c}Ta(b){b.addEventListener("touchmove",function(a){a.touches.length>1&&a.preventDefault()})}nb(b,a){const c=b[0]-a[0],d=b[1]-a[1];b=b[2]-a[2];return Math.sqrt(c*c+d*d+b*b)}mb(b,a){let c=Infinity,d=null;a.forEach(f=>{const e=this.nb(b,f);e<c&&(c=e,d=f)});return d}lb(b){const a=b.data,c=b.width,d=b.height,f=this.g.G.h?this.kb:this.ub;for(let q=0;q<d;q++)for(let r=0;r<c;r++){var e=(q*c+r)*4;if(a[e+3]<128){a[e]=0;a[e+1]=0;a[e+2]=0;a[e+3]=0;continue}else a[e+3]=255;var g=a[e],h=a[e+1],k=a[e+2];const p=this.mb([g,h,k],f);g-=p[0];h-=p[1];k-=p[2];a[e]=p[0];a[e+1]=p[1];a[e+2]=p[2];r+1<c&&(e=(q*c+(r+1))*4,a[e]+=g*7/16*.7,a[e+1]+=h*7/16*.7,a[e+2]+=k*7/16*.7);r-1>=0&&q+1<d&&(e=((q+1)*c+(r-1))*4,a[e]+=g*3/16*.7,a[e+1]+=h*3/16*.7,a[e+2]+=k*3/16*.7);q+1<d&&(e=((q+1)*c+r)*4,a[e]+=g*5/16*.7,a[e+1]+=h*5/16*.7,a[e+2]+=k*5/16*.7);r+1<c&&q+1<d&&(e=((q+1)*c+(r+1))*4,a[e]+=g/16*.7,a[e+1]+=h/16*.7,a[e+2]+=k/16*.7)}return b}Cb(b){const a=document.createElement("canvas"),c=a.getContext("2d"),d=b.width,f=b.height;a.width=d;a.height=f;c.drawImage(b,0,0);b=c.getImageData(0,0,d,f);b=this.lb(b);c.putImageData(b,0,0);return a}xb(b){return Array.isArray(b)&&b.length===4?{ib:360/Math.PI*(Math.atan(Math.exp(Math.PI-2*Math.PI*((1E3*b[1]+b[3])/2048E3)))-Math.PI/4),jb:(1E3*b[0]+b[2])/2048E3*360-180}:null}xa(b,a=!1){b&&(a?(this.g.U=a,b.style="background-color:#063912;",this.v.A("\u27d0 Enabled single select colors.")):(this.g.U=!this.g.U||!1,this.g.U?b.style="background-color:#063912;":b.style="background-color:#2d2d2d;",this.g.U?this.v.A("\u27d0 Enabled single select colors."):this.v.A("\u27d0 Disabled single select colors."),this.o()))}sb(b,a){function c(){if(b&&a){let d=a.getBoundingClientRect(),f=b.getBoundingClientRect(),e=f.x-Math.ceil(Math.abs(d.width-f.width)/2);a.style.top=`${f.y-d.height-4}px`;a.style.left=`${e}px`;requestAnimationFrame(c)}}c()}eb(){return JSON.parse(GM_getValue("Settings","{}"))}o(){GM.setValue("Settings",JSON.stringify(this.g))}qa(){this.K=!this.K;this.g.J.enabled=this.K;this.o();this.Pa();this.K?this.v.A("\u27d0 Undocked panel \u2022 drag it!"):this.v.A("\u27d0 Docked panel")}wb(b){this.K&&document.querySelector("#bgz-g").childElementCount>0&&(this.g.J.T.j=b.borderBoxSize[0].blockSize)}Pa(){setTimeout(()=>{const b=document.querySelector("#bgz-9"),a=document.querySelector("#bgz-dock-btn");let c;const d=document.querySelector("#bgz-stats"),f=document.getElementById("bgz-9-overlay");b&&(document.getElementById("btn-clon")?c=document.getElementById("btn-clon"):(c=a.cloneNode(!1),c.id="btn-clon",c.title="Reset list colors",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.36-3.36L23 10M1 14l5.13 5.13A9 9 0 0 0 20.49 15"></path></svg>',c.style=c.style.cssText+"display:none;position:absolute;transform:translatex(-50%);left:50%;bottom:-20px",c.addEventListener("click",()=>{this.D={x:100,y:100,j:360};this.qa()}),document.getElementById("bgz-A")?.appendChild(c)),this.K?(document.getElementById("bgz-colorList").classList.add("active"),b.classList.add("detached"),a&&(a.classList.add("docked"),a.textContent="\u21f2"),b.parentElement.parentElement!==f&&(b.style.display="grid",f.querySelector("#bgz-dockerContent").appendChild(b)),f.style.display="flex",f.style.left=this.D.x+"px",f.style.top=this.D.y+"px",this.qb(f)):(document.getElementById("bgz-colorList").classList.remove("active"),a.textContent="\u21f1",f.style.display="none",b.classList.remove("detached"),a&&a.classList.remove("docked"),d&&b.parentElement!==d&&(window.getComputedStyle(document.getElementById("bgz-6")).display==="none"?b.style.display="none":b.style.display="block",d.appendChild(b)),b.style.position="",b.style.left="",b.style.top="",b.style.zIndex="",this.pb(f)))},100)}qb(b){let a=!1,c,d,f,e;const g=p=>p.touches&&p.touches.length>0?{x:p.touches[0].clientX,y:p.touches[0].clientY}:{x:p.clientX,y:p.clientY},h=p=>{if(p.target.closest("#bgz-dockerDrag")&&!p.target.closest("button, input, select")){var {x:m,y:u}=g(p);a=!0;c=m;d=u;var l=b.getBoundingClientRect();f=l.left;e=l.top;b.style.cursor="grabbing";b.style.transition="none";document.addEventListener("mousemove",k);document.addEventListener("mouseup",q);document.addEventListener("touchmove",k,{passive:!1});document.addEventListener("touchend",q);p.preventDefault()}},k=p=>{if(a){p.preventDefault();var {x:m,y:u}=g(p);p=m-c;var l=u-d;b.style.left=f+p+"px";b.style.top=e+l+"px";this.D.x=f+p;this.D.y=e+l}},q=()=>{a&&(a=!1,b.style.cursor="",b.style.transition="",this.g.J.T=this.D,this.o(),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",q),document.removeEventListener("touchmove",k),document.removeEventListener("touchend",q))};b.wa=h;const r=b.querySelector("#bgz-dockerDrag");r&&(r.addEventListener("mousedown",h),r.addEventListener("touchstart",h,{passive:!1}))}pb(b){const a=b.querySelector("#bgz-dockerDrag");a&&b.wa&&(a.removeEventListener("mousedown",b.wa),a.removeEventListener("touchstart",b.wa),a.style.cursor="")}async gb(){return{zb:this.name.replace(/\s+/g,""),Ib:this.version,Hb:"1.0.0",Xa:{}}}async aa(b,a,c){this.ga||(this.ga=await this.gb());M?this.v.A("\u27d0 Reducing color palette..."):this.v.A(`\u27d0 Creating template at ${c.join(", ")}...`);b=new ia({displayName:a,file:b,coords:c});const {Ma:d,Ra:f,ka:e,ja:g}=await b.N();if(e&&!M)return this.v.A("\u27d0 Raw template colors!"),!1;b.O=d;b.I="GG";this.ga.Xa.GG={name:b.displayName,coords:c.join(", "),enabled:!0,tb:f,ob:b.B};this.H=[];this.H.push(b);b=(new Intl.NumberFormat).format(b.C);this.v.A(`\u27d0 Template created at ${c.join(", ")}! Total pixels: ${b}`);try{const h=document.querySelector("#bgz-9");h&&(h.className="oklch");window.postMessage({source:"bmz-gliz",pa:"bgz-b"},"*")}catch(h){}await E(this,da,oa).call(this);setTimeout(()=>{n.S.clear();n.N=!0},2500);n.g.ea=c;n.o();return{pa:!0,ja:g}}ba(b){b=b[0].toString().padStart(4,"0")+","+b[1].toString().padStart(4,"0");var a=this.H;if(a.sort((c,d)=>c.ia-d.ia),!a.some(c=>!!c?.O&&(c.q&&c.q.size>0?c.q.has(b):Object.keys(c.O).some(d=>d.startsWith(b)))))return null;a=a.map(c=>{const d=Object.keys(c.O).filter(f=>f.startsWith(b));return 0===d.length?null:d.map(f=>{const e=f.split(",");return{ua:c.O[f],Fb:[e[0],e[1]],Ia:[e[2],e[3]],Jb:c}})?.[0]}).filter(Boolean);return[a,a.length,b]}async $a(b,a){if(!this.Ja)return b;const c=this.M*3;a=this.ba(a);if(!a||a[1]===0)return b;const [d,f,e]=a;var g=await createImageBitmap(b);b=new OffscreenCanvas(c,c);a=b.getContext("2d",{willReadFrequently:!0});a.imageSmoothingEnabled=!1;a.drawImage(g,0,0,c,c);g=null;try{g=a.getImageData(0,0,c,c).data}catch(u){}const h=this.H.find(u=>u.O&&Object.keys(u.O).some(l=>l.startsWith(e)));let k=0,q=0,r={},p=0;if(g)for(const u of d)try{const l=Number(u.Ia[0])*3,t=Number(u.Ia[1])*3,v=u.ua.width,w=u.ua.height,x=new OffscreenCanvas(v,w),H=x.getContext("2d",{willReadFrequently:!0});H.imageSmoothingEnabled=!1;H.drawImage(u.ua,0,0);const F=H.getImageData(0,0,v,w),A=F.data,N=new OffscreenCanvas(v,w),T=N.getContext("2d",{willReadFrequently:!0});T.fillStyle=this.backgroundColor!=="transparent"?this.backgroundColor+this.g.alpha:"transparent";T.fillRect(0,0,v,w);const ja=T.getImageData(0,0,v,w),ka=ja.data;function la(B,z,y,C,J,Q=2,K){let Y=K===0?N:x;K=K===0?ka:A;for(let R=B-y;R<=B+y;R++)for(let D=z-y;D<=z+y;D++){var O=Math.abs(R-B)+Math.abs(D-z);if(O<=y){const P=(D*Y.width+R)*4;O=O>y-Q?J:C;K[P]=O[0];K[P+1]=O[1];K[P+2]=O[2];K[P+3]=O[3]}}}function ea(B,z,y,C,J){let Q=J===0?N:x;J=J===0?ka:A;let [K,Y,O,R]=C;for(C=-y;C<=y;C++)for(let P=-y;P<=y;P++){var D=B+P;const fa=z+C;D>=0&&D<Q.width&&fa>=0&&fa<Q.height&&(D=(fa*Q.width+D)*4,J[D]=K,J[D+1]=Y,J[D+2]=O,J[D+3]=R)}}const ma=[],ha=this.g.F.color.replace("#",""),aa=[parseInt(ha.substr(0,2),16),parseInt(ha.substr(2,2),16),parseInt(ha.substr(4,2),16),255];for(let B=0;B<w;B++)for(let z=0;z<v;z++){if(z%3!==1||B%3!==1)continue;var m=l+z;const y=t+B;if(m<0||y<0||m>=c||y>=c)continue;this.backgroundColor==="transparent"||this.g.G.na&&this.ta||g[4*(y*c+m)+3]!==0&&ea(z,B,1,[0,0,0,0],0);const C=4*(B*v+z);if(A[C+3]<10)continue;const J=A[C],Q=A[C+1],K=A[C+2],Y=A[C+3];m=4*(y*c+m);const O=g[m],R=g[m+1],D=g[m+2],P=g[m+3];m=`${J},${Q},${K}`;h&&h.B&&h.B[m]&&(h.B[m].enabled&&p++,r[m]||(r[m]={p:0,w:0}),O===J&&R===Q&&D===K&&P===Y?(k++,r[m].p+=1,A[C+3]=0):P!==0?(q++,h.B[m].enabled&&(ma.push([z,B]),r[m].w+=1)):h.B[m].enabled&&this.g.F.active&&this.g.G.la&&(this.g.F.type==1?ea(z,B,1,aa,0):la(z,B,2,aa,[0,255,0,255],1,0)),h.B[m].enabled||(A[C+3]=0))}this.g.F.active&&ma.forEach(B=>{let [z,y]=B;this.g.F.type==1?ea(z,y,1,aa,0):la(z,y,4,aa,[0,255,0,255],1,0)});T.putImageData(ja,0,0);H.putImageData(F,0,0);a.drawImage(N,l,t);a.drawImage(x,l,t)}catch(l){console.warn("Error calculating pixel stats:",l)}f>0?this.S.set(e,{Db:k,required:p,Eb:q,V:r}):this.v.A(`\u27d0 Displaying ${f} templates.`);setTimeout(()=>{document.querySelector("#bgz-ld")?.classList.remove("loader-inline")},750);return await b.convertToBlob({type:"image/png"})}Bb(b){Object.keys(b).length!==0||b.constructor!==Object?this.ga=b:"*";"BM\u27d0Gliz"==b?.zb&&E(this,da,pa).call(this,b)}Ga(b){this.Ja=b}Na(b,a){for(let c in b){const d=b[c];typeof d==="object"&&d!==null?(a[c]||(a[c]={}),this.Na(d,a[c])):a[c]=(a[c]||0)+d}}yb(){const b={},a={L:0,R:0,X:0,P:{}};try{if(this.S.size<1)return;this.S.forEach(c=>{this.Na(c,b)});for(const c of this.H)for(const [d,f]of Object.entries(c.B||{}))b.V[d]||(b.V[d]={p:0,w:0}),f.enabled&&(a.L+=f.count,a.R+=b.V[d].p,a.X+=b.V[d].w),a.P[d]={required:f.count||0,oa:b.V[d].p||0,left:f.count-(b.V[d].p||0),enabled:f.enabled},c.B[d].fa=a.P[d].oa}catch(c){console.warn("Error getting pixel stats:",c)}n.o();return a}va(){const b=document.querySelector("#bgz-69")?.querySelector("div:first-child");b&&(b.innerHTML="\u267b\ufe0f Statistics...")&&b.classList.remove("animate")}Ca(b){this.backgroundColor=b;try{this.g.backgroundColor=b,this.o()}catch(a){}this.v&&this.v.A(`\u27d0 Background color: ${b}`)}Va(b,a,c){this.g.F={active:c,color:b,type:a};this.o();this.v&&this.v.A(`\u27d0 Highlight ${0==c?"disabled":`enabled: ${b}`}.`)}Da(b){let a=document.getElementById("bgz-error-color")?.value,c=this.g.F?.active||!1;c=c==1&&this.g.F?.type==b?!1:!0;this.Va(a,b,c);document.querySelectorAll(".bgz-highlight-btn").forEach(f=>{f.classList.remove("active");f.querySelector(`${b==1?"path":"rect"}`)?.setAttribute("fill","currentColor")});const d=b==1?document.getElementById("bgz-square-btn"):document.getElementById("bgz-diamond-btn");c==1?(d?.classList?.add("active"),d?.querySelector(`${b==1?"rect":"path"}`)?.setAttribute("fill",a),document.getElementById("gg-wrongs").setAttribute("t",b),document.documentElement.style.setProperty("--color-hl",a),document.getElementById("gg-wrongs").classList.add("active")):(d?.querySelector(`${b==1?"rect":"path"}`)?.setAttribute("fill","currentColor"),document.getElementById("gg-wrongs").classList.remove("active"))}ya(b=!1){const a=n.yb();if(a){var c=document.querySelector("#dbz-1"),d=document.querySelector("#bgz-g");if(!c||d.childElementCount<=0||this.N)window.o(a);else if(a.R!==n.La||a.L!=n.Oa||a.X!=n.Qa||b)n.La=a.R,n.Oa=a.L,n.Qa=a.X,setTimeout(()=>{if(c&&a){var f=a.L>0?Math.round(a.R/a.L*100):0;document.documentElement.style.setProperty("--pa",f>=85?"#4caf4f42":f>=50?"#ff990042":"#f4433642");document.documentElement.style.setProperty("--pb",f>=85?"#4caf4f83":f>=50?"#ff990083":"#f4433683");c.innerHTML=`\u27d0  <span style="color: #64b5f6">${a.R.toLocaleString()}</span>/<span>${a.L.toLocaleString()}</span> \u2022 <span style="color: ${f>=80?"#4caf50":f>=50?"#ff9800":"#f44336"}">${f}%</span>  \u27d0`;c.style.setProperty("--progress-width",f+"%");c.classList.remove("low-progress","medium-progress","high-progress","complete-progress","animate");f===0?c.classList.add("low-progress"):f<30?c.classList.add("low-progress"):f<70?c.classList.add("medium-progress"):f<100?c.classList.add("high-progress"):c.classList.add("complete-progress");c.classList.add("animate");this.Za(a);this.v.A(`\u27d0 Wrong Pixel${1==a.X?"":"s"} ${a.X}.`)}},100)}}Za(b){document.querySelectorAll("#bgz-g > div").forEach(a=>{const c=a.querySelector("div[name]");var d=a.querySelector("input");const f=a.querySelector("#box-color");if(c){var e=c.getAttribute("name");if(e&&b.P){var g=Object.keys(b.P).find(h=>n.H?.[0]?.$?.get(h)?.name===e);if(g&&b.P[g]){const h=b.P[g].enabled;let k=1;d.checked=h;d=b.P[g];d=d.required>0?Math.round(d.oa/d.required*100):0;h||(k=.5,d=0);c.style.opacity=f.style.opacity=k;a.style.setProperty("--item-progress",d+"%");a.classList.remove("low-progress","medium-progress","high-progress","complete-progress");d===0?a.classList.add("low-progress"):d<30?a.classList.add("low-progress"):d<70?a.classList.add("medium-progress"):d<100?a.classList.add("high-progress"):a.classList.add("complete-progress")}}}})}Wa(b,a){function c(l){const t=l.type.includes("mouse")?l.clientX:l.touches[0].clientX;l.type.includes("mouse");l.type==="touchstart"&&l.preventDefault();p=r=!1;q=t}function d(l){if(q&&!p){var t=l.type.includes("mouse")?l.clientX:l.touches[0].clientX;l.type.includes("mouse");l=t-q;Math.abs(l)>10&&(r=!0,t=Math.min(Math.abs(l)/40,1),l>0?k.style.transform=`translateX(${Math.min(l,40)}px) scale(${1+t*.1})`:(k.classList.remove("swiping"),e()))}}function f(l){if(q){var t=l.type.includes("mouse")?l.clientX:l.changedTouches[0].clientX;l.type==="touchend"&&l.preventDefault();l=t-q;r&&l>40?(p=!0,h(l)):Math.abs(l)<5?g():e();p||(q=0,r=!1)}}function e(){k.style.transform=""}function g(){m++;a=="bg"&&(n.backgroundColor!="transparent"?(document.getElementById("bg-bg").classList.remove("active"),n.Ca("transparent")):(document.getElementById("bg-bg").classList.add("active"),n.Ca(document.documentElement.style.getPropertyValue("--color-bg"))));a=="wrongs"&&n.Da(parseInt(b.parentElement.getAttribute("t"))||1);setTimeout(()=>{e()},100)}function h(){u++;a=="bg"&&(document.querySelector("#zbg-controls").style.display="flex",setTimeout(()=>{document.querySelector("#zbg-controls")?.classList.add("active")},250));a=="wrongs"&&(document.querySelector("#z-error-highlight").style.display="flex",setTimeout(()=>{document.querySelector("#z-error-highlight")?.classList.add("active")},250));setTimeout(()=>{e();k.classList.remove("swipe-complete")},100);q=0;r=!1}const k=b;let q=0,r=!1,p=!1,m=0,u=0;k.addEventListener("mousedown",c);k.addEventListener("touchstart",c);document.addEventListener("mousemove",d);document.addEventListener("touchmove",d);document.addEventListener("mouseup",f);document.addEventListener("touchend",f);k.addEventListener("contextmenu",l=>{l.preventDefault()})}}(W,X,I));V=new class{constructor(b){ba(this,qa);this.u=b;this.Ka=[]}hb(b){window.addEventListener("message",async a=>{var c=a.data;a=c.fb;if(c&&["bmz-gliz","load"].includes(c.source)&&c.endpoint){var d=c.endpoint?.split("?")[0].split("/").filter(h=>h&&isNaN(Number(h))).filter(h=>h&&!h.includes(".")).pop();if("load"==c.source&&"tiles"==d){var f=c.endpoint.split("/");f=[parseInt(f[f.length-2]),parseInt(f[f.length-1].replace(".png",""))];n.ba(f)&&n.ba(f)[1]>0&&(document.querySelector("#bgz-ld")||(f=document.createElement("div"),f.id="bgz-ld",document.querySelector("#dbz-1")?.appendChild(f)),document.querySelector("#bgz-ld")?.classList.add("loader-inline"))}else{switch(d){case "me":if(a.status&&"2"!=a.status?.toString()[0])return void b.sa("\u27d0 You are not logged in!\nCould not fetch userdata.");f=Math.ceil(Math.pow(Math.floor(a.level)*9.12281389923994,1/.65)-a.pixelsPainted);a.id||a.id;this.u.ka=a.id;b.Z("bgz-u",`Username: <b>${(function(h){const k=document.createElement("div");return k.textContent=h,k.innerHTML})(a.name)}</b>`);b.Z("bgz-p",`Droplets: <b>${(new Intl.NumberFormat).format(a.Gb)}</b>`);b.Z("bgz-i",`Next level in <b>${(new Intl.NumberFormat).format(f)}</b> pixel${1==f?"":"s"}`);f=new Date;var e=(a.charges.max-a.charges.count)*30;ca.o?ca.ca(e,f):ca.N(e,f);break;case "pixel":a=c.endpoint.split("?")[0].split("/").filter(h=>h&&!isNaN(Number(h)));c=new URLSearchParams(c.endpoint.split("?")[1]);c=[c.get("x"),c.get("y")];if(this.Ka.length&&(!a.length||!c.length))return void b.sa("\u27d0 Coordinates are malformed!\nDid you try clicking the canvas first?");this.Ka=[...a,...c];d=(e=a,g=c,[parseInt(e[0])%4*1E3+parseInt(g[0]),parseInt(e[1])%4*1E3+parseInt(g[1])]);e=document.querySelectorAll("span");for(f of e)f.textContent.trim().includes(`${d[0]}, ${d[1]}`)&&(e=document.querySelector("#bgz-h"),g=`(Tl X: ${a[0]}, Tl Y: ${a[1]}, Px X: ${c[0]}, Px Y: ${c[1]})`,e?e.textContent=g:(e=document.createElement("span"),e.id="bgz-h",e.textContent=g,e.style="margin-left: calc(var(--spacing)*3); font-size: small;",f.parentNode.parentNode.parentNode.insertAdjacentElement("afterend",e)));break;case "tiles":e=c.endpoint.split("/"),e=[parseInt(e[e.length-2]),parseInt(e[e.length-1].replace(".png",""))],f=c.Aa,e=await this.u.$a(c.za,e),window.postMessage({source:"bmz-gliz",Aa:f,za:e,blink:c.blink})}var g}}})}}(n);I.C(V);!function(){let b=!1;try{JSON.parse(GM_getValue("GGCoords","{}"))}catch(a){}I.m({id:"bgz-A",style:"top: 10px; right: 75px; min-width: 230px;"}).m({id:"bgz-j"}).m({id:"bgz-z"}).j().m({id:"dbz",style:"display: flex;align-items: center;justify-content: flex-start;background:linear-gradient(0deg, #0c1412, transparent);padding:0px 4px 0px 4px;border-radius: 10px;"}).Fa({id:"dbz-img",alt:"Click to minimize/maximize",src:"https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true",style:"cursor: pointer;background: linear-gradient(45deg, #ff000040, #ffa50040, #ffff0040, #00800040, #0000ff40, #4b008240, #ee82ee40);background-size: 400% 400%;animation: rainbow 10s ease infinite;padding:2px;border-radius:50%;margin-bottom:3px;min-height: 4em;"},(a,c)=>{c.addEventListener("click",()=>{b=!b;const d=document.querySelector("#bgz-A"),f=document.querySelector("#bgz-j"),e=document.querySelector("#bgz-z"),g=document.querySelector("#bgz-bg-controls"),h=document.querySelector("#bgz-error-highlight"),k=document.querySelector("#up"),q=document.querySelector("#bgz-options"),r=document.querySelector("#btn-clon");b||(d.style.width="auto",d.style.maxWidth="24px",d.style.minWidth="230px",d.style.padding="10px");["#bgz-A h1","#bgz-f","#bgz-A hr","#bgz-6",`#${a.cb}`,n.g.J.enabled?"#bgz-6":"#bgz-9"].forEach(p=>{document.querySelectorAll(p).forEach(m=>{m.style.display=b?"none":""})});b?(q&&(q.style.display="none"),r&&(r.style.display="flex"),k&&(k.style.display="none"),h&&(h.style.display="none"),g&&(g.style.display="none"),d.style.width="80px",d.style.height="90px",d.style.maxWidth="80px",d.style.minWidth="60px",d.style.padding="8px",c.style.marginLeft="0px",f.style.textAlign="center",f.style.margin="0",f.style.marginBottom="0",e&&(e.style.display="",e.style.marginBottom="0.25em")&&(document.getElementById("dbz").querySelector("img").src="https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_1.png")):(q&&(q.style.display=""),r&&(r.style.display="none"),k&&(k.style.display="none"),k&&(document.getElementById("dbz").querySelector("img").src="https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_2.png"),h&&(h.style.display="flex"),g&&(g.style.display="flex"),c.style.marginLeft="",d.style.padding="10px",f.style.textAlign="",f.style.margin="",f.style.marginBottom="",e&&(e.style.marginBottom="0.5em"),d.style.width="",d.style.height="");c.alt=b?"Minimized (Click to maximize)":"Maximized (Click to minimize)";b||(n.g.J.enabled?document.getElementById("bgz-9").style.display="grid":document.getElementById("bgz-9").style.display="block")})}).j().ab().j().j().j().Ha().j().m({id:"bgz-f"}).Y({id:"bgz-u",textContent:"Username:",style:"margin-bottom: 3px; font-size: 12px;"}).j().Y({id:"bgz-p",textContent:"Droplets:",style:"display: none"}).j().Y({id:"bgz-i",textContent:"Next level in...",style:"display: none"}).j().j().Ha().j().m({id:"bgz-bg-controls",style:"gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;"}).Y({textContent:"BG:",style:"font-size: 11px; font-weight: bold;"}).j().ra({type:"color",id:"bgz-bg-color",value:"#ffffff",title:"Background color",style:"width: 50px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;"},(a,c)=>{c.addEventListener("change",()=>{a.t?.u?.Ca(c.value);document.documentElement.style.setProperty("--color-bg",c.value);document.getElementById("bg-bg").classList.add("active")});setTimeout(()=>{a.t?.u?.backgroundColor!=="transparent"?(c.value=a.t?.u?.backgroundColor,document.documentElement.style.setProperty("--color-bg",a.t?.u?.backgroundColor),document.getElementById("bg-bg").classList.toggle("active")):document.documentElement.style.setProperty("--color-bg","#F8F4F0")},250)}).j().m({style:"display: flex; grid-column: 1/-1; align-items: center; justify-content: space-between;margin-left:3px",innerHTML:'<div id="slider-title"></div>'}).ra({type:"range",id:"alphaSlider",min:"0",max:"255",value:"255",style:"width: 100%;"},(a,c)=>{c.addEventListener("input",()=>{var d=document.getElementById("slider-title");const f=(c.parentNode.parentNode.getBoundingClientRect().width-80)/2;d.textContent=`Alpha: ${c.value}`;d.style.left=`${f}px`;d.style.top=`-${c.parentNode.parentNode.getBoundingClientRect().height-2}px`;d.style.visibility="visible";d=parseInt(c.value).toString(16).toUpperCase();d=d.length===1?"0"+d:d;n.g.alpha=d});c.addEventListener("change",()=>{const d=document.getElementById("slider-title");setTimeout(()=>{d.style.visibility="hidden"},500)});setTimeout(()=>{c.value=parseInt(n.g.alpha,16)},500)}).j().j().j().j().m({id:"bgz-error-highlight",style:"gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;"}).Y({textContent:"HL:",style:"font-size: 11px; font-weight: bold;"}).j().ra({type:"color",id:"bgz-error-color",className:"bgz-highlight-btn",value:"#15ff00",style:"width: 35px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;",title:"highlighter color"},(a,c)=>{c.addEventListener("change",()=>{let d=a.t?.u?.g.F?.type||1;a.t?.u?.Va(c.value,d,!0);document.querySelectorAll(".bgz-highlight-btn").forEach(f=>{f.classList.remove("active")});d==1?document.querySelector("#bgz-square-btn")?.querySelector("rect")?.setAttribute("fill",c.value):document.querySelector("#bgz-diamond-btn")?.querySelector("path")?.setAttribute("fill",c.value);document.querySelector(d==1?"#bgz-square-btn":"#bgz-diamond-btn")?.classList.add("active");document.getElementById("gg-wrongs").classList.add("active");document.documentElement.style.setProperty("--color-hl",c.value)});setTimeout(()=>{let d=a?.t?.u?.g?.F?.color||"#9900ff",f=a.t?.u?.g?.F?.type||1;c.value=d;document.documentElement.style.setProperty("--color-hl",d);document.getElementById("gg-wrongs").setAttribute("t",f)},250)}).j().m({style:"display: flex; gap: 8px; grid-column: 1 / -1; align-items: center; justify-content: space-between;"}).k({id:"bgz-square-btn",className:"bgz-highlight-btn",style:"width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;",title:"Square mode",innerHTML:'<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <rect x="3" y="3" width="10" height="10" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>'},(a,c)=>{c.onclick=()=>{a.t?.u?.Da(1)};setTimeout(()=>{a.t?.u?.g?.F?.active&&a.t?.u?.g.F.type==1&&(c.classList.add("active"),c.querySelector("rect")?.setAttribute("fill",a.t?.u?.g.F.color),document.getElementById("gg-wrongs").classList.toggle("active"))},500)}).j().k({id:"bgz-diamond-btn",className:"bgz-highlight-btn",style:"width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;",title:"Diamond mode",innerHTML:'<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <path d="M8 3 L13 8 L8 13 L3 8 Z" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>'},(a,c)=>{c.onclick=()=>{a.t?.u?.Da(2)};setTimeout(()=>{a.t?.u?.g?.F?.active&&a.t?.u?.g.F.type==2&&(c.classList.add("active"),c.querySelector("path")?.setAttribute("fill",a.t?.u?.g.F.color),document.getElementById("gg-wrongs").classList.toggle("active"))},500)}).j().j().j().m({id:"bgz-stats",style:"display: none; justify-content: center"}).m({id:"bgz-9",style:"position: relative;"}).m({style:"display:flex; flex-direction: row; flex-wrap: wrap; align-content: center; justify-content: center; align-items: center; gap: 2px; padding: 4px"}).k({id:"bgz-3",textContent:"Full\ud83c\udfa8",title:"Activate all colors",style:"min-width: 47px"},(a,c)=>{c.onclick=()=>{const d=n.H[0];d?.B&&(Object.values(d.B).forEach(f=>f.enabled=!0),n.va(),a.A("\u27d0 Enabled all colors"));setTimeout(()=>{n.ya(!0)},1E3)}}).j().k({id:"bgz-0",textContent:"No\ud83c\udfa8",title:"Deactivate all colors",style:"min-width: 47px"},(a,c)=>{c.onclick=()=>{const d=n.H[0];d?.B&&(Object.values(d.B).forEach(f=>f.enabled=!1),n.va(),a.A("\u27d0 Disabled all colors"))}}).j().k({id:"bgz-96",textContent:"Single\ud83c\udfa8",title:"Single selection mode",style:"min-width: 47px"},(a,c)=>{c.onclick=()=>{n.xa(c)};setTimeout(()=>{n.g.U?c.style="background-color:#063912;":c.style="background-color:#2d2d2d;"},200)}).j().k({id:"bgz-dock-btn",style:"width: 25px;padding: 0px;min-width: 20px;border: 0px solid;border-radius: 6px;min-height: 20px;font-size:medium;background-color: #4F1D6F;",title:"Dock/Undock panel",textContent:"\u21f1"},(a,c)=>{c.onclick=()=>{a.t?.u?.qa()}}).j().j().m({id:"bgz-69",style:"animation: pulseProgress 2s ease-in-out infinite;"}).j().m({id:"bgz-g",className:"bgz-scroll"}).j().j().j().j().m({id:"bgz-options",style:"border: 1px solid #8a70a3;border-radius:5px;margin-top: 10px;padding: 0px 5px 5px 5px;font-size: x-small;background: #1a1a1a;",innerHTML:'<label style="position:relative;top:-8px;background: #1a1a1a;">\u2699\ufe0fOPTIONS</label>'}).ha({id:"bgz-op1",textContent:"Use premium colors in image conversion.",style:"margin-right:5px;"},(a,c)=>{c.style.display="flex";c.querySelector("input").addEventListener("change",function(){n.g.G.h=!n.g.G.h;n.o()});setTimeout(()=>{n.g.G.h&&(c.querySelector("input").checked=!0)},500)}).j().ha({id:"bgz-op2",textContent:"Use background overlay when painting.",style:"margin-right:5px;"},(a,c)=>{c.style.display="flex";c.querySelector("input").addEventListener("change",function(){n.g.G.na=!n.g.G.na;n.o()});setTimeout(()=>{n.g.G.na&&(c.querySelector("input").checked=!0)},500)}).j().ha({id:"bgz-op3",textContent:"Use highlighter on unpainted pixels.",style:"margin-right:5px;"},(a,c)=>{c.style.display="flex";c.querySelector("input").addEventListener("change",function(){n.g.G.la=!n.g.G.la;n.o()});setTimeout(()=>{n.g.G.la&&(c.querySelector("input").checked=!0)},500)}).j().ha({id:"bgz-op4",textContent:"Disable auto select by color.",style:"margin-right:5px;"},(a,c)=>{c.style.display="flex";c.querySelector("input").addEventListener("change",function(){n.g.G.select=!n.g.G.select;n.o()});setTimeout(()=>{n.g.G.select&&(c.querySelector("input").checked=!0)},500)}).j().j().Ea({id:"bgz-o",placeholder:`\u27d0 Status: Sleeping...\nVersion: ${X}`,readOnly:!0}).j().m({id:"bgz-6"}).m().k({id:"bgz-m",className:"bgz-D",innerHTML:"\ud83c\udfa8",title:"Template Color Converter"},(a,c)=>{c.addEventListener("click",()=>{window.open("https://pepoafonso.github.io/color_converter_wplace/","_blank","noopener noreferrer")})}).j().k({id:"bgz-n",className:"bgz-D",innerHTML:"\ud83c\udf10",title:"My GibHub page"},(a,c)=>{c.addEventListener("click",()=>{window.open("https://github.com/yui-ho/WPlace-GGliz/","_blank","noopener noreferrer")})}).j().j().bb().j().j().p(document.body);I.m({id:"bgz-9-overlay"},(a,c)=>{(new ResizeObserver(d=>{if(a.t?.u?.K)for(let f of d)a.t?.u?.wb(f)})).observe(c)}).m({id:"bgz-dockerDrag"}).j().m({id:"bgz-dockerContent"}).p(document.body);I.m({id:"floating-bottons",style:"position: fixed;left: 5px;top: 35%;transform: translateY(-50%);max-width: 180px;height: auto;display:grid;align-content:space-around;gap:4px;z-index:51"}).m({id:"menu-wrapper-bg",className:"menu-wrapper",style:"height:40px; display:flex;"}).m({className:"gg-izi",id:"bg-bg",title:"Background [On/Off]"}).m({className:"arrow",textContent:"\u00bb",style:"color: var(--color-bg);"}).j().k({id:"bg-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.1893 1.75H4.5C2.98122 1.75 1.75 2.98122 1.75 4.5V10.1893L10.1893 1.75ZM1.75 12.3107V15.6893L15.6893 1.75H12.3107L1.75 12.3107ZM17.8107 1.75L1.75 17.8107V19.5C1.75 19.9869 1.87652 20.4442 2.09848 20.8409L20.8409 2.09848C20.4442 1.87652 19.9869 1.75 19.5 1.75H17.8107ZM21.9015 3.15914L3.15914 21.9015C3.55582 22.1235 4.01313 22.25 4.5 22.25H6.18934L22.25 6.18934V4.5C22.25 4.01313 22.1235 3.55582 21.9015 3.15914ZM22.25 8.31066L8.31066 22.25H11.6893L22.25 11.6893V8.31066ZM22.25 13.8107L13.8107 22.25H19.5C21.0188 22.25 22.25 21.0188 22.25 19.5V13.8107Z" fill="currentColor"/></svg>',style:"color: var(--color-bg);"},(a,c)=>{setTimeout(()=>{a.t?.u?.Wa(c,"bg")},1E3)}).j().j().j().m({id:"menu-wrapper-wb",className:"menu-wrapper",style:"height:40px; display:flex;"}).m({className:"gg-izi",id:"gg-wrongs",title:"Highlighter [On/Off]"}).m({className:"arrow",textContent:"\u00bb",style:"color: var(--color-hl);"}).j().k({id:"wrongs",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2045 2.96963C13.4974 2.67677 13.9723 2.67679 14.2652 2.96967L22.0299 10.7344C22.1705 10.875 22.2495 11.0658 22.2495 11.2647C22.2495 11.4637 22.1705 11.6544 22.0298 11.7951L17.795 16.0292C17.5021 16.3221 17.0273 16.3221 16.7344 16.0292L8.96967 8.26448C8.82901 8.12382 8.74999 7.93304 8.75 7.73412C8.75001 7.53519 8.82904 7.34442 8.96971 7.20377L13.2045 2.96963ZM8.26071 9.32422L7.20313 10.3818C7.00457 10.5804 6.93375 10.873 7.0189 11.14C7.03956 11.3177 7.09106 11.8189 7.03675 12.1628C6.92988 12.8396 6.56515 13.8433 5.43842 14.97C5.14553 15.2629 5.14553 15.7378 5.43842 16.0307L8.96645 19.56C9.25935 19.8529 9.73422 19.8529 10.0271 19.56C11.1538 18.4333 12.1575 18.0685 12.8343 17.9617C13.1783 17.9074 13.6795 17.9588 13.8572 17.9795C14.1242 18.0647 14.4168 17.9938 14.6153 17.7953L15.6736 16.7371L8.26071 9.32422ZM1.96238 19.9755L4.74997 17.1094L7.87102 20.2315L7.01621 21.0425C6.87687 21.1747 6.6921 21.2484 6.50002 21.2484H2.50002C2.19857 21.2484 1.92641 21.0679 1.80912 20.7902C1.69183 20.5125 1.7522 20.1916 1.96238 19.9755Z" fill="currentColor"/></svg>',style:"color: var(--color-hl);"},(a,c)=>{setTimeout(()=>{a.t?.u?.Wa(c,"wrongs")},1E3)}).j().j().j().m({className:"gg-izi",id:"bgz-colorList",title:"List colors [hide/unhide]"}).k({id:"colorList-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512" fill="currentColor"><path d="M416,352c-12.6-.84-21-4-28-12-14-16-14-36,5.49-52.48l32.82-29.14c50.27-44.41,50.27-117.21,0-161.63C389.26,64.14,339.54,48,287.86,48c-60.34,0-123.39,22-172,65.11-90.46,80-90.46,210.92,0,290.87,45,39.76,105.63,59.59,165.64,60h1.84c60,0,119.07-19.5,161.2-56.77C464,390,464,385,444.62,355.56,440,348,431,353,416,352ZM112,208a32,32,0,1,1,32,32A32,32,0,0,1,112,208Zm40,135a32,32,0,1,1,32-32A32,32,0,0,1,152,343Zm40-199a32,32,0,1,1,32,32A32,32,0,0,1,192,144Zm64,271a48,48,0,1,1,48-48A48,48,0,0,1,256,415Zm72-239a32,32,0,1,1,32-32A32,32,0,0,1,328,176Z"/></svg>',style:"border: 3px solid #404040;background:#2d2d2d; color: #6b9af1"},(a,c)=>{c.onclick=()=>{n.g.J.enabled?(document.querySelector("#bgz-9-overlay").style.display=document.querySelector("#bgz-9-overlay").style.display=="flex"?"none":"flex",document.getElementById("bgz-colorList").classList.toggle("active")):document.querySelector("#bgz-dock-btn")?.click()}}).j().j().j().m({className:"gg-izi",id:"bgz-template",title:"Template [On/Off]"}).k({id:"template-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M17 2C17.5523 2 18 2.44772 18 3V6H21C21.5523 6 22 6.44772 22 7C22 7.55228 21.5523 8 21 8H18V16H21C21.5523 16 22 16.4477 22 17C22 17.5523 21.5523 18 21 18H18V21C18 21.5523 17.5523 22 17 22C16.4477 22 16 21.5523 16 21V18H8V21C8 21.5523 7.55228 22 7 22C6.44772 22 6 21.5523 6 21V18H3C2.44772 18 2 17.5523 2 17C2 16.4477 2.44772 16 3 16H6V8H3C2.44772 8 2 7.55228 2 7C2 6.44772 2.44772 6 3 6H6V3C6 2.44772 6.44772 2 7 2C7.55228 2 8 2.44772 8 3V6H16V3C16 2.44772 16.4477 2 17 2ZM8 16H16V8H8V16Z" fill="currentColor"/></svg>',style:"border: 3px solid #404040;background:#2d2d2d;color:white"},(a,c)=>{c.onclick=()=>{a.t.u.Ba=!a.t.u.Ba;a.t?.u?.Ba?(a.t?.u?.Ga(!0),a.A("\u27d0 Enabled templates!")):(a.t?.u?.Ga(!1),a.A("\u27d0 Disabled templates!"));document.getElementById("bgz-template").classList.toggle("active")};setTimeout(()=>{document.getElementById("bgz-template").classList.toggle("active");["floating-bottons","floating-bottons-right","top-bar","bgz-A"].forEach(d=>{(d=document.querySelector(`#${d}`))&&a.t?.u?.Ta(d)})},100)}).p(document.body);I.m({id:"bgz-image-preview"}).j().m({id:"preview"}).m({style:"color: white; margin-bottom: 15px; font-family: Arial, sans-serif;",innerHTML:"<h3>Color reduction was applied.</h3>"}).j().Fa({id:"bgz-iv"}).j().m({style:"margin-top: 15px;display: flex;gap: 10px;justify-content: center;"}).k({className:"bgz-preview",style:"background: #27ae60;",textContent:"\ud83d\udcbe Save"},(a,c)=>{c.addEventListener("click",function(){const d=document.createElement("a");d.href=document.querySelector("#bgz-iv")?document.querySelector("#bgz-iv").src:"";d.download=`WGliz-${Date.now()}.png`;d.click()})}).j().k({className:"bgz-preview",style:"background: #e74c3c;",textContent:"\u274c Close"},(a,c)=>{c.addEventListener("click",function(){document.querySelector("#bgz-image-preview")?document.querySelector("#bgz-image-preview").style.display="none":""})}).p(document.body);I.m({id:"top-bar",className:"top-bar"}).p(document.body);I.m({id:"floating-bottons-right",className:"floating-bottons",style:"position: fixed;right: 5px;top: 50%;transform: translateY(-50%);max-width: 170px;height: auto;display:grid;align-content:space-around;gap:4px;z-index:500"}).m({className:"gg-izi right",id:"gliz-search",title:"Fnd a place"}).k({id:"search-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor"><path d="M408 120C408 174.6 334.9 271.9 302.8 311.1C295.1 321.6 280.9 321.6 273.2 311.1C241.1 271.9 168 174.6 168 120C168 53.73 221.7 0 288 0C354.3 0 408 53.73 408 120zM288 152C310.1 152 328 134.1 328 112C328 89.91 310.1 72 288 72C265.9 72 248 89.91 248 112C248 134.1 265.9 152 288 152zM425.6 179.8C426.1 178.6 426.6 177.4 427.1 176.1L543.1 129.7C558.9 123.4 576 135 576 152V422.8C576 432.6 570 441.4 560.9 445.1L416 503V200.4C419.5 193.5 422.7 186.7 425.6 179.8zM150.4 179.8C153.3 186.7 156.5 193.5 160 200.4V451.8L32.91 502.7C17.15 508.1 0 497.4 0 480.4V209.6C0 199.8 5.975 190.1 15.09 187.3L137.6 138.3C140 152.5 144.9 166.6 150.4 179.8H150.4zM327.8 331.1C341.7 314.6 363.5 286.3 384 255V504.3L192 449.4V255C212.5 286.3 234.3 314.6 248.2 331.1C268.7 357.6 307.3 357.6 327.8 331.1L327.8 331.1z"/></svg>',style:"color: #4BE1C0; opacity:1"}).j().j().m({className:"gg-izi right",id:"gliz-home",title:"Go to home"}).k({id:"home-btn",className:"toggle-button-gg pulsar",innerHTML:'<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g> <d="M0 0h24v24H0z"/> <path fill-rule="nonzero" d="M20 20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9zm-2-1V9.157l-6-5.454-6 5.454V19h12zm-6-2l-3.359-3.359a2.25 2.25 0 1 1 3.182-3.182l.177.177.177-.177a2.25 2.25 0 1 1 3.182 3.182L12 17z"/> </g> </svg>',style:"color: #E95F7D; opacity:1;"},(a,c)=>{c.addEventListener("click",function(){const d=n.xb(n.g.ea);d&&(window.location.href=`https://wplace.live/?lat=${d.ib}&lng=${d.jb}&zoom=12`)})}).p(document.body);window.o=function(a){var c=document.querySelector("#bgz-69");const d=document.querySelector("#bgz-g"),f=n.H?.[0];if(d&&f?.B){var e=Object.entries(f.B).sort((k,q)=>(q[1].count||0)-(k[1].count||0));d.innerHTML="";c.innerHTML="";var g=document.createElement("div");g.id="dbz-1";g.style.cssText="font-size: 12px; font-weight: bold; padding: 1px; border-radius: 4px; text-align: center;overflow:hidden;";var h=a.L>0?Math.round(a.R/a.L*100):0;g.innerHTML=`\u27d0 <span style="color: #64b5f6">${a.R.toLocaleString()}</span>/<span>${a.L.toLocaleString()}</span> \u2022 <span style="color: ${h>=80?"#4caf50":h>=50?"#ff9800":"#f44336"}">${h}%</span> \u27d0`;c.appendChild(g);for(const [k,q]of e){const r=q;c=a.P[k]||{required:0,oa:0,left:0};g=document.createElement("div");g.style.cssText="display: flex; align-items: center; gap: 8px; margin: 4px 0; padding: 3px; font-size: 11px;";h=document.createElement("div");h.id="box-color";h.style.cssText=`width: 14px; height: 14px; border: 1px solid rgba(255,255,255,0.5); border-radius: 2px; flex-shrink: 0; ${r.enabled?"":"opacity: 0.4;"}`;const p=document.createElement("div");p.style.cssText="display: flex; flex-direction: column; gap: 2px; flex-grow: 1; min-width: 0; cursor: pointer;";const m=document.createElement("span");m.style.cssText=`font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${r.enabled?"":"opacity: 0.6;"}`;const u=document.createElement("span");u.style.cssText="font-size: 9px; opacity: 0.8;";if("other"===k)h.style.background="#888",m.textContent="Other";else if("222,250,206"===k)h.style.background="#deface",m.textContent="Template Guide";else{const [t,v,w]=k.split(",").map(Number);h.style.background=`rgb(${t},${v},${w})`;const x=f.$?.get(k);m.textContent=x?`${x.h?"\ud83d\udca7":"\u2705"}${x.name}`:`rgb(${t},${v},${w})`;p.setAttribute("name",x.name)}u.innerHTML=r.enabled?`<span style="color: #64b5f6">${c.oa.toLocaleString()}</span>/<span>${c.required.toLocaleString()}</span> \u2022 <span style="color: ${c.left>0?"#f44336":"#4caf50"}">${c.left.toLocaleString()}</span>`:`<span style="opacity: 0.6">0</span>/<span style="opacity: 0.6">${r.count.toLocaleString()}</span> \u2022 <span style="opacity: 0.6;color: ${c.left>0?"#f44336":"#4caf50"};">${c.left.toLocaleString()}</span>`;const l=document.createElement("input");l.type="checkbox";l.className="check";l.checked=r.enabled;l.style.cssText="flex-shrink: 0;";l.addEventListener("change",async()=>{if(n.g.U){document.querySelectorAll(".check").forEach(t=>{t!==this&&(t.checked=!1)});for(let t in e)e.hasOwnProperty(t)&&(e[t][1].enabled=!1);l.checked=!0;r.enabled=l.checked;I.A(`\u27d0 Enabled color ${k}.`)}else r.enabled=l.checked,I.A(`\u27d0 ${l.checked?"Enabled":"Disabled"} color ${k}.`);n.va()});p.addEventListener("click",async()=>{var t=document.getElementsByClassName("mb-4 mt-3");if(t=t[0]?t[0]:document.getElementById("paleta")){const v=p.getAttribute("name");(t=t.querySelector(v?`[aria-label="${v}"]`:"[aria-label]"))&&t.dispatchEvent(n.rb)}n.g.U&&(t=new Event("change",{bubbles:!0}),p.parentNode.querySelector("input").checked=!p.parentNode.querySelector("input").checked,p.parentNode.querySelector("input").dispatchEvent(t))});p.appendChild(m);p.appendChild(u);g.appendChild(l);g.appendChild(h);g.appendChild(p);d.appendChild(g)}a=Math.min(Object.keys(e).length*50+60,window.screen.height*.4);n.g.J.T.j=n.g.J.T.j==0?a:n.N?a:n.g.J.T.j;document.querySelector("#bgz-9-overlay").style.height=`${n.g.J.T.j}px`;n.o();n.N=!1;n.K&&document.querySelector("#bgz-9").classList.add("detached");n.ya(!0)}else d&&(d.innerHTML="<small>No template colors to display.</small>")};setInterval(()=>{n.ya();const a=document.querySelector("#bgz-69");a&&a.childElementCount>0&&document.querySelector("#home-btn").classList.remove("pulsar")},1500);setTimeout(()=>{n.Pa()},150)}();I.o();V.hb(I);(new MutationObserver(async b=>{var a=document.querySelector("#color-1"),c=document.querySelector("#bgz-t");a&&!c&&(c=document.createElement("button"),c.id="bgz-t",c.textContent="Move \u2191",c.className="btn btn-soft",c.onclick=function(){const e=this.parentNode.parentNode.parentNode.parentNode,g="Move \u2191"==this.textContent;e.parentNode.className=e.parentNode.className.replace(g?"bottom":"top",g?"top":"bottom");e.style.borderTopLeftRadius=g?"0px":"var(--radius-box)";e.style.borderTopRightRadius=g?"0px":"var(--radius-box)";e.style.borderBottomLeftRadius=g?"var(--radius-box)":"0px";e.style.borderBottomRightRadius=g?"var(--radius-box)":"0px";this.textContent=g?"Move \u2193":"Move \u2191"},a.parentNode.parentNode.parentNode.parentNode.querySelector("h2").parentNode?.appendChild(c));a=document.getElementsByClassName("gg-izi");c=document.getElementById("gg-pin");a.length>2&&!c&&document.querySelectorAll(".gg-izi:not(.right)").forEach(e=>{const g=document.createElement("div");g.id="gg-pin";e.appendChild(g)});a=document.querySelector("#top-bar");c=document.querySelector("#bgz-69");a&&c&&(a.id="top-bar-dock",a.style.zIndex="29",a.appendChild(c));for(let e of b)e.type==="childList"&&(e.addedNodes.forEach(g=>{if(g.classList&&g.classList.contains("maplibregl-marker")&&!g.classList.contains("text-yellow-400")){const r=document.createElement("div");r.id="gg-shot";r.style="position: fixed;";var h=document.createElement("div");h.className="toggle-button-gg";h.style="overflow:hidden;padding:15px; min-width:80px; min-height: 80px;opacity:1";h.innerHTML='<svg style="width:35px;height:35px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.67857 1.75H15.5V4H14.25C13.0074 4 12 5.00736 12 6.25C12 7.49264 13.0074 8.5 14.25 8.5H15.5V9.75C15.5 10.9926 16.5074 12 17.75 12C18.9926 12 20 10.9926 20 9.75V8.5H22.25V19.3214C22.25 20.9388 20.9388 22.25 19.3214 22.25H4.67857C3.06117 22.25 1.75 20.9388 1.75 19.3214V4.67857C1.75 3.06117 3.06117 1.75 4.67857 1.75ZM8.75001 11.002C9.23023 11.002 9.69078 11.1927 10.0303 11.5323L14 15.502L15.9697 13.5323C16.3092 13.1927 16.7698 13.002 17.25 13.002C17.7302 13.002 18.1908 13.1927 18.5303 13.5323L20.2976 15.2996V19.3214C20.2976 19.8606 19.8606 20.2976 19.3214 20.2976H4.67858C4.13945 20.2976 3.70239 19.8606 3.70239 19.3214V15.2996L7.46968 11.5323C7.80925 11.1927 8.26979 11.002 8.75001 11.002Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M17.75 1.75C18.3023 1.75 18.75 2.19772 18.75 2.75V5.25H21.25C21.8023 5.25 22.25 5.69772 22.25 6.25C22.25 6.80228 21.8023 7.25 21.25 7.25H18.75V9.75C18.75 10.3023 18.3023 10.75 17.75 10.75C17.1977 10.75 16.75 10.3023 16.75 9.75V7.25H14.25C13.6977 7.25 13.25 6.80228 13.25 6.25C13.25 5.69772 13.6977 5.25 14.25 5.25H16.75V2.75C16.75 2.19772 17.1977 1.75 17.75 1.75Z" fill="currentColor"/></svg>';const p=document.createElement("img");p.style="position:absolute;z-index:49;border-radius:50%;object-fit:cover;";h.addEventListener("click",function(){m.click()});let m;document.querySelector("#bgz-imageInput")?m=document.querySelector("#bgz-imageInput"):(m=document.createElement("input"),m.id="bgz-imageInput",m.type="file",m.accept="image/*",m.style.display="none",document.querySelector("#bgz-A")?.appendChild(m),m.addEventListener("change",function(){m.classList.remove("dithering");document.querySelector("#bgz-dwl")?.remove();const t=m.files[0];if(t&&t.type.startsWith("image/")){var v=new FileReader;v.onload=function(w){const x=document.getElementById("gg-shot")?.querySelector("img");x&&(x.src=w.target.result,document.getElementById("gg-shot").querySelector("svg").style.display="none",document.querySelector("#bgz-paint").classList.add("thumb"),M=="GG"&&(M=null,setTimeout(()=>{l.click()},500)))};v.readAsDataURL(t)}}));const u=document.createElement("button");u.id="bgz-dwl";u.className="toggle-button-gg";u.style="padding:2px;min-width:40px; min-height: 40px; color: #ffffff;opacity:1;position:absolute;right:-50%;bottom:-5%";u.innerHTML='<svg style="width:40px;height:40px;padding:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.71,6.29a1,1,0,0,0-1.42,0L20,7.59V2a1,1,0,0,0-2,0V7.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3A1,1,0,0,0,22.71,6.29ZM19,13a1,1,0,0,0-1,1v.38L16.52,12.9a2.79,2.79,0,0,0-3.93,0l-.7.7L9.41,11.12a2.85,2.85,0,0,0-3.93,0L4,12.6V7A1,1,0,0,1,5,6h8a1,1,0,0,0,0-2H5A3,3,0,0,0,2,7V19a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V14A1,1,0,0,0,19,13ZM5,20a1,1,0,0,1-1-1V15.43l2.9-2.9a.79.79,0,0,1,1.09,0l3.17,3.17,0,0L15.46,20Zm13-1a.89.89,0,0,1-.18.53L13.31,15l.7-.7a.77.77,0,0,1,1.1,0L18,17.21Z"/></svg>';u.addEventListener("click",async function(){const t=document.createElement("a");t.href=p.src;t.download=`WGliz-${Date.now()}.png`;t.click()});const l=document.createElement("button");l.id="bgz-paint";l.className="toggle-button-gg";l.style="padding:2px;min-width:40px; min-height: 40px; color: rgb(141 217 172 / 25%);opacity:1;position:absolute;right:-50%;bottom:55%";l.innerHTML='<svg style="width:40px;height:40px;padding:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor"><path d="M224 263.3C224.2 233.3 238.4 205.2 262.4 187.2L499.1 9.605C517.7-4.353 543.6-2.965 560.7 12.9C577.7 28.76 580.8 54.54 568.2 74.07L406.5 324.1C391.3 347.7 366.6 363.2 339.3 367.1L224 263.3zM320 400C320 461.9 269.9 512 208 512H64C46.33 512 32 497.7 32 480C32 462.3 46.33 448 64 448H68.81C86.44 448 98.4 429.1 96.59 411.6C96.2 407.8 96 403.9 96 400C96 339.6 143.9 290.3 203.7 288.1L319.8 392.5C319.9 394.1 320 397.5 320 400V400z"/></svg>';l.addEventListener("click",async function(){if(m.files[0]){const v=m.files[0]?.name.replace(/\.[^/.]+$/,"")||"WGliz_img";let w=document.querySelector("#bgz-h").textContent;w?w=w.match(/\d+/g).map(Number):!1;if(!w||w.length<4)n.v.A("\u27d0 Error getting coordinates.");else if(M=!1,(await n.aa(m.files[0],v,w)).pa===!0){n.v.A("\u27d0 Drew to canvas!");n.g.ea=w;n.o();n.K||n.qa();var t=new FileReader;t.onload=async function(x){U.C(x.target.result,v,w)};t.readAsDataURL(m.files[0])}else t=new FileReader,t.onload=async function(x){const H=new Image;H.onload=async function(){var F=n.Cb(H);M=!0;const A=F.toDataURL();F.toBlob(function(N){N=new File([N],v+".png",{type:"image/png"});const T=new DataTransfer;T.items.add(N);m.files=T.files},"image/png");p.src=A;m.classList.add("dithering");r.appendChild(u);document.querySelector("#bgz-iv").src=A;document.querySelector("#bgz-image-preview").style.display="flex";(F=await n.aa(F,v,w))?n.v.A("\u27d0 Drew! successfully reduced palette!"):n.v.A("\u27d0 Something went wrong...");F.pa&&F.ja&&(U.C(A,v,w),n.K||n.qa())};H.src=x.target.result},t.readAsDataURL(m.files[0])}else m.click(),M="GG"});if(m.files[0]){var k=m.files[0];const t=new FileReader;t.onload=function(v){p.src=v.target.result};t.readAsDataURL(k);l.classList.add("thumb");m.classList.contains("dithering")&&r.appendChild(u)}h.appendChild(p);r.appendChild(h);r.appendChild(l);document.body.appendChild(r);n.Ta(r);n.sb(g,r)}if(g.classList&&g.classList.contains("z-50")&&document.querySelector("#color-1")){function r(){var p=Object.entries(n.H[0].B).sort((m,u)=>(u[1].count||0)-(m[1].count||0));for(const [m,u]of p){const l=n.H[0].$?.get(m);p=g.querySelector(`[aria-label="${l.name}"]`);if(!p)continue;p.addEventListener("focus",function(){if(n.C!=l.name&&!n.g.G.select){n.xa(document.getElementById("bgz-96")||null,!0);var w=document.getElementById("bgz-g").querySelector(`[name="${l.name}"]`);w&&(w.parentElement.querySelector("input").checked=!0,w.parentElement.querySelector("input")?.dispatchEvent(q),n.C=l.name)}});const t=(u.fa/u.count*100).toFixed(1),v=document.createElement("div");v.id="bgz-666";v.getAttribute;v.className="font-bold text-center";v.style="position:absolute;font-size:11px;";v.innerHTML=`<span style="color: ${t>=80?"lime":t>=50?"darkorange":"crimson"}">${t}%</span>`;p.appendChild(v)}}n.ta=!0;document.querySelector("#floating-bottons-right").style.display="none";document.querySelector("#bgz-A").style.display="none";if(n.H?.[0]){var q=new Event("change",{bubbles:!0});(h=Object.values(g.querySelectorAll("path")).filter(p=>p.getAttribute("d").includes("12.5L705-555l76")))&&h.length>0&&h[0].addEventListener("click",function(){document.querySelector("#bgz-3")?.click();n.C=""});h=g.querySelector(`[aria-label="${n.C}"]`);k=document.getElementById("bgz-g").querySelector(`[name="${n.C}"]`);h&&k&&n.C!=""&&!n.g.G.select&&(n.xa(document.getElementById("bgz-96")||null,!0),k.parentElement.querySelector("input").checked=!0,k.parentElement.querySelector("input")?.dispatchEvent(q));r();h=Object.values(g.querySelectorAll("path")).filter(p=>["300-300l58-58","m356-160-56-56"].some(m=>p.getAttribute("d").includes(m)));h&&h.length<=0||(h=h[0].parentNode.parentNode,h.addEventListener("click",function(){setTimeout(()=>{document.querySelectorAll("#bgz-666").forEach(p=>{p.remove()});r()},500)}))}}}),e.removedNodes.forEach(g=>{g.classList&&g.classList.contains("maplibregl-marker")&&document.querySelectorAll("#gg-shot").forEach(h=>{h?.remove()});g.classList&&g.classList.contains("z-50")&&g.querySelector("#color-1")&&(document.querySelector("#bgz-3")?.click(),document.querySelector("#floating-bottons-right").style.display="grid",document.querySelector("#bgz-A").style.display="",n.ta=!1)}));const d=document.querySelector("#bgz-bg-controls");b=document.querySelector("#menu-wrapper-bg");d&&b&&(d.id="zbg-controls",d.style="",d.style.display="none",d.className="menu-bar",b.appendChild(d),document.addEventListener("mousedown",function(e){!d.contains(e.target)&&e.target!==d&&d.classList.contains("active")&&(d.classList.remove("active"),setTimeout(()=>{d.style.display="none"},250))}),document.addEventListener("touchstart",function(e){!d.contains(e.target)&&e.target!==d&&d.classList.contains("active")&&(d.classList.remove("active"),setTimeout(()=>{d.style.display="none"},250))}));const f=document.querySelector("#bgz-error-highlight");b=document.querySelector("#menu-wrapper-wb");f&&b&&(f.id="z-error-highlight",f.style="",f.style.display="none",f.className="menu-bar",b.appendChild(f),document.addEventListener("mousedown",function(e){!f.contains(e.target)&&e.target!==f&&f.classList.contains("active")&&(f.classList.remove("active"),setTimeout(()=>{f.style.display="none"},250))}),document.addEventListener("touchstart",function(e){!f.contains(e.target)&&e.target!==f&&f.classList.contains("active")&&(f.classList.remove("active"),setTimeout(()=>{f.style.display="none"},250))}))})).observe(document.body,{childList:!0,subtree:!0});(0,console.log)(`%c${W}%c (${X}) userscript has loaded!`,"color: cornflowerblue;","")})();







