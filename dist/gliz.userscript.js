// ==UserScript==
// @name         BM âŸ Gliz
// @version      1.73.0
// @description  A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided "as is" under the MPL-2.0 license. The "Blue Marble" icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.
// @author       GGizzi
// @license      MPL-2.0
// @icon         https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true
// @updateURL    https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @downloadURL  https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @match        https://wplace.live/*
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM.setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @resource     Style-File https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz-style.user.css?vr=1.73.0
// ==/UserScript==

(()=>{function O(c,a){for(let b=0;b<a;b++)c=c?.parentElement;return c}function ra(c){c=atob(c);const a=new Uint8Array(c.length);for(let b=0;b<c.length;b++)a[b]=c.charCodeAt(b);return a}var ha=(c,a,b)=>{if(a.has(c))throw TypeError("Cannot add the same private member more than once");return a instanceof WeakSet?a.add(c):a.set(c,b)},H=(c,a,b)=>{if(!a.has(c))throw TypeError("Cannot access private method");return b},aa=class{constructor(c,a){ha(this,L);this.name=c;this.version=a;this.t=null;this.W="bgz-o";this.ja=this.A=null;this.Da=[]}u(c){this.t=c}h(){return this.Da.length>0&&(this.ja=this.Da.pop()),this}p(c){c?.appendChild(this.A);this.ja=this.A=null;this.Da=[]}o(c={},a=()=>{}){return a(this,H(this,L,P).call(this,"div",{},c)),this}la(c={}){H(this,L,P).call(this,"p",{},c);return this}sb(){H(this,L,P).call(this,"small",{},{textContent:"By GGizzi \u2022 SwingTheVine",style:"margin-top: auto;"});return this}Ha(c={},a=()=>{}){return a(this,H(this,L,P).call(this,"img",{},c)),this}rb(){H(this,L,P).call(this,"h1",{},{textContent:"\u2237WGLIZ\u2237"});return this}Ua(){H(this,L,P).call(this,"hr",{},{});return this}ba(c={},a=()=>{}){const b=H(this,L,P).call(this,"label",{textContent:c.textContent??""});delete c.textContent;c=H(this,L,P).call(this,"input",{type:"checkbox"},c);return b.insertBefore(c,b.firstChild),this.h(),a(this,b,c),this}k(c={},a=()=>{}){return a(this,H(this,L,P).call(this,"button",{},c)),this}Ga(c={},a=()=>{}){return a(this,H(this,L,P).call(this,"input",{},c)),this}Sa(c={},a=()=>{}){return a(this,H(this,L,P).call(this,"textarea",{},c)),this}ma(c,a,b=!1){(c=document.getElementById(c.replace(/^#/,"")))&&(c instanceof HTMLInputElement?c.value=a:b?c.textContent=a:c.innerHTML=a)}m(){var c="#bgz-A",a="#bgz-z";let b,d=!1,e=0,g=null,f=0,l=0,k=0,u=0;if(c=document.querySelector("#"==c?.[0]?c:"#"+c),a=document.querySelector("#"==a?.[0]?a:"#"+a),c&&a){var t=()=>{if(d){const p=Math.abs(l-u);(Math.abs(f-k)>.5||p>.5)&&(f=k,l=u,c.style.transform=`translate(${f}px, ${l}px)`,c.style.left="0px",c.style.top="0px",c.style.right="");g=requestAnimationFrame(t)}},r=null,n=(p,w)=>{d=!0;r=c.getBoundingClientRect();b=p-r.left;e=w-r.top;(p=window.getComputedStyle(c).transform)&&"none"!==p?(p=new DOMMatrix(p),f=p.m41,l=p.m42):(f=r.left,l=r.top);k=f;u=l;document.body.style.userSelect="none";a.classList.add("dragging");g&&cancelAnimationFrame(g);t()},q=()=>{d=!1;g&&(cancelAnimationFrame(g),g=null);document.body.style.userSelect="";a.classList.remove("dragging")};a.addEventListener("mousedown",function(p){p.preventDefault();n(p.clientX,p.clientY)});a.addEventListener("touchstart",function(p){const w=p?.touches?.[0];w&&(n(w.clientX,w.clientY),p.preventDefault())},{passive:!1});document.addEventListener("mousemove",function(p){d&&r&&(k=p.clientX-b,u=p.clientY-e)},{passive:!0});document.addEventListener("touchmove",function(p){if(d&&r){const w=p?.touches?.[0];w&&(k=w.clientX-b,u=w.clientY-e,p.preventDefault())}},{passive:!1});document.addEventListener("mouseup",q);document.addEventListener("touchend",q);document.addEventListener("touchcancel",q)}else this.Ia(`Can not drag! ${c?"":"moveMe"} ${c||a?"":"and "}${a?"":"MoveThis "}was not found!`)}C(c){(0,console.info)(`${this.name}: ${c}`);this.ma(this.W,"Status: "+c,!0)}Ia(c){(0,console.error)(`${this.name}: ${c}`);this.ma(this.W,"Error: "+c,!0)}};var L=new WeakSet;var P=function(c,a={},b={}){c=document.createElement(c);this.A?(this.ja?.appendChild(c),this.Da.push(this.ja),this.ja=c):(this.A=c,this.ja=c);for(const [d,e]of Object.entries(a))c[d]=e;for(const [d,e]of Object.entries(b))c[d]=e;return c};var Q,ba=[{id:0,i:!1,name:"Transparent",j:[0,0,0]},{id:1,i:!1,name:"Black",j:[0,0,0]},{id:2,i:!1,name:"Dark Gray",j:[60,60,60]},{id:3,i:!1,name:"Gray",j:[120,120,120]},{id:4,i:!1,name:"Light Gray",j:[210,210,210]},{id:5,i:!1,name:"White",j:[255,255,255]},{id:6,i:!1,name:"Deep Red",j:[96,0,24]},{id:7,i:!1,name:"Red",j:[237,28,36]},{id:8,i:!1,name:"Orange",j:[255,127,39]},{id:9,i:!1,name:"Gold",j:[246,170,9]},{id:10,i:!1,name:"Yellow",j:[249,221,59]},{id:11,i:!1,name:"Light Yellow",j:[255,250,188]},{id:12,i:!1,name:"Dark Green",j:[14,185,104]},{id:13,i:!1,name:"Green",j:[19,230,123]},{id:14,i:!1,name:"Light Green",j:[135,255,94]},{id:15,i:!1,name:"Dark Teal",j:[12,129,110]},{id:16,i:!1,name:"Teal",j:[16,174,166]},{id:17,i:!1,name:"Light Teal",j:[19,225,190]},{id:18,i:!1,name:"Dark Blue",j:[40,80,158]},{id:19,i:!1,name:"Blue",j:[64,147,228]},{id:20,i:!1,name:"Cyan",j:[96,247,242]},{id:21,i:!1,name:"Indigo",j:[107,80,246]},{id:22,i:!1,name:"Light Indigo",j:[153,177,251]},{id:23,i:!1,name:"Dark Purple",j:[120,12,153]},{id:24,i:!1,name:"Purple",j:[170,56,185]},{id:25,i:!1,name:"Light Purple",j:[224,159,249]},{id:26,i:!1,name:"Dark Pink",j:[203,0,122]},{id:27,i:!1,name:"Pink",j:[236,31,128]},{id:28,i:!1,name:"Light Pink",j:[243,141,169]},{id:29,i:!1,name:"Dark Brown",j:[104,70,52]},{id:30,i:!1,name:"Brown",j:[149,104,42]},{id:31,i:!1,name:"Beige",j:[248,178,119]},{id:32,i:!0,name:"Medium Gray",j:[170,170,170]},{id:33,i:!0,name:"Dark Red",j:[165,14,30]},{id:34,i:!0,name:"Light Red",j:[250,128,114]},{id:35,i:!0,name:"Dark Orange",j:[228,92,26]},{id:36,i:!0,name:"Light Tan",j:[214,181,148]},{id:37,i:!0,name:"Dark Goldenrod",j:[156,132,49]},{id:38,i:!0,name:"Goldenrod",j:[197,173,49]},{id:39,i:!0,name:"Light Goldenrod",j:[232,212,95]},{id:40,i:!0,name:"Dark Olive",j:[74,107,58]},{id:41,i:!0,name:"Olive",j:[90,148,74]},{id:42,i:!0,name:"Light Olive",j:[132,197,115]},{id:43,i:!0,name:"Dark Cyan",j:[15,121,159]},{id:44,i:!0,name:"Light Cyan",j:[187,250,242]},{id:45,i:!0,name:"Light Blue",j:[125,199,255]},{id:46,i:!0,name:"Dark Indigo",j:[77,49,184]},{id:47,i:!0,name:"Dark Slate Blue",j:[74,66,132]},{id:48,i:!0,name:"Slate Blue",j:[122,113,196]},{id:49,i:!0,name:"Light Slate Blue",j:[181,174,241]},{id:50,i:!0,name:"Light Brown",j:[219,164,99]},{id:51,i:!0,name:"Dark Beige",j:[209,128,81]},{id:52,i:!0,name:"Light Beige",j:[255,197,165]},{id:53,i:!0,name:"Dark Peach",j:[155,82,73]},{id:54,i:!0,name:"Peach",j:[209,128,120]},{id:55,i:!0,name:"Light Peach",j:[250,182,164]},{id:56,i:!0,name:"Dark Tan",j:[123,99,82]},{id:57,i:!0,name:"Tan",j:[156,132,107]},{id:58,i:!0,name:"Dark Slate",j:[51,57,65]},{id:59,i:!0,name:"Slate",j:[109,117,141]},{id:60,i:!0,name:"Light Slate",j:[179,185,209]},{id:61,i:!0,name:"Dark Stone",j:[109,100,63]},{id:62,i:!0,name:"Stone",j:[148,140,107]},{id:63,i:!0,name:"Light Stone",j:[205,197,158]}],ma=class{constructor({displayName:c="My template",ta:a=0,Ya:b="",url:d="",file:e=null,coords:g=null,T:f=null,S:l=1E3}={}){this.m=null;this.displayName=c;this.ta=a;this.Ya=b;this.url=d;this.file=e;this.coords=g;this.T=f;this.S=l;this.D=this.u=0;this.B={};this.Sa={};this.q=new Set;this.H=null;c=Array.isArray(ba)?ba:[];this.na=new Set(c.filter(k=>"transparent"!==(k?.name||"").toLowerCase()&&Array.isArray(k?.j)).map(k=>`${k.j[0]},${k.j[1]},${k.j[2]}`));this.na.add("222,250,206");this.na.add("other");this.da=new Map(c.filter(k=>Array.isArray(k?.j)).map(k=>[`${k.j[0]},${k.j[1]},${k.j[2]}`,{id:k.id,i:!!k.i,name:k.name}]));try{const k=c.find(u=>"transparent"===(u?.name||"").toLowerCase());k&&Array.isArray(k.j)&&this.da.set("222,250,206",{id:k.id,i:!!k.i,name:k.name})}catch(k){}try{this.da.set("other",{id:"other",i:!1,name:"Other"})}catch(k){}}async J(){const c=Q===!0?this.file:await createImageBitmap(this.file),a=c.width,b=c.height;this.u=a*b;try{this.m=new OffscreenCanvas(a,b);var d=this.m.getContext("2d",{ib:!0,willReadFrequently:!0});d.imageSmoothingEnabled=!1;d.clearRect(0,0,a,b);d.drawImage(c,0,0);var e=d.getImageData(0,0,a,b).data,g=d=0,f=new Map;for(var l=0;l<b;l++)for(var k=0;k<a;k++){var u=4*(l*a+k),t=e[u],r=e[u+1],n=e[u+2];if(0!==e[u+3]){222===t&&250===r&&206===n&&g++;var q=this.na.has(`${t},${r},${n}`)?`${t},${r},${n}`:"other";if(q=="other"&&!Q)return{Wa:e,Xa:d,ya:!0};d++;f.set(q,(f.get(q)||0)+1)}}this.D=d;e={};for(const [w,v]of f.entries())e[w]={count:v,enabled:!0,ia:0};this.B=e}catch(w){this.D=Math.max(0,this.u)}f={};e={};t=new OffscreenCanvas(this.S,this.S);r=t.getContext("2d",{ib:!0,willReadFrequently:!0});for(n=this.coords[3];n<b+this.coords[3];){q=Math.min(this.S-n%this.S,b-(n-this.coords[3]));for(d=this.coords[2];d<a+this.coords[2];){g=Math.min(this.S-d%this.S,a-(d-this.coords[2]));l=3*g;k=3*q;t.width=l;t.height=k;r.imageSmoothingEnabled=!1;r.clearRect(0,0,l,k);r.drawImage(c,d-this.coords[2],n-this.coords[3],g,q,0,0,3*g,3*q);u=r.getImageData(0,0,l,k);for(var p=0;p<k;p++)for(let w=0;w<l;w++){const v=4*(p*l+w);222===u.data[v]&&250===u.data[v+1]&&206===u.data[v+2]?((w+p)%2==0?(u.data[v]=0,u.data[v+1]=0,u.data[v+2]=0):(u.data[v]=255,u.data[v+1]=255,u.data[v+2]=255),u.data[v+3]=32):w%3!=1||p%3!=1?u.data[v+3]=0:this.na.has(`${u.data[v]},${u.data[v+1]},${u.data[v+2]}`)}r.putImageData(u,0,0);l=`${(this.coords[0]+Math.floor(d/1E3)).toString().padStart(4,"0")},${(this.coords[1]+Math.floor(n/1E3)).toString().padStart(4,"0")},${(d%1E3).toString().padStart(3,"0")},${(n%1E3).toString().padStart(3,"0")}`;f[l]=await createImageBitmap(t);this.q.add(l.split(",").slice(0,2).join(","));k=await (await t.convertToBlob()).arrayBuffer();k=Array.from(new Uint8Array(k));u="";for(p=0;p<k.length;p++)u+=String.fromCharCode(k[p]);e[l]=btoa(u);d+=g}n+=q}return{Wa:f,Xa:e,ya:Q=!0,ua:this.m}}},Y=class{constructor(){this.duration=0;this.D=this.endTime=this.startTime=null;this.m=!1;this.u=null}J(c,a){!c||c<=0||(this.m&&this.H(),this.duration=c,this.startTime=new Date(a),this.endTime=new Date(this.startTime.getTime()+this.duration*1E3),this.m=!0,this.M(),this.D=setInterval(()=>{this.M()},1E3))}V(c,a){!c||c<=0||!this.m||(this.H(),this.J(c,a))}H(){this.D&&(clearInterval(this.D),this.D=null);this.m=!1}M(){const c=Math.max(0,this.endTime-new Date);if(c<=0)this.N();else{if(!document.querySelector("#bgz-timer")){const a=Object.values(document.querySelectorAll(".z-30")).filter(d=>d.nodeName=="BUTTON"&&d.querySelector("canvas"));if(a.length<=0)return;const b=document.createElement("div");b.className="text-xs";b.id="bgz-timer";b.style="position:fixed;bottom:0px;color:darkviolet;font-weight:bolder;";a[0].appendChild(b)}this.u=document.querySelector("#bgz-timer");this.u.textContent=`(Full in: ${this.U(c)})`}}N(){this.H();this.u&&(this.u.textContent="")}U(c){c=Math.floor(c/1E3);const a=Math.floor(c/60),b=Math.floor(a/60);return b>0?`${b}h ${a%60}m ${c%60}s`:a>0?`${a}m ${c%60}s`:`${c}s`}},sa=class{constructor(){this.m=JSON.parse(GM_getValue("GGImgList",'{"uuid":"", "l": []}'));this.isVisible=!1;this.H=this.D=this.container=null}J(){GM.setValue("GGImgList",JSON.stringify(this.m))}N(){return"img_"+Date.now()}U(c,a,b){const d=parseFloat((c.length*.75/1024).toFixed(1)),e=this.N(),g={};g.name=a;g.coords=b;g.date=(new Date).toISOString();g.size=d;g.s=0;g.key=e;g.active=!0;this.m.l.forEach(f=>{f.active=!1});this.m.l.unshift(g);this.J();try{GM.setValue(e,c)}catch(f){console.warn(f)}return e}za(c){this.m.l=this.m.l.filter(a=>a.key!==c);GM_deleteValue(c);this.J()}ea(c){return GM_getValue(c)}Ca(c){this.m.l.forEach(b=>b.active=!1);const a=this.m.l.find(b=>b.key===c);a&&(a.active=!0);this.m.l.sort((b,d)=>(d.active?1:0)-(b.active?1:0));this.J()}ga(c){this.m.l.forEach(a=>{a.active=!1});this.J();this.M(c)}oa(c){const a=c.split(";")[0].split(":")[1];c=atob(c.split(",")[1]);const b=new Uint8Array(c.length);for(let d=0;d<c.length;d++)b[d]=c.charCodeAt(d);return new Blob([b],{type:a})}pa(c){return new Promise((a,b)=>{const d=new FileReader;d.onloadend=()=>a(d.result);d.onerror=b;d.readAsDataURL(c)})}qa(){this.container=document.getElementById("bgz-imageViewerContainer");(this.D=document.getElementById("templates-btn"))&&(this.D.onclick=this.V)}V=()=>{this.container&&(this.container.classList.remove("viewer-hidden"),this.container.classList.add("viewer-visible"),this.isVisible=!0,this.D&&this.D.classList.add("hidden"))};Ba(){this.container&&(this.container.classList.remove("viewer-visible"),this.container.classList.add("viewer-hidden"),this.isVisible=!1,setTimeout(()=>{this.D&&this.D.classList.remove("hidden")},400))}ha(){this.isVisible?this.Ba():this.V()}u(c,a=!1){if(!Array.isArray(c)||c.length!==4)return null;const b=(1E3*c[0]+c[2])/2048E3*360-180;c=360/Math.PI*(Math.atan(Math.exp(Math.PI-2*Math.PI*((1E3*c[1]+c[3])/2048E3)))-Math.PI/4);return a?`https://wplace.live/?lat=${c}&lng=${b}&zoom=15`:{ub:c,wb:b}}xa=(c,a,b)=>{c.g.aa=a;c.g.selected=!0;c.K();this.Ca(b);setTimeout(()=>{document.location.href=this.u(a,!0)},150)};fa(c){this.qa();const a=this.m.l,b=document.getElementById("bgz-imagesList"),d=document.getElementById("bgz-imageCount");b&&(d&&(d.textContent=a.length),a.length===0?b.innerHTML='<div class="bgz-empty-state">There are no saved templates</div>':a.forEach(e=>{var g=e.active?"active":!1;const f=document.querySelector(".bgz-image-item").cloneNode(!0);f.classList.remove("active");g&&f.classList.add(g);f.querySelector(".bgz-image-name").textContent=e.name;const l=f.querySelector(".bgz-image-status");l.classList.remove("active");g&&l.classList.add(g);l.textContent=e.active?"ACTIVE":"inactive";let k=document.querySelector(`.bgz-preview-img[data-key="${e.key}"]`);k?f.querySelector(".bgz-preview-img").replaceWith(k):(g=this.ea(e.key),k=f.querySelector(".bgz-preview-img"),k.setAttribute("data-key",e.key),k.src=g,k.alt=e.name,k.onerror=()=>{k.style.display="none"});g=f.querySelector(".bgz-img-prog");g.textContent=`Progress: ${e.s}%`;g.style.color=e.s>=85?"#4caf4f":e.s>=50?"#ff9900":"#f44336";g=f.querySelector(".bgz-image-link");g.textContent=`\u2708\ufe0f: ${this.u(e.coords,!0)}`;g.onclick=()=>{document.location.href=this.u(e.coords,!0)};f.querySelector(".btn-draw").onclick=()=>{this.xa(c,e.coords,e.key)};f.querySelector(".btn-download").onclick=()=>{this.wa(e.key,e.coords)};f.querySelector(".btn-delete").onclick=()=>{confirm(`'\u00bfDelete ${e.name}?'`)&&(this.za(e.key),this.M(c))};b.appendChild(f)}))}M(c){document.querySelectorAll(".bgz-preview-img[data-key]").forEach(a=>{document.querySelector("#bgz-back")?.appendChild(a)});document.querySelector("#bgz-imagesList").innerHTML="";this.fa(c)}wa(c,a){const b=this.ea(c);if(b){const d=document.createElement("a");d.href=b;d.download=`[${a.join(",")}]WG${c}`;d.click()}else R.m("\u27d0 Error downloading the image")}};const R=new class{constructor(){this.u=null;this.D()}D(){this.u=document.createElement("div");this.u.className="infoBox";document.body.appendChild(this.u)}m(c,a=2500){const b=document.createElement("div");b.className="info";b.textContent=c;this.u.appendChild(b);setTimeout(()=>{b.style.opacity="1";b.style.transform="translateY(0)"},10);setTimeout(()=>{b.style.opacity="0";b.style.transform="translateY(-40px)";setTimeout(()=>{b.parentNode&&b.parentNode.removeChild(b)},300)},a)}},ia=new Y,y=new sa;var ja=new WeakSet;var ta=async function(){GM.setValue("GGTemplates",JSON.stringify(this.L))};var ua=async function(c){c=c.hb;if(Object.keys(c).length>0){for(const g in c){const f=g;var a=c[g];if(c.hasOwnProperty(g)){var b=f.split(" "),d=Number(b?.[0]);b=b?.[1]||"0";const l=a.name||`Template ${d||""}`,k=a.Fb;a={};let u=0;const t=new Map;for(const n in k)if(k.hasOwnProperty(n)){var e=ra(k[n]);e=await createImageBitmap(new Blob([e],{type:"image/png"}));a[n]=e;try{const q=e.width,p=e.height,w=(new OffscreenCanvas(q,p)).getContext("2d",{ib:!0,willReadFrequently:!0});w.imageSmoothingEnabled=!1;w.clearRect(0,0,q,p);w.drawImage(e,0,0);const v=w.getImageData(0,0,q,p).data;for(e=0;e<p;e++)for(let x=0;x<q;x++){if(x%this.eb!==1||e%this.eb!==1)continue;const E=4*(e*q+x),z=v[E],G=v[E+1],T=v[E+2];if(v[E+3]<64)continue;if(222===z&&250===G&&206===T)continue;u++;const C=this.na.has(`${z},${G},${T}`)?`${z},${G},${T}`:"other";t.set(C,(t.get(C)||0)+1)}}catch(q){}}const r=new ma({displayName:l,ta:d||this.G?.length||0,Ya:b||""});r.T=a;r.D=u;d={};for(const [n,q]of t.entries())d[n]={count:q,enabled:!0,ia:0};r.B=d;try{Object.keys(a).forEach(n=>{r.q?.add(n.split(",").slice(0,2).join(","))})}catch(n){}try{if(d=c?.[f]?.zb)for(const [n,q]of Object.entries(d))r.B[n]?r.B[n].enabled=!!q?.enabled:r.B[n]={count:q?.count||0,enabled:!!q?.enabled,ia:q?.ia||0}}catch(n){}r.H=f;this.G.push(r)}}try{const g=document.querySelector("#bgz-9");g&&g.classList.add("oklch");window.postMessage({source:"bmz-gliz",Fa:"bgz-b"},"*")}catch(g){}}};var va=new WeakSet;var ca=GM_info.script.name.toString(),da=GM_info.script.version.toString();!function(c){const a=document.createElement("script");a.setAttribute("bgz-E",ca);a.setAttribute("bgz-B","color: cornflowerblue;");a.textContent=`(${c})();`;document.documentElement?.appendChild(a);a.remove()}(()=>{const c=document.currentScript,a=c?.getAttribute("bgz-E")||"BM \u27d0 Gliz",b=c?.getAttribute("bgz-B")||"",d=new Map;window.addEventListener("message",g=>{var f=g.data.source;const l=g.data.endpoint,k=g.data.Ma;g=g.data.La;if(Date.now(),"bmz-gliz"==f&&k&&g&&!l)f=d.get(k),"function"==typeof f?f(g):(0,console.warn)(`%c${a}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`,b,"",k),d.delete(k)});const e=window.fetch;window.fetch=async function(...g){try{const [u,t]=g;var f=typeof u==="string"?u:u?.url;const r=t?.method||(u instanceof Request?u.method:"GET");f&&r==="GET"&&f.includes("/tiles/")&&window.postMessage({source:"load",endpoint:f})}catch(u){console.warn("Verrify request.",u)}f=await e.apply(this,g);const l=f.clone(),k=(g[0]instanceof Request?g[0]?.url:g[0])||"ignore";g=l.headers.get("content-type")||"";if(g.includes("application/json"))l.json().then(u=>{window.postMessage({source:"bmz-gliz",endpoint:k,tb:u},"*")}).catch(()=>{});else if(g.includes("image/")&&!k.includes("openfreemap")&&!k.includes("maps")){window.postMessage({source:"load",endpoint:k});const u=Date.now(),t=await l.blob();return(new Promise(r=>{const n=crypto.randomUUID();d.set(n,q=>{r(new Response(q,{headers:l.headers,status:l.status,statusText:l.statusText}))});window.postMessage({source:"bmz-gliz",endpoint:k,Ma:n,La:t,blink:u})})).catch(()=>{Date.now()})}return f}});var v = GM_getResourceText("Style-File");GM_addStyle(v);Y=document.createElement("link");Y.href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap";Y.rel="preload";Y.as="style";Y.onload=function(){this.onload=null;this.rel="stylesheet"};document.head?.appendChild(Y);new class{constructor(){}observe(c,a=!1,b=!1){c.observe(null,{childList:a,subtree:b})}};var I=new aa(ca,da),h=(new aa(ca,da),new class{constructor(c,a,b){ha(this,ja);this.name=c;this.version=a;this.A=b;this.ya=null;this.S=1E3;this.eb=3;this.G=[];this.L=null;this.ea=!0;this.H=new Map;this.g={};this.Pa=!0;this.bb=this.$a=this.Ba=-1;this.M=this.V=!1;this.fa="";this.qa=!1;this.m={Oa:"floating-bottons floating-bottons-right bgz-night bgz-9-overlay bgz-crt gg-shot top-bar-dock".split(" "),e:!0,d:[]};this.ga=!1;this.Lb=new MouseEvent("click",{bubbles:!0,cancelable:!0});this.g.ca={enabled:!1,Ab:{x:null,y:null,h:0}};this.g.I={active:!1,color:"#C300FF",type:1};this.g.F={i:!1,va:!0,Ea:!0,Aa:!1,select:!1};this.g.alpha="ff";this.g.backgroundColor="#1e1e1e";this.g.aa=[];this.g.P=!0;this.g.selected=null;this.g.ra=!1;this.Nb=ba.filter(d=>d.i===!1).map(d=>d.j);this.Bb=ba.map(d=>d.j);this.mb()}async mb(){var c=this.wa();let a=!1;try{this.oa(this.g).every(b=>this.oa(JSON.parse(GM_getValue("Settings","{}"))).includes(b))&&this.version==c.version&&(a=!0)}catch(b){a=!1}a?this.g=this.wa():(this.g.uuid=crypto.randomUUID(),this.K(),GM_deleteValue("GGTemplates"));this.backgroundColor=this.g.backgroundColor;this.g.alpha=this.g.alpha;this.u=this.g.ca.enabled;this.J=this.g.ca.Ab;this.aa=this.g.aa;this.g.version=this.version;c=JSON.parse(GM_getValue("GGTemplates","{}"));if(c.constructor===Object&&Object.keys(c).length>0&&!this.g.selected)this.nb(c);else if(this.g.selected=!1,this.za=y.m,y.m.uuid=this.g.uuid,this.za.l.length>0)try{let b=Object.values(this.za.l).filter(d=>d.active===!0);if(b.length>0){b=b[0];const d=b.key,e=b.name,g=b.coords,f=y.oa(GM_getValue(d)||"");Q=!1;(await this.U(f,e,g,d)).ua?this.A.C("\u27d0 Drew successfully!"):this.A.C("\u27d0 Error loading image...")}}catch(b){R.m("\u27d0 Error creating template")}}oa(c,a=""){let b=[];for(let d in c)typeof c[d]==="object"&&c[d]!==null?(b.push(a+d),b=b.concat(this.oa(c[d],a+d+"."))):b.push(a+d);return b}cb(c){c.addEventListener("touchmove",function(a){a.touches.length>1&&a.preventDefault()})}Hb(c,a){const b=c[0]-a[0],d=c[1]-a[1];c=c[2]-a[2];return Math.sqrt(b*b+d*d+c*c)}Eb(c,a){let b=Infinity,d=null;a.forEach(e=>{const g=this.Hb(c,e);g<b&&(b=g,d=e)});return d}Cb(c,a=100){const b=c.data,d=c.width,e=c.height,g=this.g.F.i?this.Bb:this.Nb;a=Math.max(0,Math.min(100,a))/100;for(let t=0;t<e;t++)for(let r=0;r<d;r++){var f=(t*d+r)*4;if(b[f+3]<128){b[f]=0;b[f+1]=0;b[f+2]=0;b[f+3]=0;continue}else b[f+3]=255;var l=b[f],k=b[f+1],u=b[f+2];const n=this.Eb([l,k,u],g);l-=n[0];k-=n[1];u-=n[2];b[f]=n[0];b[f+1]=n[1];b[f+2]=n[2];a>0&&(r+1<d&&(f=(t*d+(r+1))*4,b[f]+=l*7/16*a,b[f+1]+=k*7/16*a,b[f+2]+=u*7/16*a),r-1>=0&&t+1<e&&(f=((t+1)*d+(r-1))*4,b[f]+=l*3/16*a,b[f+1]+=k*3/16*a,b[f+2]+=u*3/16*a),t+1<e&&(f=((t+1)*d+r)*4,b[f]+=l*5/16*a,b[f+1]+=k*5/16*a,b[f+2]+=u*5/16*a),r+1<d&&t+1<e&&(f=((t+1)*d+(r+1))*4,b[f]+=l/16*a,b[f+1]+=k/16*a,b[f+2]+=u/16*a))}return c}ob(c){const a=new OffscreenCanvas(c.width,c.height),b=a.getContext("2d",{willReadFrequently:!0});b.drawImage(c,0,0);c=b.getImageData(0,0,c.width,c.height);c=this.Cb(c,this.g.F.va?70:0);b.putImageData(c,0,0);return a}Ca(c,a=!1){c&&(a?(this.g.X=a,c.style="background-color:#063912;",this.A.C("\u27d0 Enabled single select colors.")):(this.g.X=!this.g.X||!1,this.g.X?c.style="background-color:#063912;":c.style="background-color:#2d2d2d;",this.g.X?this.A.C("\u27d0 Enabled single select colors."):this.A.C("\u27d0 Disabled single select colors."),this.K()))}Mb(c,a){function b(){if(c&&a){let d=a.getBoundingClientRect(),e=c.getBoundingClientRect(),g=e.x-Math.ceil(Math.abs(d.width-e.width)/2);a.style.top=`${e.y-d.height-4}px`;a.style.left=`${g}px`;requestAnimationFrame(b)}}b()}wa(){return JSON.parse(GM_getValue("Settings","{}"))}K(){GM.setValue("Settings",JSON.stringify(this.g))}Gb(){this.u=!this.u;this.g.ca.enabled=this.u;this.K();this.ab();this.u?this.A.C("\u27d0 Undocked panel \u2022 drag it!"):this.A.C("\u27d0 Docked panel")}ab(){setTimeout(()=>{const c=document.querySelector("#bgz-9"),a=document.querySelector("#bgz-dock-btn");let b;const d=document.querySelector("#bgz-stats"),e=document.getElementById("bgz-9-overlay");if(c){if(document.getElementById("btn-clon"))b=document.getElementById("btn-clon");else{const g=document.createElement("div");g.className="ui-btn";b=a.cloneNode(!1);b.id="btn-clon";b.title="List colors";b.addEventListener("click",()=>{h.g.ca.enabled?document.querySelector("#bgz-9-overlay").style.display=document.querySelector("#bgz-9-overlay").style.display=="flex"?"none":"flex":document.querySelector("#bgz-dock-btn")?.click()});const f=document.createElement("button");f.id="bgz-uih";f.title="Hide GUI";f.onclick=()=>{for(let l=0;l<h.m.Oa.length;l++){const k=document.querySelector(`#${h.m.Oa[l]}`);k&&(k.style.display=h.m.e?(h.m.d[l]=k.style.display,"none"):h.m.d[l])}f.classList.toggle("hide-btn");h.m.e=!h.m.e};g.appendChild(b);g.appendChild(f);document.getElementById("bgz-A")?.appendChild(g)}this.u?(c.classList.add("detached"),a&&(a.classList.add("docked"),a.textContent="\u21f2"),O(c,2)!==e&&(c.style.display="grid",e.querySelector("#bgz-dockerContent").appendChild(c)),e.style.display="flex",e.style.top=this.J.y?this.J.y+"px":"140px",this.J.x?e.style.left=this.J.x+"px":(e.style.right="65px",e.style.left=""),this.Jb(e)):(a.textContent="\u21f1",e.style.display="none",c.classList.remove("detached"),a&&a.classList.remove("docked"),d&&c.parentElement!==d&&(window.getComputedStyle(document.getElementById("bgz-6")).display==="none"?c.style.display="none":c.style.display="block",d.appendChild(c)),c.style.position="",c.style.left="",c.style.top="",c.style.zIndex="",this.Ib(e))}},100)}Jb(c){let a=!1,b,d,e,g;const f=r=>r.touches&&r.touches.length>0?{x:r.touches[0].clientX,y:r.touches[0].clientY}:{x:r.clientX,y:r.clientY},l=r=>{if(r.target.closest("#bgz-dockerDrag")&&!r.target.closest("button, input, select")){var {x:n,y:q}=f(r);a=!0;b=n;d=q;var p=c.getBoundingClientRect();e=p.left;g=p.top;c.style.cursor="grabbing";c.style.transition="none";document.addEventListener("mousemove",k);document.addEventListener("mouseup",u);document.addEventListener("touchmove",k,{passive:!1});document.addEventListener("touchend",u);r.preventDefault()}},k=r=>{if(a){r.preventDefault();var {x:n,y:q}=f(r);r=q-d;c.style.left=e+(n-b)+"px";c.style.top=g+r+"px"}},u=()=>{a&&(a=!1,c.style.cursor="",c.style.transition="",document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",u),document.removeEventListener("touchmove",k),document.removeEventListener("touchend",u))};c.Ka=l;const t=c.querySelector("#bgz-dockerDrag");t&&(t.addEventListener("mousedown",l),t.addEventListener("touchstart",l,{passive:!1}))}Ib(c){const a=c.querySelector("#bgz-dockerDrag");a&&c.Ka&&(a.removeEventListener("mousedown",c.Ka),a.removeEventListener("touchstart",c.Ka),a.style.cursor="")}async xb(){return{Kb:this.name.replace(/\s+/g,""),Ub:this.version,Tb:"1.0.0",hb:{}}}async U(c,a,b,d=!1){this.L||(this.L=await this.xb());!y.H&&R.m(`\u27d0 Creating template at ${b.join(", ")}`);Q?this.A.C("\u27d0 Apply color converter..."):this.A.C(`\u27d0 Creating template at ${b.join(", ")}...`);c=new ma({displayName:a,file:c,coords:b});const {Wa:e,Xa:g,ya:f,ua:l}=await c.J();if(f&&!Q)return!1;h.H.clear();c.T=e;d&&(this.L.key=d);this.L.Na=!0;c.H="GG";this.L.hb.GG={name:c.displayName,coords:b.join(", "),enabled:!0,Fb:g,zb:c.B};this.G=[];this.G.push(c);d=(new Intl.NumberFormat).format(c.u);this.A.C(`\u27d0 Template created at ${b.join(", ")}! Total pixels: ${d}`);try{const k=document.querySelector("#bgz-9");k&&k.classList.add("oklch");window.postMessage({source:"bmz-gliz",Fa:"bgz-b"},"*")}catch(k){}await H(this,ja,ta).call(this);h.g.aa=b;h.K();return{Fa:!0,ua:l}}ha(c){c=c[0].toString().padStart(4,"0")+","+c[1].toString().padStart(4,"0");var a=this.G;if(a.sort((b,d)=>b.ta-d.ta),!a.some(b=>!!b?.T&&(b.q&&b.q.size>0?b.q.has(c):Object.keys(b.T).some(d=>d.startsWith(c)))))return null;a=a.map(b=>{const d=Object.keys(b.T).filter(e=>e.startsWith(c));return 0===d.length?null:d.map(e=>{const g=e.split(",");return{Ja:b.T[e],Qb:[g[0],g[1]],Va:[g[2],g[3]],Vb:b}})?.[0]}).filter(Boolean);return[a,a.length,c]}async P(c){try{const a=await createImageBitmap(c);c=new OffscreenCanvas(a.height,a.height);const b=c.getContext("2d",{willReadFrequently:!0});b.fillStyle="#191919";b.fillRect(0,0,a.width,a.height);b.drawImage(a,0,0);return await c.convertToBlob({type:"image/png"})}catch(a){return c}}async qb(c,a){if(!this.ea)return this.g.P?this.P(c):c;const b=this.S*3;a=this.ha(a);if(!a||a[1]===0)return this.g.P?this.P(c):c;const [d,e,g]=a;var f=await createImageBitmap(c);c=new OffscreenCanvas(b,b);a=c.getContext("2d",{willReadFrequently:!0});a.imageSmoothingEnabled=!1;this.g.P&&(a.fillStyle="#191919",a.fillRect(0,0,b,b));a.drawImage(f,0,0,b,b);f=null;try{f=a.getImageData(0,0,b,b).data}catch(p){}const l=this.G.find(p=>p.T&&Object.keys(p.T).some(w=>w.startsWith(g)));let k=0,u=0,t={},r=0;if(f)for(const p of d)try{const w=Number(p.Va[0])*3,v=Number(p.Va[1])*3,x=p.Ja.width,E=p.Ja.height,z=new OffscreenCanvas(x,E),G=z.getContext("2d",{willReadFrequently:!0});G.imageSmoothingEnabled=!1;G.drawImage(p.Ja,0,0);const T=G.getImageData(0,0,x,E),C=T.data,U=new OffscreenCanvas(x,E),J=U.getContext("2d",{willReadFrequently:!0});J.fillStyle=this.backgroundColor!=="transparent"?this.backgroundColor+this.g.alpha:"transparent";J.fillRect(0,0,x,E);const na=J.getImageData(0,0,x,E),oa=na.data;function pa(D,A,B,S,K,V=2,M){let Z=M===0?U:z;M=M===0?oa:C;for(let W=D-B;W<=D+B;W++)for(let F=A-B;F<=A+B;F++){var N=Math.abs(W-D)+Math.abs(F-A);if(N<=B){const X=(F*Z.width+W)*4;N=N>B-V?K:S;M[X]=N[0];M[X+1]=N[1];M[X+2]=N[2];M[X+3]=N[3]}}}function ea(D,A,B,S,K){let V=K===0?U:z;K=K===0?oa:C;let [M,Z,N,W]=S;for(S=-B;S<=B;S++)for(let X=-B;X<=B;X++){var F=D+X;const ka=A+S;F>=0&&F<V.width&&ka>=0&&ka<V.height&&(F=(ka*V.width+F)*4,K[F]=M,K[F+1]=Z,K[F+2]=N,K[F+3]=W)}}const qa=[],la=this.g.I.color.replace("#",""),fa=[parseInt(la.substr(0,2),16),parseInt(la.substr(2,2),16),parseInt(la.substr(4,2),16),255];for(let D=0;D<E;D++)for(let A=0;A<x;A++){if(A%3!==1||D%3!==1)continue;var n=w+A;const B=v+D;if(n<0||B<0||n>=b||B>=b)continue;if(!(this.backgroundColor==="transparent"||this.g.F.Ea&&this.M)){var q=4*(B*b+n);f[q+3]!==0&&f[q]!==25&&f[q+1]!==25&f[q+2]!==25&&ea(A,D,1,[0,0,0,0],0)}q=4*(D*x+A);if(C[q+3]<10)continue;const S=C[q],K=C[q+1],V=C[q+2],M=C[q+3];n=4*(B*b+n);const Z=f[n],N=f[n+1],W=f[n+2],F=f[n+3];n=`${S},${K},${V}`;l&&l.B&&l.B[n]&&(l.B[n].enabled&&r++,t[n]||(t[n]={p:0,w:0}),Z===S&&N===K&&W===V&&F===M?(k++,t[n].p+=1,C[q+3]=0):(F!==0&&Z!==25&&N!==25&W!==25?(u++,l.B[n].enabled&&(qa.push([A,D]),t[n].w+=1)):l.B[n].enabled&&this.g.I.active&&this.g.F.Aa&&(this.g.I.type==1?ea(A,D,1,fa,0):pa(A,D,2,fa,[0,255,0,255],1,0)),this.ga&&ea(A,D,1,[S,K,V,M],1)),l.B[n].enabled||(C[q+3]=0))}this.g.I.active&&qa.forEach(D=>{let [A,B]=D;this.g.I.type==1?ea(A,B,1,fa,0):pa(A,B,4,fa,[0,255,0,255],1,0)});J.putImageData(na,0,0);G.putImageData(T,0,0);a.drawImage(U,w,v);a.drawImage(z,w,v)}catch(w){console.warn("Error calculating pixel stats:",w)}e>0?this.H.set(g,{Ob:k,required:r,Pb:u,$:t}):this.A.C(`\u27d0 Displaying ${e} templates.`);setTimeout(()=>{document.querySelector("#bgz-ld")?.classList.remove("loader-inline");h.L?.Na&&(h.L.Na=!1,h.V=!0,h.N())},150);return await c.convertToBlob({type:"image/png"})}nb(c){Object.keys(c).length!==0||c.constructor!==Object?this.L=c:"*";"BM\u27d0Gliz"==c?.Kb&&H(this,ja,ua).call(this,c)}Ta(c){this.ea=c}Za(c,a){for(let b in c){const d=c[b];typeof d==="object"&&d!==null?(a[b]||(a[b]={}),this.Za(d,a[b])):a[b]=(a[b]||0)+d}}kb(){const c={},a={R:0,Y:0,Z:0,O:{}};try{if(this.H.size<1)return;this.H.forEach(b=>{this.Za(b,c)});for(const b of this.G)for(const [d,e]of Object.entries(b.B||{}))c.$[d]||(c.$[d]={p:0,w:0}),e.enabled&&(a.R+=e.count,a.Y+=c.$[d].p,a.Z+=c.$[d].w),a.O[d]={required:e.count||0,sa:c.$[d].p||0,left:e.count-(c.$[d].p||0),enabled:e.enabled,jb:c.$[d].w},b.B[d].ia=a.O[d].sa}catch(b){console.warn("Error getting pixel stats:",b)}h.K();return a}pa(){const c=document.querySelector("#bgz-69")?.querySelector("div:first-child");c&&(c.innerHTML="\u267b\ufe0f Statistics...")&&c.classList.remove("animate")}ka(c){this.backgroundColor=c;try{this.g.backgroundColor=c,this.K()}catch(a){}this.A&&this.A.C(`\u27d0 Background color: ${c}`)}fb(c,a,b){this.g.I={active:b,color:c,type:a};this.K();this.A&&this.A.C(`\u27d0 Highlight ${0==b?"disabled":`enabled: ${c}`}.`)}Qa(c){let a=document.getElementById("bgz-error-color")?.value,b=this.g.I?.active||!1;b=b==1&&this.g.I?.type==c?!1:!0;this.fb(a,c,b);document.querySelectorAll(".bgz-highlight-btn").forEach(e=>{e.classList.remove("active");e.querySelector(`${c==1?"path":"rect"}`)?.setAttribute("fill","currentColor")});const d=c==1?document.getElementById("bgz-square-btn"):document.getElementById("bgz-diamond-btn");b==1?(d?.classList?.add("active"),d?.querySelector(`${c==1?"rect":"path"}`)?.setAttribute("fill",a),document.getElementById("gg-wrongs").setAttribute("t",c),document.documentElement.style.setProperty("--color-hl",a),document.getElementById("gg-wrongs").classList.add("active")):(d?.querySelector(`${c==1?"rect":"path"}`)?.setAttribute("fill","currentColor"),document.getElementById("gg-wrongs").classList.remove("active"))}N(c=!1){const a=h.kb();if(a&&!h.L.Na){var b=document.querySelector("#dbz-1"),d=document.querySelector("#bgz-g");if(!b||d.childElementCount<=0||this.V)window.m(a);else if(a.Y!==h.Ba||a.R!=h.$a||a.Z!=h.bb||c)h.Ba=a.Y,h.$a=a.R,h.bb=a.Z,setTimeout(()=>{if(b&&a){var e=a.R>0?Math.trunc(a.Y/a.R*1E3)/10:0;document.documentElement.style.setProperty("--pa",e>=85?"#4caf4f42":e>=50?"#ff990042":"#f4433642");document.documentElement.style.setProperty("--pb",e>=85?"#4caf4f83":e>=50?"#ff990083":"#f4433683");b.innerHTML=`\u27d0  <span style="color: #64b5f6">${a.Y.toLocaleString()}</span>/<span>${a.R.toLocaleString()}</span> \u2022 <span style="color: ${e>=80?"#4caf50":e>=50?"#ff9800":"#f44336"}">${e}%</span>  \u27d0`;b.style.setProperty("--progress-width",e+"%");b.classList.remove("low-progress","medium-progress","high-progress","complete-progress","animate");e===0?b.classList.add("low-progress"):e<30?b.classList.add("low-progress"):e<70?b.classList.add("medium-progress"):e<100?b.classList.add("high-progress"):b.classList.add("complete-progress");b.classList.add("animate");this.pb(a,d);var g=y.m.l.find(f=>f.key===h.L.key);g&&(g.s=e)&&y.J();(g=document.querySelector(`img[data-key="${h.L.key}"]`)?.parentElement?.querySelector(".bgz-img-prog"))&&(g.textContent=`Progress: ${e}%`)&&(g.style.color=e>=85?"#4caf4f":e>=50?"#ff9900":"#f44336");this.A.C(`\u27d0 Wrong Pixel${1==a.Z?"":"s"} ${a.Z}.`);!h.M&&R.m(`\u27d0 Wrong Pixel${1==a.Z?"":"s"} ${a.Z}`,5E3)}},100)}}pb(c,a){const b=document.querySelectorAll('#bgz-g>div[style*="display: flex"]');if(b.length<Object.values(c.O).filter(d=>d.left!=0).length){const d=Array.from(b).map(g=>g.querySelector("#box-color")?.style.background.replace(/[^\d,]/g,"")),e=Object.fromEntries(Object.entries(c.O).filter(([g])=>!d.includes(g)));Object.keys(e).forEach(g=>{(g=h.G?.[0]?.da?.get(g)?.name)&&(a.querySelector(`div[name="${g}"`).parentElement.style.display="flex")})}b.forEach(d=>{const e=d.querySelector("div[name]");var g=d.querySelector("input");const f=d.querySelector("#box-color");if(e){var l=e.getAttribute("name");if(l&&c.O){var k=Object.keys(c.O).find(r=>h.G?.[0]?.da?.get(r)?.name===l);if(k&&c.O[k])if(c.O[k].left==0)d.style.display="none";else{var u=c.O[k].enabled,t=1;g.checked=u;g=c.O[k];d.querySelector("#span-color").innerHTML=`<span style="color: #64b5f6">${g.sa.toLocaleString()}</span>/<span>${g.required.toLocaleString()}</span> \u2022 <span style="color: ${g.left>0?"#f44336":"#4caf50"}">${g.left.toLocaleString()}</span> \u2332 <span style="color:${g.jb>0?"#f44336":"#4caf50"}">\ud83d\udea8: ${g.jb.toLocaleString()}</span>`;g=g.required>0?Math.round(g.sa/g.required*100):0;u||(t=.5,g=0);e.style.opacity=f.style.opacity=t;d.style.setProperty("--item-progress",g+"%");d.classList.remove("low-progress","medium-progress","high-progress","complete-progress");g===0?d.classList.add("low-progress"):g<30?d.classList.add("low-progress"):g<70?d.classList.add("medium-progress"):g<100?d.classList.add("high-progress"):d.classList.add("complete-progress")}}}})}gb(c,a){function b(p){const w=p.type.includes("mouse")?p.clientX:p.touches[0].clientX;p.type.includes("mouse");p.type==="touchstart"&&p.preventDefault();r=t=!1;u=w}function d(p){if(u&&!r){var w=p.type.includes("mouse")?p.clientX:p.touches[0].clientX;p.type.includes("mouse");p=w-u;Math.abs(p)>10&&(t=!0,w=Math.min(Math.abs(p)/40,1),p>0?k.style.transform=`translateX(${Math.min(p,40)}px) scale(${1+w*.1})`:(k.classList.remove("swiping"),g()))}}function e(p){if(u){var w=p.type.includes("mouse")?p.clientX:p.changedTouches[0].clientX;p.type==="touchend"&&p.preventDefault();p=w-u;t&&p>40?(r=!0,l(p)):Math.abs(p)<5?f():g();r||(u=0,t=!1)}}function g(){k.style.transform=""}function f(){n++;a=="bg"&&(h.backgroundColor!="transparent"?(document.getElementById("bg-bg").classList.remove("active"),h.ka("transparent")):(document.getElementById("bg-bg").classList.add("active"),h.ka(document.documentElement.style.getPropertyValue("--color-bg"))));a=="wrongs"&&h.Qa(parseInt(c.parentElement.getAttribute("t"))||1);setTimeout(()=>{g()},100)}function l(){q++;a=="bg"&&(document.querySelector("#zbg-controls").style.display="flex",setTimeout(()=>{document.querySelector("#zbg-controls")?.classList.add("active")},250));a=="wrongs"&&(document.querySelector("#z-error-highlight").style.display="flex",setTimeout(()=>{document.querySelector("#z-error-highlight")?.classList.add("active")},250));setTimeout(()=>{g();k.classList.remove("swipe-complete")},100);u=0;t=!1}const k=c;let u=0,t=!1,r=!1,n=0,q=0;k.addEventListener("mousedown",b);k.addEventListener("touchstart",b);document.addEventListener("mousemove",d);document.addEventListener("touchmove",d);document.addEventListener("mouseup",e);document.addEventListener("touchend",e);k.addEventListener("contextmenu",p=>{p.preventDefault()})}lb(c){var a=document.getElementsByClassName("mb-4 mt-3");if(a=a[0]?a[0]:document.getElementById("paleta")){const b=c.getAttribute("name");(a=a.querySelector(b?`[aria-label="${b}"]`:"[aria-label]"))&&a.dispatchEvent(h.Lb)}h.g.X&&(a=new Event("change",{bubbles:!0}),c.parentNode.querySelector("input").checked=!c.parentNode.querySelector("input").checked,c.parentNode.querySelector("input").dispatchEvent(a))}Db(c,a){if(h.G?.[0]?.B){var b=Object.entries(h.G?.[0].B).sort((d,e)=>(e[1].count||0)-(d[1].count||0));if(h.g.X){document.querySelectorAll(".check").forEach(d=>{d!==this&&(d.checked=!1)});for(let d in b)b.hasOwnProperty(d)&&(b[d][1].enabled=!1);c.checked=!0;h.G[0].B[a].enabled=c.checked;this.A.C(`\u27d0 Enabled color ${a}.`)}else h.G[0].B[a].enabled=c.checked,this.A.C(`\u27d0 ${c.checked?"Enabled":"Disabled"} color ${a}.`);h.pa()}}D(c,a){!c.contains(a.target)&&a.target!==c&&c.classList.contains("active")&&(c.classList.remove("active"),setTimeout(()=>{c.style.display="none"},250))}}(ca,da,I));aa=new class{constructor(c){ha(this,va);this.v=c;this.xa=[]}yb(c){window.addEventListener("message",async a=>{var b=a.data;a=b.tb;if(b&&["bmz-gliz","load"].includes(b.source)&&b.endpoint){var d=b.endpoint?.split("?")[0].split("/").filter(l=>l&&isNaN(Number(l))).filter(l=>l&&!l.includes(".")).pop();if("load"==b.source&&"tiles"==d){var e=b.endpoint.split("/");e=[parseInt(e[e.length-2]),parseInt(e[e.length-1].replace(".png",""))];h.ha(e)&&h.ha(e)[1]>0&&(document.querySelector("#bgz-ld")||(e=document.createElement("div"),e.id="bgz-ld",document.querySelector("#top-bar-dock")?.appendChild(e)),document.querySelector("#bgz-ld")?.classList.add("loader-inline"))}else{switch(d){case "me":if(a.status&&"2"!=a.status?.toString()[0])return void c.Ia("\u27d0 You are not logged in!\nCould not fetch userdata.");e=Math.ceil(Math.pow(Math.floor(a.level)*9.12281389923994,1/.65)-a.pixelsPainted);a.id||a.id;this.v.ya=a.id;c.ma("bgz-u",`Username: <b>${(function(l){const k=document.createElement("div");return k.textContent=l,k.innerHTML})(a.name)}</b>`);c.ma("bgz-p",`Droplets: <b>${(new Intl.NumberFormat).format(a.Sb)}</b>`);c.ma("bgz-i",`Next level in <b>${(new Intl.NumberFormat).format(e)}</b> pixel${1==e?"":"s"}`);e=new Date;a=(a.charges.max-a.charges.count)*30;ia.m?ia.V(a,e):ia.J(a,e);break;case "pixel":a=b.endpoint.split("?")[0].split("/").filter(l=>l&&!isNaN(Number(l)));b=new URLSearchParams(b.endpoint.split("?")[1]);b=[b.get("x"),b.get("y")];if(this.xa.length&&(!a.length||!b.length))return void c.Ia("\u27d0 Coordinates are malformed!\nDid you try clicking the canvas first?");this.xa=[...a,...b];d=(g=a,f=b,[parseInt(g[0])%4*1E3+parseInt(f[0]),parseInt(g[1])%4*1E3+parseInt(f[1])]);g=document.querySelectorAll("span");for(e of g)e.textContent.trim().includes(`${d[0]}, ${d[1]}`)&&(g=document.querySelector("#bgz-h"),f=`(Tl X: ${a[0]}, Tl Y: ${a[1]}, Px X: ${b[0]}, Px Y: ${b[1]})`,g?g.textContent=f:(g=document.createElement("span"),g.id="bgz-h",g.textContent=f,g.style="margin-left: calc(var(--spacing)*3); font-size: small;display:none;",O(e,3).insertAdjacentElement("afterend",g)),(g=document.querySelector("#bgz-tl"))&&(g.value=`${a[0]},${a[1]},${b[0]},${b[1]}`));break;case "tiles":a=b.endpoint.split("/"),a=[parseInt(a[a.length-2]),parseInt(a[a.length-1].replace(".png",""))],e=b.Ma,a=await this.v.qb(b.La,a),window.postMessage({source:"bmz-gliz",Ma:e,La:a,blink:b.blink})}var g,f}}})}}(h);I.u(aa);!function(){let c=!1;try{JSON.parse(GM_getValue("GGCoords","{}"))}catch(a){}I.o({id:"bgz-A",style:"top: 45px; right: 65px; min-width: 230px;"}).o({id:"bgz-j"}).o({id:"bgz-z"}).h().o({id:"dbz",style:"display: flex;align-items: center;justify-content: flex-start;background:linear-gradient(0deg, #0c1412, transparent);padding:0px 4px 0px 4px;border-radius: 10px;"}).Ha({id:"dbz-img",alt:"Click to minimize/maximize",src:"https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true",style:"cursor: pointer;background: linear-gradient(45deg, #ff000040, #ffa50040, #ffff0040, #00800040, #0000ff40, #4b008240, #ee82ee40);background-size: 400% 400%;animation: rainbow 10s ease infinite;padding:2px;border-radius:50%;margin-bottom:3px;min-height: 4em;"},(a,b)=>{b.addEventListener("click",()=>{c=!c;const d=document.querySelector("#bgz-A"),e=document.querySelector("#bgz-j"),g=document.querySelector("#bgz-z"),f=document.querySelector("#bgz-bg-controls"),l=document.querySelector("#bgz-error-highlight"),k=document.querySelector("#up"),u=document.querySelector("#bgz-options"),t=document.querySelector("#btn-clon");c||(d.style.width="auto",d.style.maxWidth="24px",d.style.minWidth="230px",d.style.padding="10px");["#bgz-A h1","#bgz-f","#bgz-A hr","#bgz-6",`#${a.W}`,h.g.ca.enabled?"#bgz-6":"#bgz-9"].forEach(r=>{document.querySelectorAll(r).forEach(n=>{n.style.display=c?"none":""})});c?(u&&(u.style.display="none"),t&&(t.style.display="flex"),k&&(k.style.display="none"),l&&(l.style.display="none"),f&&(f.style.display="none"),d.style.width="80px",d.style.height="90px",d.style.maxWidth="80px",d.style.minWidth="60px",d.style.padding="8px",b.style.marginLeft="0px",e.style.textAlign="center",e.style.margin="0",e.style.marginBottom="0",g&&(g.style.display="",g.style.marginBottom="0.25em")&&(document.getElementById("dbz").querySelector("img").src="https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_1.png")):(u&&(u.style.display=""),t&&(t.style.display="none"),k&&(k.style.display="none"),k&&(document.getElementById("dbz").querySelector("img").src="https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_2.png"),l&&(l.style.display="flex"),f&&(f.style.display="flex"),b.style.marginLeft="",d.style.padding="10px",e.style.textAlign="",e.style.margin="",e.style.marginBottom="",g&&(g.style.marginBottom="0.5em"),d.style.width="",d.style.height="");b.alt=c?"Minimized (Click to maximize)":"Maximized (Click to minimize)";c||(h.g.ca.enabled?document.getElementById("bgz-9").style.display="grid":document.getElementById("bgz-9").style.display="block")})}).h().rb().h().h().h().Ua().h().o({id:"bgz-f"}).la({id:"bgz-u",textContent:"Username:",style:"margin-bottom: 3px; font-size: 12px;"}).h().la({id:"bgz-p",textContent:"Droplets:",style:"display: none"}).h().la({id:"bgz-i",textContent:"Next level in...",style:"display: none"}).h().h().Ua().h().o({id:"bgz-bg-controls",style:"gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;"}).la({textContent:"BG:",style:"font-size: 11px; font-weight: bold;"}).h().Ga({type:"color",id:"bgz-bg-color",value:"#ffffff",title:"Background color",style:"width: 50px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;"},(a,b)=>{b.addEventListener("change",()=>{a.t?.v?.ka(b.value);document.documentElement.style.setProperty("--color-bg",b.value);document.getElementById("bg-bg").classList.add("active")});setTimeout(()=>{a.t?.v?.backgroundColor!=="transparent"?(b.value=a.t?.v?.backgroundColor,document.documentElement.style.setProperty("--color-bg",a.t?.v?.backgroundColor),document.getElementById("bg-bg").classList.toggle("active")):document.documentElement.style.setProperty("--color-bg","#F8F4F0")},250)}).h().o({style:"display: flex; grid-column: 1/-1; align-items: center; justify-content: space-between;margin-left:3px",innerHTML:'<div id="slider-title"></div>'}).Ga({type:"range",id:"alphaSlider",min:"0",max:"255",value:"255",style:"width: 100%;"},(a,b)=>{b.addEventListener("input",()=>{var d=document.getElementById("slider-title");const e=(O(b,3).getBoundingClientRect().width-80)/2;d.textContent=`Alpha: ${b.value}`;d.style.left=`${e}px`;d.style.top=`-${O(b,3).getBoundingClientRect().height-2}px`;d.style.visibility="visible";d=parseInt(b.value).toString(16).toUpperCase();d=d.length===1?"0"+d:d;h.g.alpha=d});b.addEventListener("change",()=>{const d=document.getElementById("slider-title");setTimeout(()=>{d.style.visibility="hidden"},500)});setTimeout(()=>{b.value=parseInt(h.g.alpha,16)},500)}).h().h().h().h().o({id:"bgz-error-highlight",style:"gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;"}).la({textContent:"HL:",style:"font-size: 11px; font-weight: bold;"}).h().Ga({type:"color",id:"bgz-error-color",className:"bgz-highlight-btn",value:"#15ff00",style:"width: 35px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;",title:"highlighter color"},(a,b)=>{b.addEventListener("change",()=>{let d=a.t?.v?.g.I?.type||1;a.t?.v?.fb(b.value,d,!0);document.querySelectorAll(".bgz-highlight-btn").forEach(e=>{e.classList.remove("active")});d==1?document.querySelector("#bgz-square-btn")?.querySelector("rect")?.setAttribute("fill",b.value):document.querySelector("#bgz-diamond-btn")?.querySelector("path")?.setAttribute("fill",b.value);document.querySelector(d==1?"#bgz-square-btn":"#bgz-diamond-btn")?.classList.add("active");document.getElementById("gg-wrongs").classList.add("active");document.documentElement.style.setProperty("--color-hl",b.value)});setTimeout(()=>{let d=a?.t?.v?.g?.I?.color||"#9900ff",e=a.t?.v?.g?.I?.type||1;b.value=d;document.documentElement.style.setProperty("--color-hl",d);document.getElementById("gg-wrongs").setAttribute("t",e)},250)}).h().o({style:"display: flex; gap: 8px; grid-column: 1 / -1; align-items: center; justify-content: space-between;"}).k({id:"bgz-square-btn",className:"bgz-highlight-btn",style:"width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;",title:"Square mode",innerHTML:'<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <rect x="3" y="3" width="10" height="10" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>'},(a,b)=>{b.onclick=()=>{a.t?.v?.Qa(1)};setTimeout(()=>{a.t?.v?.g?.I?.active&&a.t?.v?.g.I.type==1&&(b.classList.add("active"),b.querySelector("rect")?.setAttribute("fill",a.t?.v?.g.I.color),document.getElementById("gg-wrongs").classList.toggle("active"))},500)}).h().k({id:"bgz-diamond-btn",className:"bgz-highlight-btn",style:"width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;",title:"Diamond mode",innerHTML:'<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <path d="M8 3 L13 8 L8 13 L3 8 Z" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>'},(a,b)=>{b.onclick=()=>{a.t?.v?.Qa(2)};setTimeout(()=>{a.t?.v?.g?.I?.active&&a.t?.v?.g.I.type==2&&(b.classList.add("active"),b.querySelector("path")?.setAttribute("fill",a.t?.v?.g.I.color),document.getElementById("gg-wrongs").classList.toggle("active"))},500)}).h().h().h().o({id:"bgz-stats",style:"display: none; justify-content: center"}).o({id:"bgz-9",style:"scrollbar-color: auto !important"}).o({style:"display:flex; flex-direction: row; flex-wrap: wrap; align-content: center; justify-content: center; align-items: center; gap: 2px; padding: 4px"}).k({id:"bgz-3",textContent:"Full\ud83c\udfa8",title:"Activate all colors",style:"min-width: 47px"},(a,b)=>{b.onclick=()=>{const d=h.G[0];d?.B&&(Object.values(d.B).forEach(e=>e.enabled=!0),h.pa(),a.C("\u27d0 Enabled all colors"));setTimeout(()=>{h.N(!0)},1E3)}}).h().k({id:"bgz-0",textContent:"No\ud83c\udfa8",title:"Deactivate all colors",style:"min-width: 47px"},(a,b)=>{b.onclick=()=>{const d=h.G[0];d?.B&&(Object.values(d.B).forEach(e=>e.enabled=!1),h.pa(),a.C("\u27d0 Disabled all colors"))}}).h().k({id:"bgz-96",textContent:"Single\ud83c\udfa8",title:"Single selection mode",style:"min-width: 47px"},(a,b)=>{b.onclick=()=>{h.Ca(b)};setTimeout(()=>{h.g.X?b.style="background-color:#063912;":b.style="background-color:#2d2d2d;"},200)}).h().k({id:"bgz-dock-btn",style:"width: 25px;padding: 0px;min-width: 20px;border: 0px solid;border-radius: 6px;min-height: 20px;font-size:medium;background-color: #4F1D6F;",title:"Dock/Undock panel",textContent:"\u21f1"},(a,b)=>{b.onclick=()=>{a.t?.v?.Gb()}}).h().h().o({id:"bgz-69",style:"animation: pulseProgress 2s ease-in-out infinite;"}).h().o({id:"bgz-g",className:"bgz-scroll"}).h().h().h().h().o({id:"bgz-options",style:"border: 1px solid #8a70a3;border-radius:5px;margin-top: 10px;padding: 0px 5px 5px 5px;font-size: x-small;background: #1a1a1a;",innerHTML:'<label style="position:relative;top:-8px;background: #1a1a1a;">\u2699\ufe0fOPTIONS</label>'}).ba({id:"bgz-op1",textContent:"Use premium colors in the color converter."},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.F.i=!h.g.F.i;h.K()});setTimeout(()=>{h.g.F.i&&(b.querySelector("input").checked=!0)},500)}).h().ba({id:"bgz-op1.1",textContent:"Use dithering in the color converter."},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.F.va=!h.g.F.va;h.K()});setTimeout(()=>{h.g.F.va&&(b.querySelector("input").checked=!0)},500)}).h().ba({id:"bgz-op2",textContent:"Use background overlay when painting."},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.F.Ea=!h.g.F.Ea;h.K()});setTimeout(()=>{h.g.F.Ea&&(b.querySelector("input").checked=!0)},500)}).h().ba({id:"bgz-op3",textContent:"Use highlighter on unpainted pixels."},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.F.Aa=!h.g.F.Aa;h.K()});setTimeout(()=>{h.g.F.Aa&&(b.querySelector("input").checked=!0)},500)}).h().ba({id:"bgz-op4",textContent:"Disable the color picker when painting."},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.F.select=!h.g.F.select;h.K()});setTimeout(()=>{h.g.F.select&&(b.querySelector("input").checked=!0)},500)}).h().ba({id:"bgz-op5",textContent:"Hide wplace palette (eyedropper mode)"},(a,b)=>{b.querySelector("input").addEventListener("change",function(){h.g.ra=!h.g.ra;h.K();window.localStorage["show-all-colors"]="true"});setTimeout(()=>{h.g.ra&&(b.querySelector("input").checked=!0,window.localStorage["show-all-colors"]="true")},500)}).h().h().Sa({id:I.W,placeholder:`\u27d0 Status: Sleeping...\nVersion: ${da}`,readOnly:!0}).h().o({id:"bgz-6"}).o().k({id:"bgz-m",className:"bgz-D",innerHTML:"\ud83c\udfa8",title:"Template Color Converter"},(a,b)=>{b.addEventListener("click",()=>{window.open("https://pepoafonso.github.io/color_converter_wplace/","_blank","noopener noreferrer")})}).h().k({id:"bgz-n",className:"bgz-D",innerHTML:"\ud83c\udf10",title:"My GibHub page"},(a,b)=>{b.addEventListener("click",()=>{window.open("https://github.com/yui-ho/WPlace-GGliz/","_blank","noopener noreferrer")})}).h().h().sb().h().h().p(document.body);I.o({id:"bgz-9-overlay",style:"z-index:8000"},(a,b)=>{b.addEventListener("mousedown",()=>{h.qa=!0});window.addEventListener("mouseup",()=>{h.qa=!1});(new ResizeObserver(()=>{h.qa?b.querySelector("#bgz-9").style.height="auto":b.getBoundingClientRect().height>window.screen.height*.6&&(b.querySelector("#bgz-9").style.height="40vh")})).observe(b)}).o({id:"bgz-dockerDrag"}).h().o({id:"bgz-dockerContent"}).p(document.body);I.o({id:"floating-bottons",style:"position: fixed;left: 0.5em;top: 50%;transform: translateY(-50%);max-width: 180px;height: auto;display:grid;align-content:space-around;gap:6px;z-index:51"}).o({id:"menu-wrapper-bg",className:"menu-wrapper",style:"height:40px; display:flex;"}).o({className:"gg-izi",id:"bg-bg",title:"Background [On/Off]"}).o({className:"arrow",textContent:"\u00bb",style:"color: var(--color-bg);"}).h().k({id:"bg-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.1893 1.75H4.5C2.98122 1.75 1.75 2.98122 1.75 4.5V10.1893L10.1893 1.75ZM1.75 12.3107V15.6893L15.6893 1.75H12.3107L1.75 12.3107ZM17.8107 1.75L1.75 17.8107V19.5C1.75 19.9869 1.87652 20.4442 2.09848 20.8409L20.8409 2.09848C20.4442 1.87652 19.9869 1.75 19.5 1.75H17.8107ZM21.9015 3.15914L3.15914 21.9015C3.55582 22.1235 4.01313 22.25 4.5 22.25H6.18934L22.25 6.18934V4.5C22.25 4.01313 22.1235 3.55582 21.9015 3.15914ZM22.25 8.31066L8.31066 22.25H11.6893L22.25 11.6893V8.31066ZM22.25 13.8107L13.8107 22.25H19.5C21.0188 22.25 22.25 21.0188 22.25 19.5V13.8107Z" fill="currentColor"/></svg>',style:"color: var(--color-bg);"},(a,b)=>{setTimeout(()=>{a.t?.v?.gb(b,"bg")},1E3)}).h().h().h().o({id:"menu-wrapper-wb",className:"menu-wrapper",style:"height:40px; display:flex;"}).o({className:"gg-izi",id:"gg-wrongs",title:"Highlighter [On/Off]"}).o({className:"arrow",textContent:"\u00bb",style:"color: var(--color-hl);"}).h().k({id:"wrongs",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2045 2.96963C13.4974 2.67677 13.9723 2.67679 14.2652 2.96967L22.0299 10.7344C22.1705 10.875 22.2495 11.0658 22.2495 11.2647C22.2495 11.4637 22.1705 11.6544 22.0298 11.7951L17.795 16.0292C17.5021 16.3221 17.0273 16.3221 16.7344 16.0292L8.96967 8.26448C8.82901 8.12382 8.74999 7.93304 8.75 7.73412C8.75001 7.53519 8.82904 7.34442 8.96971 7.20377L13.2045 2.96963ZM8.26071 9.32422L7.20313 10.3818C7.00457 10.5804 6.93375 10.873 7.0189 11.14C7.03956 11.3177 7.09106 11.8189 7.03675 12.1628C6.92988 12.8396 6.56515 13.8433 5.43842 14.97C5.14553 15.2629 5.14553 15.7378 5.43842 16.0307L8.96645 19.56C9.25935 19.8529 9.73422 19.8529 10.0271 19.56C11.1538 18.4333 12.1575 18.0685 12.8343 17.9617C13.1783 17.9074 13.6795 17.9588 13.8572 17.9795C14.1242 18.0647 14.4168 17.9938 14.6153 17.7953L15.6736 16.7371L8.26071 9.32422ZM1.96238 19.9755L4.74997 17.1094L7.87102 20.2315L7.01621 21.0425C6.87687 21.1747 6.6921 21.2484 6.50002 21.2484H2.50002C2.19857 21.2484 1.92641 21.0679 1.80912 20.7902C1.69183 20.5125 1.7522 20.1916 1.96238 19.9755Z" fill="currentColor"/></svg>',style:"color: var(--color-hl);"},(a,b)=>{setTimeout(()=>{a.t?.v?.gb(b,"wrongs")},1E3)}).h().h().h().h().o({className:"gg-izi",id:"bgz-template",title:"Template [On/Off]"}).k({id:"template-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M17 2C17.5523 2 18 2.44772 18 3V6H21C21.5523 6 22 6.44772 22 7C22 7.55228 21.5523 8 21 8H18V16H21C21.5523 16 22 16.4477 22 17C22 17.5523 21.5523 18 21 18H18V21C18 21.5523 17.5523 22 17 22C16.4477 22 16 21.5523 16 21V18H8V21C8 21.5523 7.55228 22 7 22C6.44772 22 6 21.5523 6 21V18H3C2.44772 18 2 17.5523 2 17C2 16.4477 2.44772 16 3 16H6V8H3C2.44772 8 2 7.55228 2 7C2 6.44772 2.44772 6 3 6H6V3C6 2.44772 6.44772 2 7 2C7.55228 2 8 2.44772 8 3V6H16V3C16 2.44772 16.4477 2 17 2ZM8 16H16V8H8V16Z" fill="currentColor"/></svg>'},(a,b)=>{b.onclick=()=>{a.t.v.Pa=!a.t.v.Pa;a.t?.v?.Pa?(a.t?.v?.Ta(!0),a.C("\u27d0 Enabled templates!")):(a.t?.v?.Ta(!1),a.C("\u27d0 Disabled templates!"));document.getElementById("bgz-template").classList.toggle("active")};setTimeout(()=>{document.getElementById("bgz-template").classList.toggle("active");["bgz-A","bgz-imageViewerContainer",...h.m.Oa].forEach(d=>{(d=document.querySelector(`#${d}`))&&a.t?.v?.cb(d)})},100)}).p(document.body);I.o({id:"bgz-image-preview"}).h().o({id:"preview"}).o({style:"color: white; margin-bottom: 15px; font-family: Arial, sans-serif;",innerHTML:"<h3>Color reduction was applied.</h3>"}).h().Ha({id:"bgz-iv"}).h().o({style:"margin-top: 15px;display: flex;gap: 10px;justify-content: center;"}).k({className:"bgz-preview",style:"background: #27ae60;",textContent:"\ud83d\udcbe Save"},(a,b)=>{b.addEventListener("click",function(){const d=document.createElement("a");d.href=document.querySelector("#bgz-iv")?document.querySelector("#bgz-iv").src:"";d.download=`WGliz-${Date.now()}.png`;d.click()})}).h().k({className:"bgz-preview",style:"background: #e74c3c;",textContent:"\u274c Close"},(a,b)=>{b.addEventListener("click",function(){document.querySelector("#bgz-image-preview")?document.querySelector("#bgz-image-preview").style.display="none":""})}).p(document.body);I.o({id:"top-bar",className:"top-bar"}).p(document.body);I.o({id:"floating-bottons-right",className:"floating-bottons"}).o({className:"gg-izi right",id:"gliz-templates",title:"Show saved template"}).k({id:"templates-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-images" viewBox="0 0 16 16" stroke-width="2"> <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/> <path d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2zM14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1zM2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1h-10z"/> </svg>',style:"color: #ffffffff; opacity:1;background: #0A2A53"}).h().h().o({className:"gg-izi right",id:"gliz-search",title:"Fnd a place"}).k({id:"search-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor"><path d="M408 120C408 174.6 334.9 271.9 302.8 311.1C295.1 321.6 280.9 321.6 273.2 311.1C241.1 271.9 168 174.6 168 120C168 53.73 221.7 0 288 0C354.3 0 408 53.73 408 120zM288 152C310.1 152 328 134.1 328 112C328 89.91 310.1 72 288 72C265.9 72 248 89.91 248 112C248 134.1 265.9 152 288 152zM425.6 179.8C426.1 178.6 426.6 177.4 427.1 176.1L543.1 129.7C558.9 123.4 576 135 576 152V422.8C576 432.6 570 441.4 560.9 445.1L416 503V200.4C419.5 193.5 422.7 186.7 425.6 179.8zM150.4 179.8C153.3 186.7 156.5 193.5 160 200.4V451.8L32.91 502.7C17.15 508.1 0 497.4 0 480.4V209.6C0 199.8 5.975 190.1 15.09 187.3L137.6 138.3C140 152.5 144.9 166.6 150.4 179.8H150.4zM327.8 331.1C341.7 314.6 363.5 286.3 384 255V504.3L192 449.4V255C212.5 286.3 234.3 314.6 248.2 331.1C268.7 357.6 307.3 357.6 327.8 331.1L327.8 331.1z"/></svg>',style:"color: #4BE1C0; opacity:1"}).h().h().o({className:"gg-izi right",id:"gliz-home",title:"Go to home"}).k({id:"home-btn",className:"toggle-button-gg",innerHTML:'<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g> <d="M0 0h24v24H0z"/> <path fill-rule="nonzero" d="M20 20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9zm-2-1V9.157l-6-5.454-6 5.454V19h12zm-6-2l-3.359-3.359a2.25 2.25 0 1 1 3.182-3.182l.177.177.177-.177a2.25 2.25 0 1 1 3.182 3.182L12 17z"/> </g> </svg>',style:"color: #E95F7D; opacity:1;"},(a,b)=>{b.addEventListener("click",function(){if(h.g.aa.length==4){const d=y.u(h.g.aa);window.location.href=`https://wplace.live/?lat=${d.ub}&lng=${d.wb}&zoom=15`}else R.m("\u27d0 No coordinates")})}).p(document.body);I.o({id:"bgz-imageViewerContainer",className:"viewer-hidden"}).o({innerHTML:"<h3>\u27d0 Saved Templates \u27d0</h3>"}).h().k({className:"bgz-close-btn",textContent:"X",title:"Close"},(a,b)=>{b.addEventListener("click",function(){y.ha()})}).h().o({Rb:"bgz-header-controls"}).o({style:"color: #94a3b8; font-size: 12px;",innerHTML:'Total: <span id="bgz-imageCount">0</span> images'}).h().h().o({id:"bgz-imagesList"}).p(document.body);I.o({id:"bgz-back",style:"display:none"}).o({className:"bgz-image-item"}).o({className:"bgz-image-header"}).o({className:"bgz-image-name"}).h().o({className:"bgz-image-status"}).h().h().o({className:"bgz-image-preview"}).Ha({className:"bgz-preview-img"}).h().o({className:"bgz-image-info",innerHTML:'<div class="bgz-img-prog"></div><a class="bgz-image-link"></a>'}).h().h().o({className:"bgz-image-actions"}).k({className:"bgz-btn btn-draw",textContent:"Draw"}).h().k({className:"bgz-btn btn-download",textContent:"Download"}).h().k({className:"bgz-btn btn-delete",textContent:"Delete"}).h().h().h().p(document.body);window.m=function(a){var b=document.querySelector("#bgz-69");const d=document.querySelector("#bgz-g"),e=h.G?.[0];if(d&&e?.B){var g=Object.entries(e.B).sort((k,u)=>(u[1].count||0)-(k[1].count||0));d.innerHTML="";b.innerHTML="";var f=document.createElement("div");f.id="dbz-1";f.style.cssText="font-size: 12px; font-weight: bold; padding: 1px; border-radius: 4px; text-align: center;overflow:hidden;";var l=a.R>0?Math.round(a.Y/a.R*100):0;f.innerHTML=`\u27d0 <span style="color: #64b5f6">${a.Y.toLocaleString()}</span>/<span>${a.R.toLocaleString()}</span> \u2022 <span style="color: ${l>=80?"#4caf50":l>=50?"#ff9800":"#f44336"}">${l}%</span> \u27d0`;b.appendChild(f);for(const [k,u]of g){b=u;g=a.O[k]||{required:0,sa:0,left:0};f=document.createElement("div");f.style.cssText="display: flex; align-items: center; gap: 8px; margin: 4px 0; padding: 3px; font-size: 11px;";g.left==0&&(f.style.display="none");l=document.createElement("div");l.id="box-color";l.style.cssText=`width: 14px; height: 14px; border: 1px solid rgba(255,255,255,0.5); border-radius: 2px; flex-shrink: 0; ${b.enabled?"":"opacity: 0.4;"}`;const t=document.createElement("div");t.style.cssText="display: flex; flex-direction: column; gap: 2px; flex-grow: 1; min-width: 0; cursor: pointer;";const r=document.createElement("span");r.style.cssText=`font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; ${b.enabled?"":"opacity: 0.6;"}`;const n=document.createElement("span");n.id="span-color";n.style.cssText="font-size: 9px; opacity: 0.8;font-family:system-ui;";if("other"===k)l.style.background="#888",r.textContent="Other";else if("222,250,206"===k)l.style.background="#deface",r.textContent="Template Guide";else{const [p,w,v]=k.split(",").map(Number);l.style.background=`rgb(${p},${w},${v})`;const x=e.da?.get(k);r.textContent=x?`${x.i?"\ud83d\udca7":"\u2705"}${x.name}`:`rgb(${p},${w},${v})`;t.setAttribute("name",x.name)}n.innerHTML=b.enabled?`<span style="color: #64b5f6">${g.sa.toLocaleString()}</span>/<span>${g.required.toLocaleString()}</span> \u2022 <span style="color: ${g.left>0?"#f44336":"#4caf50"}">${g.left.toLocaleString()}</span>`:`<span style="opacity: 0.6">0</span>/<span style="opacity: 0.6">${b.count.toLocaleString()}</span> \u2022 <span style="opacity: 0.6;color: ${g.left>0?"#f44336":"#4caf50"};">${g.left.toLocaleString()}</span>`;const q=document.createElement("input");q.type="checkbox";q.className="check";q.checked=b.enabled;q.style.cssText="flex-shrink: 0;";q.addEventListener("change",async()=>{h.Db(q,k)});t.addEventListener("click",async()=>{h.lb(t)});t.appendChild(r);t.appendChild(n);f.appendChild(q);f.appendChild(l);f.appendChild(t);d.appendChild(f)}h.K();h.V=!1;h.u&&document.querySelector("#bgz-9").classList.add("detached");h.N(!0)}else d&&(d.innerHTML="<small>No template colors to display.</small>")};setInterval(()=>{h.N();const a=document.querySelector("#bgz-69");h.aa.length==4&&a&&(a.childElementCount>0?document.querySelector("#home-btn").classList.remove("pulsar"):document.querySelector("#home-btn").classList.add("pulsar"))},1500);setTimeout(()=>{h.ab()},150)}();I.m();aa.yb(I);(new MutationObserver(async c=>{var a=document.querySelector('[id^="color-"]'),b=document.querySelector("#bgz-t");a&&!b&&(b=document.createElement("button"),b.id="bgz-t",b.textContent="Move \u2191",b.className="btn btn-soft",b.onclick=function(){const g=O(this,4),f="Move \u2191"==this.textContent;g.parentNode.className=g.parentNode.className.replace(f?"bottom":"top",f?"top":"bottom");g.style.borderTopLeftRadius=f?"0px":"var(--radius-box)";g.style.borderTopRightRadius=f?"0px":"var(--radius-box)";g.style.borderBottomLeftRadius=f?"var(--radius-box)":"0px";g.style.borderBottomRightRadius=f?"var(--radius-box)":"0px";this.textContent=f?"Move \u2193":"Move \u2191"},a=O(a,4).querySelector("h2"),O(a,1)?.appendChild(b));b=document.getElementsByClassName("gg-izi");a=document.getElementById("gg-pin");b.length>2&&!a&&document.querySelectorAll(".gg-izi:not(.right)").forEach(g=>{const f=document.createElement("div");f.id="gg-pin";g.appendChild(f)});b=document.querySelector("#top-bar");a=document.querySelector("#bgz-69");b&&a&&(b.id="top-bar-dock",b.style.zIndex="29",b.appendChild(a));for(let g of c)g.type==="childList"&&(g.addedNodes.forEach(async f=>{if(f.classList&&f.classList.contains("maplibregl-marker")&&!f.classList.contains("text-yellow-400")){if(!h.m.e)return;const t=document.createElement("div");t.id="gg-shot";t.style="position: fixed;";var l=document.createElement("div");l.className="flex bgz";const r=document.createElement("input");r.id="bgz-tl";r.type="text";r.placeholder="TlX,TlY,PxX,PxY";var k=document.createElement("button");k.className="btn btn-xs flex";k.textContent="Go\u2332";k.addEventListener("click",function(){const v=r.value.split(",")?.map(Number);v.length==4&&(document.location.href=y.u(v,!0))});l.appendChild(r);l.appendChild(k);k=document.createElement("div");k.className="toggle-button-gg";k.style="overflow:hidden;padding:15px; min-width:80px; min-height: 80px;opacity:1";k.innerHTML='<svg style="width:35px;height:35px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.67857 1.75H15.5V4H14.25C13.0074 4 12 5.00736 12 6.25C12 7.49264 13.0074 8.5 14.25 8.5H15.5V9.75C15.5 10.9926 16.5074 12 17.75 12C18.9926 12 20 10.9926 20 9.75V8.5H22.25V19.3214C22.25 20.9388 20.9388 22.25 19.3214 22.25H4.67857C3.06117 22.25 1.75 20.9388 1.75 19.3214V4.67857C1.75 3.06117 3.06117 1.75 4.67857 1.75ZM8.75001 11.002C9.23023 11.002 9.69078 11.1927 10.0303 11.5323L14 15.502L15.9697 13.5323C16.3092 13.1927 16.7698 13.002 17.25 13.002C17.7302 13.002 18.1908 13.1927 18.5303 13.5323L20.2976 15.2996V19.3214C20.2976 19.8606 19.8606 20.2976 19.3214 20.2976H4.67858C4.13945 20.2976 3.70239 19.8606 3.70239 19.3214V15.2996L7.46968 11.5323C7.80925 11.1927 8.26979 11.002 8.75001 11.002Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M17.75 1.75C18.3023 1.75 18.75 2.19772 18.75 2.75V5.25H21.25C21.8023 5.25 22.25 5.69772 22.25 6.25C22.25 6.80228 21.8023 7.25 21.25 7.25H18.75V9.75C18.75 10.3023 18.3023 10.75 17.75 10.75C17.1977 10.75 16.75 10.3023 16.75 9.75V7.25H14.25C13.6977 7.25 13.25 6.80228 13.25 6.25C13.25 5.69772 13.6977 5.25 14.25 5.25H16.75V2.75C16.75 2.19772 17.1977 1.75 17.75 1.75Z" fill="currentColor"/></svg>';const n=document.createElement("img");n.className="img-load";n.src="";n.style="position:absolute;z-index:49;border-radius:50%;object-fit:cover;";k.addEventListener("click",function(){q.click()});let q;document.querySelector("#bgz-imageInput")?q=document.querySelector("#bgz-imageInput"):(q=document.createElement("input"),q.id="bgz-imageInput",q.type="file",q.accept="image/*",q.style.display="none",document.querySelector("#bgz-A")?.appendChild(q),q.addEventListener("change",function(){q.classList.remove("dithering");document.querySelector("#bgz-dwl")?.remove();const v=q.files[0];if(v&&v.type.startsWith("image/")){var x=new FileReader;x.onload=function(E){const z=document.getElementById("gg-shot")?.querySelector("img");z&&(z.src=E.target.result,document.getElementById("gg-shot").querySelector("svg").style.display="none",document.querySelector("#bgz-create").classList.add("thumb"),document.querySelector("#bgz-add").style.color="#B4FE96",Q=="GG"&&(Q=null,setTimeout(()=>{w.click()},500)))};x.readAsDataURL(v)}}));const p=document.createElement("button");p.id="bgz-dwl";p.className="toggle-button-gg";p.innerHTML='<svg style="width:40px;height:40px;padding:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.71,6.29a1,1,0,0,0-1.42,0L20,7.59V2a1,1,0,0,0-2,0V7.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3A1,1,0,0,0,22.71,6.29ZM19,13a1,1,0,0,0-1,1v.38L16.52,12.9a2.79,2.79,0,0,0-3.93,0l-.7.7L9.41,11.12a2.85,2.85,0,0,0-3.93,0L4,12.6V7A1,1,0,0,1,5,6h8a1,1,0,0,0,0-2H5A3,3,0,0,0,2,7V19a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V14A1,1,0,0,0,19,13ZM5,20a1,1,0,0,1-1-1V15.43l2.9-2.9a.79.79,0,0,1,1.09,0l3.17,3.17,0,0L15.46,20Zm13-1a.89.89,0,0,1-.18.53L13.31,15l.7-.7a.77.77,0,0,1,1.1,0L18,17.21Z"/></svg>';p.addEventListener("click",async function(){const v=document.createElement("a");v.href=n.src;v.download=`WGliz-${Date.now()}.png`;v.click()});var u=await new Promise(v=>{setTimeout(()=>{v(document.querySelector("#bgz-create"))},150)});const w=u.cloneNode(!0);u.replaceWith(w);w?.addEventListener("click",async function(){if(q.files[0]){let x=q.files[0]?.name.replace(/\.[^/.]+$/,"")||"WGliz_img",E,z;var v=x.match(/\[(.*?)\]/)?.[1]?.split(",")?.map(Number);(z=document.querySelector("#bgz-tl").value)&&(z=z.match(/\d+/g).map(Number));v&&v.length==4&&confirm(`Valid coordinates were found in the image name.\nUse the coordinates [${v.join(",")}] to create the template?`)&&(z=v,E=!0);x=y.N();!z||z.length<4?(h.A.C("\u27d0 Error getting coordinates."),R.m("Error getting coordinates")):(Q=!1,(await h.U(q.files[0],x,z,y.N())).Fa===!0?(h.A.C("\u27d0 Drew to canvas!"),y.H=="sv"?(v=new FileReader,v.onload=async function(G){(G=y.U(G.target.result,x,z))?(y.M(h),R.m("\u27d0 Template saved successfully")):R.m("\u27d0 The template could not be saved");h.L.key=G},v.readAsDataURL(q.files[0]),y.H=null):y.ga(h),E&&setTimeout(()=>{document.location.href=y.u(z,!0)},1500)):(v=new FileReader,v.onload=async function(G){const T=new Image;T.onload=async function(){var C=h.ob(T);Q=!0;var U=await C.convertToBlob({type:"image/png"}),J=await y.pa(U);n.src=J;q.classList.add("dithering");t.appendChild(p);document.querySelector("#bgz-iv").src=J;document.querySelector("#bgz-image-preview").style.display="flex";(C=await h.U(C,x,z,y.N()))?h.A.C("\u27d0 Drew! successfully reduced palette!"):h.A.C("\u27d0 Something went wrong...");C.Fa&&C.ua&&(y.H=="sv"?((J=y.U(J,x,z))?(y.M(h),R.m("\u27d0 Template saved successfully")):R.m("\u27d0 The template could not be saved"),y.H=null,h.L.key=J):y.ga(h));U=new File([U],x+".png",{type:"image/png"});J=new DataTransfer;J.items.add(U);q.files=J.files;E&&setTimeout(()=>{document.location.href=y.u(z,!0)},1500)};T.src=G.target.result},v.readAsDataURL(q.files[0])))}else q.click(),Q="GG"});if(q.files[0]){u=q.files[0];const v=new FileReader;v.onload=function(x){n.src=x.target.result};v.readAsDataURL(u);w?.classList.add("thumb");q.classList.contains("dithering")&&t.appendChild(p)}k.appendChild(n);t.appendChild(k);t.appendChild(l);document.body.appendChild(t);h.cb(t);h.Mb(f,t)}if(f?.querySelector&&f?.querySelector('[d*="143ZM233-"]')){if(!h.m.e)return;const t=document.createElement("div");t.className="btn-temp-cont";t.id="bgz-crt";[{id:"bgz-create",t:"Create and replace the active template",Ra:"Create",W:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 576 512" stroke-width="2" fill="currentColor"><path d="M224 263.3C224.2 233.3 238.4 205.2 262.4 187.2L499.1 9.605C517.7-4.353 543.6-2.965 560.7 12.9C577.7 28.76 580.8 54.54 568.2 74.07L406.5 324.1C391.3 347.7 366.6 363.2 339.3 367.1L224 263.3zM320 400C320 461.9 269.9 512 208 512H64C46.33 512 32 497.7 32 480C32 462.3 46.33 448 64 448H68.81C86.44 448 98.4 429.1 96.59 411.6C96.2 407.8 96 403.9 96 400C96 339.6 143.9 290.3 203.7 288.1L319.8 392.5C319.9 394.1 320 397.5 320 400V400z"/></svg>'},{id:"bgz-add",t:"Add as a new template",Ra:"Save",W:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g> <path fill="none" d="M0 0h24v24H0z"/> <path d="M4 3h14l2.707 2.707a1 1 0 0 1 .293.707V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm3 1v5h9V4H7zm-1 8v7h12v-7H6zm7-7h2v3h-2V5z"/> </g> </svg>'},{id:"bgz-list",t:"List of saved templates",Ra:"Templates",W:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-images" viewBox="0 0 16 16" stroke-width="2"> <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/> <path d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2zM14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1zM2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1h-10z"/> </svg>'}].forEach(r=>{const n=document.createElement("button");n.id=r.id;n.className="btn-temp";n.title=r.t;n.innerHTML=`<div class="ico">${r.W}</div><span>${r.Ra}</span>`;t.appendChild(n)});f.appendChild(t);document.querySelector("#bgz-list").addEventListener("click",function(){document.querySelector("#templates-btn").click()});document.querySelector("#bgz-add").addEventListener("click",function(){y.H="sv";document.querySelector("#bgz-create").click()})}if(f.classList&&f.classList.contains("z-50")){let t=document.querySelector('[id^="color-"]');if(t){function r(){if(!h.g.ra){var n=Object.entries(h.G[0].B).sort((p,w)=>(w[1].count||0)-(p[1].count||0));const q=document.createElement("div");for(const [p,w]of n){n=h.G[0].da?.get(p);if(w.ia==w.count)continue;n=f.querySelector(`[aria-label="${n.name}"]`);if(!n)continue;const v=~~(w.ia/w.count*100),x=document.createElement("div");x.id="bgz-666";x.getAttribute;x.className="font-bold text-center";x.innerHTML=`<span style="font-weight:bolder;color: ${v>=80?"lime":v>=50?"darkorange":"crimson"}">${v}%</span>`;n.appendChild(x);q.appendChild(n.parentElement)}q.appendChild(f.querySelector('[aria-label="Transparent"]')?.parentElement);t.innerHTML="";t.append(...q.childNodes)}}t=O(t,2);(new MutationObserver(n=>{for(const q of n)if(q.type==="attributes"&&q.attributeName==="class"&&!q.target.className.includes("border-base")){n=new Event("change",{bubbles:!0});let p=q.target.getAttribute("aria-label");if(h.fa==p||h.g.F.select)break;!h.g.X&&h.Ca(document.getElementById("bgz-96")||null,!0);const w=document.getElementById("bgz-g").querySelector(`[name="${p}"]`);if(!w)break;w.parentElement.querySelector("input").checked=!0;w.parentElement.querySelector("input")?.dispatchEvent(n);h.fa=p}})).observe(t,{attributes:!0,attributeFilter:["class"],subtree:!0});h.g.ra&&(t.style.display="none");h.M=!0;document.querySelector("#floating-bottons").style.top="35%";document.querySelector("#floating-bottons-right").style.display="none";document.querySelector("#bgz-A").style.display="none";if(h.G?.[0]&&h.ea){if(l=f.querySelector('path[d*="12.5L705-555l76"]'))l=O(l,2),(new MutationObserver(n=>{for(const q of n)q.type==="attributes"&&q.attributeName==="class"&&(h.ga=q.target.classList.contains("btn-primary")?!0:!1)})).observe(l,{attributes:!0,attributeFilter:["class"]}),l.addEventListener("click",function(){document.querySelector("#bgz-3")?.click();h.fa=""});r();l=Object.values(f.querySelectorAll("path")).filter(n=>["300-300l58-58","m356-160-56-56"].some(q=>n.getAttribute("d").includes(q)));l&&l.length<=0||(l=O(l[0],2),l.addEventListener("click",function(){setTimeout(()=>{document.querySelectorAll("#bgz-666").forEach(n=>{n.remove()});r()},500)}))}}}}),g.removedNodes.forEach(f=>{f.classList&&f.classList.contains("maplibregl-marker")&&document.querySelectorAll("#gg-shot").forEach(l=>{l?.remove()});f.classList&&f.classList.contains("z-50")&&f.querySelector('[id^="color-"]')&&(document.querySelector("#bgz-3")?.click(),h.M=!1,h.ga=!1,document.querySelector("#floating-bottons").style.top="50%",document.querySelector("#bgz-A").style.display="",h.m.e&&(document.querySelector("#floating-bottons-right").style.display="grid"))}));const d=document.querySelector("#bgz-bg-controls");c=document.querySelector("#menu-wrapper-bg");d&&c&&(d.id="zbg-controls",d.style="",d.style.display="none",d.className="menu-bar",c.appendChild(d),document.addEventListener("mousedown",function(g){h.D(d,g)}),document.addEventListener("touchstart",function(g){h.D(d,g)}));const e=document.querySelector("#bgz-error-highlight");c=document.querySelector("#menu-wrapper-wb");if(e&&c){e.id="z-error-highlight";e.style="";e.style.display="none";e.className="menu-bar";c.appendChild(e);function g(f){const l=document.querySelector("#bgz-imageViewerContainer");!l.contains(f.target)&&f.target!==l&&l.classList.contains("viewer-visible")&&y.ha()}document.addEventListener("mousedown",function(f){h.D(e,f);g(f)});document.addEventListener("touchstart",function(f){h.D(e,f);g(f)})}})).observe(document.body,{childList:!0,subtree:!0});h.g.P&&window.localStorage.u!="#1e1e1e"&&(window.localStorage.m="dark",window.localStorage.u="#1e1e1e",document.documentElement.style.setProperty("--color-bg","#1e1e1e"),h?.ka("#1e1e1e"));setTimeout(()=>{document.querySelector("#dbz-img").click();var c=document.querySelector('svg path[d*="-518h80v80h-"]');if(c){c=O(c,4);const a=document.createElement("button");a.className="toggle-button-gg";a.id="bgz-night";a.innerHTML='<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16"> <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/> </svg>';c.appendChild(a);a.addEventListener("click",function(){h.g.P=!h.g.P;a.classList.toggle("night");let b;h.g.P?(b="#1e1e1e",h.ka(b),window.localStorage.m="dark"):(b="#f8f4f0",h.ka(b),window.localStorage.m="custom-winter");document.documentElement.style.setProperty("--color-bg",b);R.m("Refresh to apply more changes")});h.g.P&&a.classList.toggle("night")}y.fa(h)},2E3)})();








