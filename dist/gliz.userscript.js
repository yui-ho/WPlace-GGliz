// ==UserScript==
// @name         BM ⟐ Gliz
// @version      1.70.2
// @description  A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided "as is" under the MPL-2.0 license. The "Blue Marble" icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.
// @author       GGizzi
// @license      MPL-2.0
// @icon         https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true
// @updateURL    https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @downloadURL  https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz.userscript.js
// @match        https://wplace.live/*
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM.setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @resource     Style-File https://github.com/yui-ho/WPlace-GGliz/raw/refs/heads/main/dist/gliz-style.user.css
// ==/UserScript==

(() => { function e(e) { e = atob(e); const t = new Uint8Array(e.length); for (let n = 0; n < e.length; n++)t[n] = e.charCodeAt(n); return t } var t, n = (e, t, n) => { if (t.has(e)) throw TypeError("Cannot add the same private member more than once"); return t instanceof WeakSet ? t.add(e) : t.set(e, n) }, i = (e, t, n) => { if (!t.has(e)) throw TypeError("Cannot access private method"); return n }, a = class { constructor(e, t) { n(this, o), this.name = e, this.version = t, this.t = null, this.gb = "bgz-o", this.Y = this.v = null, this.ma = [] } C(e) { this.t = e } j() { return this.ma.length > 0 && (this.Y = this.ma.pop()), this } p(e) { e?.appendChild(this.v), this.Y = this.v = null, this.ma = [] } m(e = {}, t = (() => { })) { return t(this, i(this, o, s).call(this, "div", {}, e)), this } $(e = {}) { return i(this, o, s).call(this, "p", {}, e), this } fb() { return i(this, o, s).call(this, "small", {}, { textContent: "By GGizzi • SwingTheVine", style: "margin-top: auto;" }), this } Ia(e = {}, t = (() => { })) { return t(this, i(this, o, s).call(this, "img", {}, e)), this } eb() { return i(this, o, s).call(this, "h1", {}, { textContent: "∷WGLIZ∷" }), this } Ka() { return i(this, o, s).call(this, "hr", {}, {}), this } ha(e = {}, t = (() => { })) { const n = i(this, o, s).call(this, "label", { textContent: e.textContent ?? "" }); return delete e.textContent, e = i(this, o, s).call(this, "input", { type: "checkbox" }, e), n.insertBefore(e, n.firstChild), this.j(), t(this, n, e), this } k(e = {}, t = (() => { })) { return t(this, i(this, o, s).call(this, "button", {}, e)), this } ta(e = {}, t = (() => { })) { return t(this, i(this, o, s).call(this, "input", {}, e)), this } Ha(e = {}, t = (() => { })) { return t(this, i(this, o, s).call(this, "textarea", {}, e)), this } aa(e, t, n = !1) { (e = document.getElementById(e.replace(/^#/, ""))) && (e instanceof HTMLInputElement ? e.value = t : n ? e.textContent = t : e.innerHTML = t) } o() { var e = "#bgz-A", t = "#bgz-z"; let n, i = !1, a = 0, o = null, s = 0, r = 0, l = 0, c = 0; if (e = document.querySelector("#" == e?.[0] ? e : "#" + e), t = document.querySelector("#" == t?.[0] ? t : "#" + t), e && t) { var d = () => { if (i) { const t = Math.abs(r - c); (Math.abs(s - l) > .5 || t > .5) && (s = l, r = c, e.style.transform = `translate(${s}px, ${r}px)`, e.style.left = "0px", e.style.top = "0px", e.style.right = ""), o = requestAnimationFrame(d) } }, h = null, g = (g, u) => { i = !0, h = e.getBoundingClientRect(), n = g - h.left, a = u - h.top, (g = window.getComputedStyle(e).transform) && "none" !== g ? (g = new DOMMatrix(g), s = g.m41, r = g.m42) : (s = h.left, r = h.top), l = s, c = r, document.body.style.userSelect = "none", t.classList.add("dragging"), o && cancelAnimationFrame(o), d() }, u = () => { i = !1, o && (cancelAnimationFrame(o), o = null), document.body.style.userSelect = "", t.classList.remove("dragging") }; t.addEventListener("mousedown", (function (e) { e.preventDefault(), g(e.clientX, e.clientY) })), t.addEventListener("touchstart", (function (e) { const t = e?.touches?.[0]; t && (g(t.clientX, t.clientY), e.preventDefault()) }), { passive: !1 }), document.addEventListener("mousemove", (function (e) { i && h && (l = e.clientX - n, c = e.clientY - a) }), { passive: !0 }), document.addEventListener("touchmove", (function (e) { if (i && h) { const t = e?.touches?.[0]; t && (l = t.clientX - n, c = t.clientY - a, e.preventDefault()) } }), { passive: !1 }), document.addEventListener("mouseup", u), document.addEventListener("touchend", u), document.addEventListener("touchcancel", u) } else this.ua(`Can not drag! ${e ? "" : "moveMe"} ${e || t ? "" : "and "}${t ? "" : "iMoveThings "}was not found!`) } A(e) { (0, console.info)(`${this.name}: ${e}`), this.aa("bgz-o", "Status: " + e, !0) } ua(e) { (0, console.error)(`${this.name}: ${e}`), this.aa("bgz-o", "Error: " + e, !0) } }, o = new WeakSet, s = function (e, t = {}, n = {}) { e = document.createElement(e), this.v ? (this.Y?.appendChild(e), this.ma.push(this.Y), this.Y = e) : (this.v = e, this.Y = e); for (const [n, i] of Object.entries(t)) e[n] = i; for (const [t, i] of Object.entries(n)) e[t] = i; return e }, r = [{ id: 0, h: !1, name: "Transparent", i: [0, 0, 0] }, { id: 1, h: !1, name: "Black", i: [0, 0, 0] }, { id: 2, h: !1, name: "Dark Gray", i: [60, 60, 60] }, { id: 3, h: !1, name: "Gray", i: [120, 120, 120] }, { id: 4, h: !1, name: "Light Gray", i: [210, 210, 210] }, { id: 5, h: !1, name: "White", i: [255, 255, 255] }, { id: 6, h: !1, name: "Deep Red", i: [96, 0, 24] }, { id: 7, h: !1, name: "Red", i: [237, 28, 36] }, { id: 8, h: !1, name: "Orange", i: [255, 127, 39] }, { id: 9, h: !1, name: "Gold", i: [246, 170, 9] }, { id: 10, h: !1, name: "Yellow", i: [249, 221, 59] }, { id: 11, h: !1, name: "Light Yellow", i: [255, 250, 188] }, { id: 12, h: !1, name: "Dark Green", i: [14, 185, 104] }, { id: 13, h: !1, name: "Green", i: [19, 230, 123] }, { id: 14, h: !1, name: "Light Green", i: [135, 255, 94] }, { id: 15, h: !1, name: "Dark Teal", i: [12, 129, 110] }, { id: 16, h: !1, name: "Teal", i: [16, 174, 166] }, { id: 17, h: !1, name: "Light Teal", i: [19, 225, 190] }, { id: 18, h: !1, name: "Dark Blue", i: [40, 80, 158] }, { id: 19, h: !1, name: "Blue", i: [64, 147, 228] }, { id: 20, h: !1, name: "Cyan", i: [96, 247, 242] }, { id: 21, h: !1, name: "Indigo", i: [107, 80, 246] }, { id: 22, h: !1, name: "Light Indigo", i: [153, 177, 251] }, { id: 23, h: !1, name: "Dark Purple", i: [120, 12, 153] }, { id: 24, h: !1, name: "Purple", i: [170, 56, 185] }, { id: 25, h: !1, name: "Light Purple", i: [224, 159, 249] }, { id: 26, h: !1, name: "Dark Pink", i: [203, 0, 122] }, { id: 27, h: !1, name: "Pink", i: [236, 31, 128] }, { id: 28, h: !1, name: "Light Pink", i: [243, 141, 169] }, { id: 29, h: !1, name: "Dark Brown", i: [104, 70, 52] }, { id: 30, h: !1, name: "Brown", i: [149, 104, 42] }, { id: 31, h: !1, name: "Beige", i: [248, 178, 119] }, { id: 32, h: !0, name: "Medium Gray", i: [170, 170, 170] }, { id: 33, h: !0, name: "Dark Red", i: [165, 14, 30] }, { id: 34, h: !0, name: "Light Red", i: [250, 128, 114] }, { id: 35, h: !0, name: "Dark Orange", i: [228, 92, 26] }, { id: 36, h: !0, name: "Light Tan", i: [214, 181, 148] }, { id: 37, h: !0, name: "Dark Goldenrod", i: [156, 132, 49] }, { id: 38, h: !0, name: "Goldenrod", i: [197, 173, 49] }, { id: 39, h: !0, name: "Light Goldenrod", i: [232, 212, 95] }, { id: 40, h: !0, name: "Dark Olive", i: [74, 107, 58] }, { id: 41, h: !0, name: "Olive", i: [90, 148, 74] }, { id: 42, h: !0, name: "Light Olive", i: [132, 197, 115] }, { id: 43, h: !0, name: "Dark Cyan", i: [15, 121, 159] }, { id: 44, h: !0, name: "Light Cyan", i: [187, 250, 242] }, { id: 45, h: !0, name: "Light Blue", i: [125, 199, 255] }, { id: 46, h: !0, name: "Dark Indigo", i: [77, 49, 184] }, { id: 47, h: !0, name: "Dark Slate Blue", i: [74, 66, 132] }, { id: 48, h: !0, name: "Slate Blue", i: [122, 113, 196] }, { id: 49, h: !0, name: "Light Slate Blue", i: [181, 174, 241] }, { id: 50, h: !0, name: "Light Brown", i: [219, 164, 99] }, { id: 51, h: !0, name: "Dark Beige", i: [209, 128, 81] }, { id: 52, h: !0, name: "Light Beige", i: [255, 197, 165] }, { id: 53, h: !0, name: "Dark Peach", i: [155, 82, 73] }, { id: 54, h: !0, name: "Peach", i: [209, 128, 120] }, { id: 55, h: !0, name: "Light Peach", i: [250, 182, 164] }, { id: 56, h: !0, name: "Dark Tan", i: [123, 99, 82] }, { id: 57, h: !0, name: "Tan", i: [156, 132, 107] }, { id: 58, h: !0, name: "Dark Slate", i: [51, 57, 65] }, { id: 59, h: !0, name: "Slate", i: [109, 117, 141] }, { id: 60, h: !0, name: "Light Slate", i: [179, 185, 209] }, { id: 61, h: !0, name: "Dark Stone", i: [109, 100, 63] }, { id: 62, h: !0, name: "Stone", i: [148, 140, 107] }, { id: 63, h: !0, name: "Light Stone", i: [205, 197, 158] }], l = class { constructor({ displayName: e = "My template", ia: t = 0, Ta: n = "", url: i = "", file: a = null, coords: o = null, N: s = null, M: l = 1e3 } = {}) { this.o = null, this.displayName = e, this.ia = t, this.Ta = n, this.url = i, this.file = a, this.coords = o, this.N = s, this.M = l, this.D = this.C = 0, this.B = {}, this.Ha = {}, this.q = new Set, this.sa = null, e = Array.isArray(r) ? r : [], this.ea = new Set(e.filter((e => "transparent" !== (e?.name || "").toLowerCase() && Array.isArray(e?.i))).map((e => `${e.i[0]},${e.i[1]},${e.i[2]}`))), this.ea.add("222,250,206"), this.ea.add("other"), this.ba = new Map(e.filter((e => Array.isArray(e?.i))).map((e => [`${e.i[0]},${e.i[1]},${e.i[2]}`, { id: e.id, h: !!e.h, name: e.name }]))); try { const t = e.find((e => "transparent" === (e?.name || "").toLowerCase())); t && Array.isArray(t.i) && this.ba.set("222,250,206", { id: t.id, h: !!t.h, name: t.name }) } catch (e) { } try { this.ba.set("other", { id: "other", h: !1, name: "Other" }) } catch (e) { } } async J() { const e = !0 === t ? this.file : await createImageBitmap(this.file), n = e.width, i = e.height; this.C = n * i; try { this.o = new OffscreenCanvas(n, i); var a = this.o.getContext("2d", { $a: !0, willReadFrequently: !0 }); a.imageSmoothingEnabled = !1, a.clearRect(0, 0, n, i), a.drawImage(e, 0, 0); for (var o = a.getImageData(0, 0, n, i).data, s = a = 0, r = new Map, l = 0; l < i; l++)for (var c = 0; c < n; c++) { var d = 4 * (l * n + c), h = o[d], g = o[d + 1], u = o[d + 2]; if (0 !== o[d + 3]) { 222 === h && 250 === g && 206 === u && s++; var m = this.ea.has(`${h},${g},${u}`) ? `${h},${g},${u}` : "other"; if ("other" == m && !t) return { Na: o, Sa: a, ka: !0 }; a++, r.set(m, (r.get(m) || 0) + 1) } } this.D = a, o = {}; for (const [e, t] of r.entries()) o[e] = { count: t, enabled: !0, ga: 0 }; this.B = o } catch (e) { this.D = Math.max(0, this.C) } for (r = {}, o = {}, g = (h = new OffscreenCanvas(this.M, this.M)).getContext("2d", { $a: !0, willReadFrequently: !0 }), u = this.coords[3]; u < i + this.coords[3];) { for (m = Math.min(this.M - u % this.M, i - (u - this.coords[3])), a = this.coords[2]; a < n + this.coords[2];) { l = 3 * (s = Math.min(this.M - a % this.M, n - (a - this.coords[2]))), c = 3 * m, h.width = l, h.height = c, g.imageSmoothingEnabled = !1, g.clearRect(0, 0, l, c), g.drawImage(e, a - this.coords[2], u - this.coords[3], s, m, 0, 0, 3 * s, 3 * m), d = g.getImageData(0, 0, l, c); for (var p = 0; p < c; p++)for (let e = 0; e < l; e++) { const t = 4 * (p * l + e); 222 === d.data[t] && 250 === d.data[t + 1] && 206 === d.data[t + 2] ? ((e + p) % 2 == 0 ? (d.data[t] = 0, d.data[t + 1] = 0, d.data[t + 2] = 0) : (d.data[t] = 255, d.data[t + 1] = 255, d.data[t + 2] = 255), d.data[t + 3] = 32) : e % 3 != 1 || p % 3 != 1 ? d.data[t + 3] = 0 : this.ea.has(`${d.data[t]},${d.data[t + 1]},${d.data[t + 2]}`) } for (g.putImageData(d, 0, 0), r[l = `${(this.coords[0] + Math.floor(a / 1e3)).toString().padStart(4, "0")},${(this.coords[1] + Math.floor(u / 1e3)).toString().padStart(4, "0")},${(a % 1e3).toString().padStart(3, "0")},${(u % 1e3).toString().padStart(3, "0")}`] = await createImageBitmap(h), this.q.add(l.split(",").slice(0, 2).join(",")), c = await (await h.convertToBlob()).arrayBuffer(), c = Array.from(new Uint8Array(c)), d = "", p = 0; p < c.length; p++)d += String.fromCharCode(c[p]); o[l] = btoa(d), a += s } u += m } return { Na: r, Sa: o, ka: t = !0, ja: this.o } } }, c = class { constructor() { this.o = JSON.parse(GM_getValue("GGImgList", '{"uuid":"", "l": []}')) } C(e, t, n) { const i = parseFloat((.75 * e.length / 1024).toFixed(1)), a = {}; a.name = t, a.coords = n, a.date = (new Date).toISOString(), a.size = i, a.key = "temp_key", a.active = !0, this.o.l.forEach((e => { e.active = !1 })), this.o.l[0] = a, GM.setValue("GGImgList", JSON.stringify(this.o)), GM.setValue("temp_key", e) } D(e) { const t = e.split(";")[0].split(":")[1]; e = atob(e.split(",")[1]); const n = new Uint8Array(e.length); for (let t = 0; t < e.length; t++)n[t] = e.charCodeAt(t); return new Blob([n], { type: t }) } }; const d = new class { constructor() { this.duration = 0, this.D = this.endTime = this.startTime = null, this.o = !1, this.C = null } S(e, t) { !e || e <= 0 || (this.o && this.J(), this.duration = e, this.startTime = new Date(t), this.endTime = new Date(this.startTime.getTime() + 1e3 * this.duration), this.o = !0, this.T(), this.D = setInterval((() => { this.T() }), 1e3)) } da(e, t) { !e || e <= 0 || !this.o || (this.J(), this.S(e, t)) } J() { this.D && (clearInterval(this.D), this.D = null), this.o = !1 } T() { const e = Math.max(0, this.endTime - new Date); if (e <= 0) this.X(); else { if (!document.querySelector("#bgz-timer")) { const e = Object.values(document.querySelectorAll(".z-30")).filter((e => "BUTTON" == e.nodeName && e.querySelector("canvas"))); if (e.length <= 0) return; const t = document.createElement("div"); t.className = "text-xs", t.id = "bgz-timer", t.style = "position:fixed;bottom:0px;color:chartreuse", e[0].appendChild(t) } this.C = document.querySelector("#bgz-timer"), this.C.textContent = `(Full in: ${this.ca(e)})` } } X() { this.J(), this.C && (this.C.textContent = "(FULL)") } ca(e) { e = Math.floor(e / 1e3); const t = Math.floor(e / 60), n = Math.floor(t / 60); return n > 0 ? `${n}h ${t % 60}m ${e % 60}s` : t > 0 ? `${t}m ${e % 60}s` : `${e}s` } }, h = new c; var g = new WeakSet, u = async function () { GM.setValue("GGTemplates", JSON.stringify(this.P)) }, m = async function (t) { if (t = t.qa, Object.keys(t).length > 0) { for (const s in t) { const r = s; var n = t[s]; if (t.hasOwnProperty(s)) { var i = r.split(" "), a = Number(i?.[0]); i = i?.[1] || "0"; const s = n.name || `Template ${a || ""}`, c = n.ub; n = {}; let d = 0; const h = new Map; for (const t in c) if (c.hasOwnProperty(t)) { var o = e(c[t]); o = await createImageBitmap(new Blob([o], { type: "image/png" })), n[t] = o; try { const e = o.width, t = o.height, n = new OffscreenCanvas(e, t).getContext("2d", { $a: !0, willReadFrequently: !0 }); n.imageSmoothingEnabled = !1, n.clearRect(0, 0, e, t), n.drawImage(o, 0, 0); const i = n.getImageData(0, 0, e, t).data; for (o = 0; o < t; o++)for (let t = 0; t < e; t++) { if (t % this.Wa != 1 || o % this.Wa != 1) continue; const n = 4 * (o * e + t), a = i[n], s = i[n + 1], r = i[n + 2]; if (i[n + 3] < 64) continue; if (222 === a && 250 === s && 206 === r) continue; d++; const l = this.ea.has(`${a},${s},${r}`) ? `${a},${s},${r}` : "other"; h.set(l, (h.get(l) || 0) + 1) } } catch (e) { } } const g = new l({ displayName: s, ia: a || this.H?.length || 0, Ta: i || "" }); g.N = n, g.D = d, a = {}; for (const [e, t] of h.entries()) a[e] = { count: t, enabled: !0, ga: 0 }; g.B = a; try { Object.keys(n).forEach((e => { g.q?.add(e.split(",").slice(0, 2).join(",")) })) } catch (e) { } try { if (a = t?.[r]?.Xa) for (const [e, t] of Object.entries(a)) g.B[e] ? g.B[e].enabled = !!t?.enabled : g.B[e] = { count: t?.count || 0, enabled: !!t?.enabled, ga: t?.ga || 0 } } catch (e) { } g.sa = r, this.H.push(g) } } try { const e = document.querySelector("#bgz-9"); e && (e.className = "oklch"), window.postMessage({ source: "bmz-gliz", pa: "bgz-b" }, "*") } catch (e) { } } }, p = new WeakSet; !function (e) { const t = document.createElement("script"); t.setAttribute("bgz-E", GM_info.script.name.toString()), t.setAttribute("bgz-B", "color: cornflowerblue;"), t.textContent = `(${e})();`, document.documentElement?.appendChild(t), t.remove() }((() => { const e = document.currentScript, t = e?.getAttribute("bgz-E") || "BM ⟐ Gliz", n = e?.getAttribute("bgz-B") || "", i = new Map; window.addEventListener("message", (e => { var a = e.data.source; const o = e.data.endpoint, s = e.data.Ba; e = e.data.Aa, Date.now(), "bmz-gliz" == a && s && e && !o && ("function" == typeof (a = i.get(s)) ? a(e) : (0, console.warn)(`%c${t}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`, n, "", s), i.delete(s)) })); const a = window.fetch; window.fetch = async function (...e) { const t = await a.apply(this, e), n = t.clone(), o = (e[0] instanceof Request ? e[0]?.url : e[0]) || "ignore"; if ((e = n.headers.get("content-type") || "").includes("application/json")) n.json().then((e => { window.postMessage({ source: "bmz-gliz", endpoint: o, hb: e }, "*") })).catch((() => { })); else if (e.includes("image/") && !o.includes("openfreemap") && !o.includes("maps")) { const e = Date.now(), t = await n.blob(); return new Promise((a => { const s = crypto.randomUUID(); i.set(s, (e => { a(new Response(e, { headers: n.headers, status: n.status, statusText: n.statusText })) })), window.postMessage({ source: "bmz-gliz", endpoint: o, Ba: s, Aa: t, blink: e }) })).catch((() => { Date.now() })) } return t } })); var y = GM_getResourceText("Style-File"); GM_addStyle(y), (c = document.createElement("link")).href = "https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap", c.rel = "preload", c.as = "style", c.onload = function () { this.onload = null, this.rel = "stylesheet" }, document.head?.appendChild(c), new class { constructor() { } observe(e, t = !1, n = !1) { e.observe(null, { childList: t, subtree: n }) } }; var b = new a(GM_info.script.name.toString(), GM_info.script.version.toString()), f = (new a(GM_info.script.name.toString(), GM_info.script.version.toString()), new class { constructor(e, t, i) { n(this, g), this.name = e, this.version = t, this.v = i, this.ka = null, this.M = 1e3, this.Wa = 3, this.H = [], this.P = null, this.T = !0, this.X = new Map, this.g = {}, this.Ea = !0, this.Ua = this.Qa = this.Oa = -1, this.ya = this.S = this.da = !1, this.C = "", this.tb = new MouseEvent("click", { bubbles: !0, cancelable: !0 }), this.g.I = { enabled: !1, U: { x: 100, y: 100, j: 0 } }, this.g.F = { active: !1, color: "#C300FF", type: 1 }, this.g.G = { h: !1, na: !0, la: !1, select: !1 }, this.g.alpha = "d0", this.g.backgroundColor = "#f8f4f0", this.g.fa = [], this.yb = r.filter((e => !1 === e.h)).map((e => e.i)), this.nb = r.map((e => e.i)), this.Cb() } async Cb() { try { this.wa(this.g).every((e => this.wa(JSON.parse(GM_getValue("Settings", "{}"))).includes(e))) ? this.g = this.ib() : (this.g.uuid = crypto.randomUUID(), this.o()) } catch (e) { console.warn(e), this.g.uuid = crypto.randomUUID(), this.o() } if (this.backgroundColor = this.g.backgroundColor, this.g.alpha = this.g.alpha, this.K = this.g.I.enabled, this.D = this.g.I.U, this.fa = this.g.fa, this.J = h.o, Object.keys(this.J).length > 0 && this.J.constructor === Object && "" !== this.J.uuid) try { var e = JSON.parse(GM_getValue("GGTemplates", "{}")); if (this.g.uuid == this.J.uuid) this.Db(e); else { GM_deleteValue("GGTemplates"), h.o.uuid = this.g.uuid, GM.setValue("GGImgList", JSON.stringify(h.o)); const e = Object.values(this.J.l).filter((e => !0 === e.active))[0], n = e.name, i = e.coords, a = h.D(GM_getValue(e.key, "")); t = !1, (await this.ca(a, n, i)).ja ? this.v.A("⟐ Drew successfully!") : this.v.A("⟐ Error loading image...") } } catch (e) { console.warn(e) } else this.J.uuid = this.g.uuid } wa(e, t = "") { let n = []; for (let i in e) "object" == typeof e[i] && null !== e[i] ? (n.push(t + i), n = n.concat(this.wa(e[i], t + i + "."))) : n.push(t + i); return n } Va(e) { e.addEventListener("touchmove", (function (e) { e.touches.length > 1 && e.preventDefault() })) } qb(e, t) { const n = e[0] - t[0], i = e[1] - t[1]; return e = e[2] - t[2], Math.sqrt(n * n + i * i + e * e) } pb(e, t) { let n = 1 / 0, i = null; return t.forEach((t => { const a = this.qb(e, t); a < n && (n = a, i = t) })), i } ob(e) { const t = e.data, n = e.width, i = e.height, a = this.g.G.h ? this.nb : this.yb; for (let e = 0; e < i; e++)for (let c = 0; c < n; c++) { var o = 4 * (e * n + c); if (t[o + 3] < 128) { t[o] = 0, t[o + 1] = 0, t[o + 2] = 0, t[o + 3] = 0; continue } t[o + 3] = 255; var s = t[o], r = t[o + 1], l = t[o + 2]; const d = this.pb([s, r, l], a); s -= d[0], r -= d[1], l -= d[2], t[o] = d[0], t[o + 1] = d[1], t[o + 2] = d[2], c + 1 < n && (t[o = 4 * (e * n + (c + 1))] += 7 * s / 16 * .7, t[o + 1] += 7 * r / 16 * .7, t[o + 2] += 7 * l / 16 * .7), c - 1 >= 0 && e + 1 < i && (t[o = 4 * ((e + 1) * n + (c - 1))] += 3 * s / 16 * .7, t[o + 1] += 3 * r / 16 * .7, t[o + 2] += 3 * l / 16 * .7), e + 1 < i && (t[o = 4 * ((e + 1) * n + c)] += 5 * s / 16 * .7, t[o + 1] += 5 * r / 16 * .7, t[o + 2] += 5 * l / 16 * .7), c + 1 < n && e + 1 < i && (t[o = 4 * ((e + 1) * n + (c + 1))] += s / 16 * .7, t[o + 1] += r / 16 * .7, t[o + 2] += l / 16 * .7) } return e } ab(e) { const t = document.createElement("canvas"), n = t.getContext("2d"), i = e.width, a = e.height; return t.width = i, t.height = a, n.drawImage(e, 0, 0), e = n.getImageData(0, 0, i, a), e = this.ob(e), n.putImageData(e, 0, 0), t } zb(e) { return Array.isArray(e) && 4 === e.length ? { kb: 360 / Math.PI * (Math.atan(Math.exp(Math.PI - 2 * Math.PI * ((1e3 * e[1] + e[3]) / 2048e3))) - Math.PI / 4), lb: (1e3 * e[0] + e[2]) / 2048e3 * 360 - 180 } : null } Ca(e, t = !1) { e && (t ? (this.g.V = t, e.style = "background-color:#063912;", this.v.A("⟐ Enabled single select colors.")) : (this.g.V = !this.g.V || !1, this.g.V ? e.style = "background-color:#063912;" : e.style = "background-color:#2d2d2d;", this.g.V ? this.v.A("⟐ Enabled single select colors.") : this.v.A("⟐ Disabled single select colors."), this.o())) } wb(e, t) { !function n() { if (e && t) { let i = t.getBoundingClientRect(), a = e.getBoundingClientRect(), o = a.x - Math.ceil(Math.abs(i.width - a.width) / 2); t.style.top = a.y - i.height - 4 + "px", t.style.left = `${o}px`, requestAnimationFrame(n) } }() } ib() { return JSON.parse(GM_getValue("Settings", "{}")) } o() { GM.setValue("Settings", JSON.stringify(this.g)) } ra() { this.K = !this.K, this.g.I.enabled = this.K, this.o(), this.Ra(), this.K ? this.v.A("⟐ Undocked panel • drag it!") : this.v.A("⟐ Docked panel") } xb(e) { this.K && document.querySelector("#bgz-g").childElementCount > 0 && (this.g.I.U.j = e.borderBoxSize[0].blockSize) } Ra() { setTimeout((() => { const e = document.querySelector("#bgz-9"), t = document.querySelector("#bgz-dock-btn"); let n; const i = document.querySelector("#bgz-stats"), a = document.getElementById("bgz-9-overlay"); e && (document.getElementById("btn-clon") ? n = document.getElementById("btn-clon") : (n = t.cloneNode(!1), n.id = "btn-clon", n.title = "Reset list colors", n.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.36-3.36L23 10M1 14l5.13 5.13A9 9 0 0 0 20.49 15"></path></svg>', n.style = n.style.cssText + "display:none;position:absolute;transform:translatex(-50%);left:50%;bottom:-20px", n.addEventListener("click", (() => { this.D = { x: 100, y: 100, j: 360 }, this.ra() })), document.getElementById("bgz-A")?.appendChild(n)), this.K ? (document.getElementById("bgz-colorList").classList.add("active"), e.classList.add("detached"), t && (t.classList.add("docked"), t.textContent = "⇲"), e.parentElement.parentElement !== a && (e.style.display = "grid", a.querySelector("#bgz-dockerContent").appendChild(e)), a.style.display = "flex", a.style.left = this.D.x + "px", a.style.top = this.D.y + "px", this.sb(a)) : (document.getElementById("bgz-colorList").classList.remove("active"), t.textContent = "⇱", a.style.display = "none", e.classList.remove("detached"), t && t.classList.remove("docked"), i && e.parentElement !== i && ("none" === window.getComputedStyle(document.getElementById("bgz-6")).display ? e.style.display = "none" : e.style.display = "block", i.appendChild(e)), e.style.position = "", e.style.left = "", e.style.top = "", e.style.zIndex = "", this.rb(a))) }), 100) } sb(e) { let t, n, i, a, o = !1; const s = e => e.touches && e.touches.length > 0 ? { x: e.touches[0].clientX, y: e.touches[0].clientY } : { x: e.clientX, y: e.clientY }, r = r => { if (r.target.closest("#bgz-dockerDrag") && !r.target.closest("button, input, select")) { var { x: d, y: h } = s(r); o = !0, t = d, n = h; var g = e.getBoundingClientRect(); i = g.left, a = g.top, e.style.cursor = "grabbing", e.style.transition = "none", document.addEventListener("mousemove", l), document.addEventListener("mouseup", c), document.addEventListener("touchmove", l, { passive: !1 }), document.addEventListener("touchend", c), r.preventDefault() } }, l = r => { if (o) { r.preventDefault(); var { x: l, y: c } = s(r); r = l - t; var d = c - n; e.style.left = i + r + "px", e.style.top = a + d + "px", this.D.x = i + r, this.D.y = a + d } }, c = () => { o && (o = !1, e.style.cursor = "", e.style.transition = "", this.g.I.U = this.D, this.o(), document.removeEventListener("mousemove", l), document.removeEventListener("mouseup", c), document.removeEventListener("touchmove", l), document.removeEventListener("touchend", c)) }; e.xa = r; const d = e.querySelector("#bgz-dockerDrag"); d && (d.addEventListener("mousedown", r), d.addEventListener("touchstart", r, { passive: !1 })) } rb(e) { const t = e.querySelector("#bgz-dockerDrag"); t && e.xa && (t.removeEventListener("mousedown", e.xa), t.removeEventListener("touchstart", e.xa), t.style.cursor = "") } async jb() { return { Ab: this.name.replace(/\s+/g, ""), Jb: this.version, Ib: "1.0.0", qa: {} } } async ca(e, n, a) { this.P || (this.P = await this.jb()), t ? this.v.A("⟐ Reducing color palette...") : this.v.A(`⟐ Creating template at ${a.join(", ")}...`), e = new l({ displayName: n, file: e, coords: a }); const { Na: o, Sa: s, ka: r, ja: c } = await e.J(); if (r && !t) return this.v.A("⟐ Raw template colors!"), !1; e.N = o, e.sa = "GG", this.P.qa.GG = { name: e.displayName, coords: a.join(", "), enabled: !0, ub: s, Xa: e.B }, this.H = [], this.H.push(e), e = (new Intl.NumberFormat).format(e.C), this.v.A(`⟐ Template created at ${a.join(", ")}! Total pixels: ${e}`); try { const e = document.querySelector("#bgz-9"); e && (e.className = "oklch"), window.postMessage({ source: "bmz-gliz", pa: "bgz-b" }, "*") } catch (e) { } return await i(this, g, u).call(this), setTimeout((() => { f.X.clear(), f.S = !0 }), 2500), f.g.fa = a, f.o(), { pa: !0, ja: c } } async cb(e, t) { if (!this.T) return e; this.da && (this.T = !1); const n = 3 * this.M; t = t[0].toString().padStart(4, "0") + "," + t[1].toString().padStart(4, "0"); var i = this.H; if (i.sort(((e, t) => e.ia - t.ia)), !i.some((e => !!e?.N && (e.q && e.q.size > 0 ? e.q.has(t) : Object.keys(e.N).some((e => e.startsWith(t))))))) return e; var a = i.map((e => { const n = Object.keys(e.N).filter((e => e.startsWith(t))); return 0 === n.length ? null : n.map((t => { const n = t.split(","); return { va: e.N[t], Gb: [n[0], n[1]], La: [n[2], n[3]], Kb: e } }))?.[0] })).filter(Boolean); if (0 === (i = a?.length || 0)) return e; var o = await createImageBitmap(e); const s = (e = new OffscreenCanvas(n, n)).getContext("2d", { willReadFrequently: !0 }); s.imageSmoothingEnabled = !1, s.drawImage(o, 0, 0, n, n), o = null; try { o = s.getImageData(0, 0, n, n).data } catch (u) { } const r = this.H.find((e => e.N && Object.keys(e.N).some((e => e.startsWith(t))))); let l = 0, c = 0, d = {}, h = 0; if (o) for (const m of a) try { const p = 3 * Number(m.La[0]), y = 3 * Number(m.La[1]), b = m.va.width, f = m.va.height, v = new OffscreenCanvas(b, f), w = v.getContext("2d", { willReadFrequently: !0 }); w.imageSmoothingEnabled = !1, w.drawImage(m.va, 0, 0); const x = w.getImageData(0, 0, b, f), C = x.data, L = new OffscreenCanvas(b, f), z = L.getContext("2d", { willReadFrequently: !0 }); z.fillStyle = "transparent" !== this.backgroundColor ? this.backgroundColor + this.g.alpha : "transparent", z.fillRect(0, 0, b, f); const S = z.getImageData(0, 0, b, f), E = S.data; function k(e, t, n, i, a, o = 2, s) { let r = 0 === s ? L : v; s = 0 === s ? E : C; for (let c = e - n; c <= e + n; c++)for (let d = t - n; d <= t + n; d++) { var l = Math.abs(c - e) + Math.abs(d - t); if (l <= n) { const e = 4 * (d * r.width + c); l = l > n - o ? a : i, s[e] = l[0], s[e + 1] = l[1], s[e + 2] = l[2], s[e + 3] = l[3] } } } function M(e, t, n, i, a) { let o = 0 === a ? L : v; a = 0 === a ? E : C; let [s, r, l, c] = i; for (i = -n; i <= n; i++)for (let h = -n; h <= n; h++) { var d = e + h; const n = t + i; d >= 0 && d < o.width && n >= 0 && n < o.height && (a[d = 4 * (n * o.width + d)] = s, a[d + 1] = r, a[d + 2] = l, a[d + 3] = c) } } a = []; const q = this.g.F.color.replace("#", ""), B = [parseInt(q.substr(0, 2), 16), parseInt(q.substr(2, 2), 16), parseInt(q.substr(4, 2), 16), 255]; for (let $ = 0; $ < f; $++)for (let j = 0; j < b; j++) { if (j % 3 != 1 || $ % 3 != 1) continue; var g = p + j; const I = y + $; if (g < 0 || I < 0 || g >= n || I >= n) continue; "transparent" === this.backgroundColor || this.g.G.na && this.ya || 0 !== o[4 * (I * n + g) + 3] && M(j, $, 1, [0, 0, 0, 0], 0); const T = 4 * ($ * b + j); if (C[T + 3] < 10) continue; const N = C[T], A = C[T + 1], D = C[T + 2], G = C[T + 3], H = o[g = 4 * (I * n + g)], O = o[g + 1], V = o[g + 2], F = o[g + 3]; g = `${N},${A},${D}`, r && r.B && r.B[g] && (r.B[g].enabled && h++, d[g] || (d[g] = { p: 0, w: 0 }), H === N && O === A && V === D && F === G ? (l++, d[g].p += 1, C[T + 3] = 0) : 0 !== F ? (c++, r.B[g].enabled && (a.push([j, $]), d[g].w += 1)) : r.B[g].enabled && this.g.F.active && this.g.G.la && (1 == this.g.F.type ? M(j, $, 1, B, 0) : k(j, $, 2, B, [0, 255, 0, 255], 1, 0)), r.B[g].enabled || (C[T + 3] = 0)) } this.g.F.active && a.forEach((e => { let [t, n] = e; 1 == this.g.F.type ? M(t, n, 1, B, 0) : k(t, n, 4, B, [0, 255, 0, 255], 1, 0) })), z.putImageData(S, 0, 0), w.putImageData(x, 0, 0), s.drawImage(L, p, y), s.drawImage(v, p, y) } catch (R) { console.warn("Error calculating pixel stats:", R) } return i > 0 ? this.X.set(t, { Eb: l, required: h, Fb: c, W: d }) : this.v.A(`⟐ Displaying ${i} templates.`), this.da && (this.T = !0, this.da = !1), await e.convertToBlob({ type: "image/png" }) } Db(e) { 0 === Object.keys(e).length && e.constructor === Object || (this.P = e), "BM⟐Gliz" == e?.Ab && i(this, g, m).call(this, e) } Ja(e) { this.T = e } Pa(e, t) { for (let n in e) { const i = e[n]; "object" == typeof i && null !== i ? (t[n] || (t[n] = {}), this.Pa(i, t[n])) : t[n] = (t[n] || 0) + i } } Bb() { const e = {}, t = { L: 0, R: 0, Z: 0, O: {} }; try { if (this.X.size < 1) return; this.X.forEach((t => { this.Pa(t, e) })); for (const n of this.H) for (const [i, a] of Object.entries(n.B || {})) e.W[i] || (e.W[i] = { p: 0, w: 0 }), a.enabled && (t.L += a.count, t.R += e.W[i].p, t.Z += e.W[i].w), t.O[i] = { required: a.count || 0, oa: e.W[i].p || 0, left: a.count - (e.W[i].p || 0), enabled: a.enabled }, n.B[i].ga = t.O[i].oa } catch (e) { console.warn("Error getting pixel stats:", e) } return f.o(), t } async za() { try { const e = f.H?.[0], t = e?.sa; e && t && f.P?.qa?.[t] && (f.P.qa[t].Xa = e.B, GM.setValue("GGTemplates", JSON.stringify(f.P))); const n = document.querySelector("#bgz-69")?.querySelector("div:first-child"); n && (n.innerHTML = "♻️ Statistics...", n.classList.remove("animate")) } catch (e) { console.warn("Error updating color setting:", e) } } Fa(e) { this.backgroundColor = e; try { this.g.backgroundColor = e, this.o() } catch (e) { } this.v && this.v.A(`⟐ Background color: ${e}`) } Ya(e, t, n) { this.g.F = { active: n, color: e, type: t }, this.o(), this.v && this.v.A(`⟐ Highlight ${0 == n ? "disabled" : `enabled: ${e}`}.`) } Ga(e) { let t = document.getElementById("bgz-error-color")?.value, n = this.g.F?.active || !1; n = 1 != n || this.g.F?.type != e, this.Ya(t, e, n), document.querySelectorAll(".bgz-highlight-btn").forEach((t => { t.classList.remove("active"), t.querySelector("" + (1 == e ? "path" : "rect"))?.setAttribute("fill", "currentColor") })); const i = 1 == e ? document.getElementById("bgz-square-btn") : document.getElementById("bgz-diamond-btn"); 1 == n ? (i?.classList?.add("active"), i?.querySelector("" + (1 == e ? "rect" : "path"))?.setAttribute("fill", t), document.getElementById("gg-wrongs").setAttribute("t", e), document.documentElement.style.setProperty("--color-hl", t), document.getElementById("gg-wrongs").classList.add("active")) : (i?.querySelector("" + (1 == e ? "rect" : "path"))?.setAttribute("fill", "currentColor"), document.getElementById("gg-wrongs").classList.remove("active")) } Da(e = !1) { const t = f.Bb(); if (t) { var n = document.querySelector("#dbz-1"), i = document.querySelector("#bgz-g"); !n || i.childElementCount <= 0 || this.S ? window.o(t) : (t.R !== f.Oa || t.L != f.Qa || t.Z != f.Ua || e) && (f.Oa = t.R, f.Qa = t.L, f.Ua = t.Z, setTimeout((() => { if (n && t) { var e = t.L > 0 ? Math.round(t.R / t.L * 100) : 0; document.documentElement.style.setProperty("--pa", e >= 85 ? "#4caf4f42" : e >= 50 ? "#ff990042" : "#f4433642"), document.documentElement.style.setProperty("--pb", e >= 85 ? "#4caf4f83" : e >= 50 ? "#ff990083" : "#f4433683"), n.innerHTML = `⟐ <span style="color: #64b5f6">${t.R.toLocaleString()}</span>/<span>${t.L.toLocaleString()}</span> • <span style="color: ${e >= 80 ? "#4caf50" : e >= 50 ? "#ff9800" : "#f44336"}">${e}%</span> ⟐`, n.style.setProperty("--progress-width", e + "%"), n.classList.remove("low-progress", "medium-progress", "high-progress", "complete-progress", "animate"), 0 === e || e < 30 ? n.classList.add("low-progress") : e < 70 ? n.classList.add("medium-progress") : e < 100 ? n.classList.add("high-progress") : n.classList.add("complete-progress"), n.classList.add("animate"), this.bb(t), this.v.A(`⟐ Wrong Pixel${1 == t.Z ? "" : "s"} ${t.Z}.`) } }), 100)) } } bb(e) { document.querySelectorAll("#bgz-g > div").forEach((t => { const n = t.querySelector("div[name]"); var i = t.querySelector("input"); const a = t.querySelector("#box-color"); if (n) { var o = n.getAttribute("name"); if (o && e.O) { var s = Object.keys(e.O).find((e => f.H?.[0]?.ba?.get(e)?.name === o)); if (s && e.O[s]) { const o = e.O[s].enabled; let r = 1; i.checked = o, i = (i = e.O[s]).required > 0 ? Math.round(i.oa / i.required * 100) : 0, o || (r = .5, i = 0), n.style.opacity = a.style.opacity = r, t.style.setProperty("--item-progress", i + "%"), t.classList.remove("low-progress", "medium-progress", "high-progress", "complete-progress"), 0 === i || i < 30 ? t.classList.add("low-progress") : i < 70 ? t.classList.add("medium-progress") : i < 100 ? t.classList.add("high-progress") : t.classList.add("complete-progress") } } } })) } Za(e, t) { function n(e) { const t = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX; e.type.includes("mouse"), "touchstart" === e.type && e.preventDefault(), c = l = !1, r = t } function i(e) { if (r && !c) { var t = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX; e.type.includes("mouse"), e = t - r, Math.abs(e) > 10 && (l = !0, t = Math.min(Math.abs(e) / 40, 1), e > 0 ? s.style.transform = `translateX(${Math.min(e, 40)}px) scale(${1 + .1 * t})` : (s.classList.remove("swiping"), o())) } } function a(n) { if (r) { var i = n.type.includes("mouse") ? n.clientX : n.changedTouches[0].clientX; "touchend" === n.type && n.preventDefault(), n = i - r, l && n > 40 ? (c = !0, "bg" == t && (document.querySelector("#zbg-controls").style.display = "flex", setTimeout((() => { document.querySelector("#zbg-controls")?.classList.add("active") }), 250)), "wrongs" == t && (document.querySelector("#z-error-highlight").style.display = "flex", setTimeout((() => { document.querySelector("#z-error-highlight")?.classList.add("active") }), 250)), setTimeout((() => { o(), s.classList.remove("swipe-complete") }), 100), r = 0, l = !1) : Math.abs(n) < 5 ? ("bg" == t && ("transparent" != f.backgroundColor ? (document.getElementById("bg-bg").classList.remove("active"), f.Fa("transparent")) : (document.getElementById("bg-bg").classList.add("active"), f.Fa(document.documentElement.style.getPropertyValue("--color-bg")))), "wrongs" == t && f.Ga(parseInt(e.parentElement.getAttribute("t")) || 1), setTimeout((() => { o() }), 100)) : o(), c || (r = 0, l = !1) } } function o() { s.style.transform = "" } const s = e; let r = 0, l = !1, c = !1; s.addEventListener("mousedown", n), s.addEventListener("touchstart", n), document.addEventListener("mousemove", i), document.addEventListener("touchmove", i), document.addEventListener("mouseup", a), document.addEventListener("touchend", a), s.addEventListener("contextmenu", (e => { e.preventDefault() })) } }(GM_info.script.name.toString(), GM_info.script.version.toString(), b)); a = new class { constructor(e) { n(this, p), this.u = e, this.Ma = [] } mb(e) { window.addEventListener("message", (async t => { var n, i, a = t.data; if (t = a.hb, a && "bmz-gliz" === a.source && a.endpoint) switch (a.endpoint?.split("?")[0].split("/").filter((e => e && isNaN(Number(e)))).filter((e => e && !e.includes("."))).pop()) { case "me": if (t.status && "2" != t.status?.toString()[0]) return void e.ua("⟐ You are not logged in!\nCould not fetch userdata."); var o = Math.ceil(Math.pow(9.12281389923994 * Math.floor(t.level), 1 / .65) - t.pixelsPainted); t.id || t.id, this.u.ka = t.id, e.aa("bgz-u", `Username: <b>${function (e) { const t = document.createElement("div"); return t.textContent = e, t.innerHTML }(t.name)}</b>`), e.aa("bgz-p", `Droplets: <b>${(new Intl.NumberFormat).format(t.Hb)}</b>`), e.aa("bgz-i", `Next level in <b>${(new Intl.NumberFormat).format(o)}</b> pixel${1 == o ? "" : "s"}`), o = new Date, t = 30 * (t.charges.max - t.charges.count), d.o ? d.da(t, o) : d.S(t, o); break; case "pixel": if (t = a.endpoint.split("?")[0].split("/").filter((e => e && !isNaN(Number(e)))), a = [(a = new URLSearchParams(a.endpoint.split("?")[1])).get("x"), a.get("y")], this.Ma.length && (!t.length || !a.length)) return void e.ua("⟐ Coordinates are malformed!\nDid you try clicking the canvas first?"); this.Ma = [...t, ...a]; const s = (n = t, i = a, [parseInt(n[0]) % 4 * 1e3 + parseInt(i[0]), parseInt(n[1]) % 4 * 1e3 + parseInt(i[1])]); for (o of n = document.querySelectorAll("span")) o.textContent.trim().includes(`${s[0]}, ${s[1]}`) && (n = document.querySelector("#bgz-h"), i = `(Tl X: ${t[0]}, Tl Y: ${t[1]}, Px X: ${a[0]}, Px Y: ${a[1]})`, n ? n.textContent = i : ((n = document.createElement("span")).id = "bgz-h", n.textContent = i, n.style = "margin-left: calc(var(--spacing)*3); font-size: small;", o.parentNode.parentNode.parentNode.insertAdjacentElement("afterend", n))); break; case "tiles": t = a.endpoint.split("/"), t = [parseInt(t[t.length - 2]), parseInt(t[t.length - 1].replace(".png", ""))], o = a.Ba, t = await this.u.cb(a.Aa, t), window.postMessage({ source: "bmz-gliz", Ba: o, Aa: t, blink: a.blink }) } })) } }(f), b.C(a), function () { let e = !1; try { JSON.parse(GM_getValue("GGCoords", "{}")) } catch (e) { } b.m({ id: "bgz-A", style: "top: 10px; right: 75px; min-width: 230px;" }).m({ id: "bgz-j" }).m({ id: "bgz-z" }).j().m({ id: "dbz", style: "display: flex;align-items: center;justify-content: flex-start;background:linear-gradient(0deg, #0c1412, transparent);padding:0px 4px 0px 4px;border-radius: 10px;" }).Ia({ id: "dbz-img", alt: "Click to minimize/maximize", src: "https://github.com/yui-ho/WPlace-GGliz/blob/main/src/ico_1.png?raw=true", style: "cursor: pointer;background: linear-gradient(45deg, #ff000040, #ffa50040, #ffff0040, #00800040, #0000ff40, #4b008240, #ee82ee40);background-size: 400% 400%;animation: rainbow 10s ease infinite;padding:1px;border-radius:50%;margin-bottom:3px;min-height: 4em;" }, ((t, n) => { n.addEventListener("click", (() => { e = !e; const i = document.querySelector("#bgz-A"), a = document.querySelector("#bgz-j"), o = document.querySelector("#bgz-z"), s = document.querySelector("#bgz-bg-controls"), r = document.querySelector("#bgz-error-highlight"), l = document.querySelector("#up"), c = document.querySelector("#bgz-options"), d = document.querySelector("#btn-clon"); e || (i.style.width = "auto", i.style.maxWidth = "24px", i.style.minWidth = "230px", i.style.padding = "10px"), ["#bgz-A h1", "#bgz-f", "#bgz-A hr", "#bgz-6", `#${t.gb}`, f.g.I.enabled ? "#bgz-6" : "#bgz-9"].forEach((t => { document.querySelectorAll(t).forEach((t => { t.style.display = e ? "none" : "" })) })), e ? (c && (c.style.display = "none"), d && (d.style.display = "flex"), l && (l.style.display = "none"), r && (r.style.display = "none"), s && (s.style.display = "none"), i.style.width = "80px", i.style.height = "90px", i.style.maxWidth = "80px", i.style.minWidth = "60px", i.style.padding = "8px", n.style.marginLeft = "0px", a.style.textAlign = "center", a.style.margin = "0", a.style.marginBottom = "0", o && (o.style.display = "", o.style.marginBottom = "0.25em") && (document.getElementById("dbz").querySelector("img").src = "https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_1.png")) : (c && (c.style.display = ""), d && (d.style.display = "none"), l && (l.style.display = "none"), l && (document.getElementById("dbz").querySelector("img").src = "https://raw.githubusercontent.com/yui-ho/WPlace-GGliz/refs/heads/main/src/ico_2.png"), r && (r.style.display = "flex"), s && (s.style.display = "flex"), n.style.marginLeft = "", i.style.padding = "10px", a.style.textAlign = "", a.style.margin = "", a.style.marginBottom = "", o && (o.style.marginBottom = "0.5em"), i.style.width = "", i.style.height = ""), n.alt = e ? "Minimized (Click to maximize)" : "Maximized (Click to minimize)", e || (f.g.I.enabled ? document.getElementById("bgz-9").style.display = "grid" : document.getElementById("bgz-9").style.display = "block") })) })).j().eb().j().j().j().Ka().j().m({ id: "bgz-f" }).$({ id: "bgz-u", textContent: "Username:", style: "margin-bottom: 3px; font-size: 12px;" }).j().$({ id: "bgz-p", textContent: "Droplets:", style: "display: none" }).j().$({ id: "bgz-i", textContent: "Next level in...", style: "display: none" }).j().j().Ka().j().m({ id: "bgz-bg-controls", style: "gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;" }).$({ textContent: "BG:", style: "font-size: 11px; font-weight: bold;" }).j().ta({ type: "color", id: "bgz-bg-color", value: "#ffffff", title: "Background color", style: "width: 50px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;" }, ((e, t) => { t.addEventListener("change", (() => { e.t?.u?.Fa(t.value), document.documentElement.style.setProperty("--color-bg", t.value), document.getElementById("bg-bg").classList.add("active") })), setTimeout((() => { "transparent" !== e.t?.u?.backgroundColor ? (t.value = e.t?.u?.backgroundColor, document.documentElement.style.setProperty("--color-bg", e.t?.u?.backgroundColor), document.getElementById("bg-bg").classList.toggle("active")) : document.documentElement.style.setProperty("--color-bg", "#F8F4F0") }), 250) })).j().m({ style: "display: flex; grid-column: 1/-1; align-items: center; justify-content: space-between;margin-left:3px", innerHTML: '<div id="slider-title"></div>' }).ta({ type: "range", id: "alphaSlider", min: "0", max: "255", value: "255", style: "width: 100%;" }, ((e, t) => { t.addEventListener("input", (() => { var e = document.getElementById("slider-title"); const n = (t.parentNode.parentNode.getBoundingClientRect().width - 80) / 2; e.textContent = `Alpha: ${t.value}`, e.style.left = `${n}px`, e.style.top = `-${t.parentNode.parentNode.getBoundingClientRect().height - 2}px`, e.style.visibility = "visible", e = 1 === (e = parseInt(t.value).toString(16).toUpperCase()).length ? "0" + e : e, f.g.alpha = e })), t.addEventListener("change", (() => { const e = document.getElementById("slider-title"); setTimeout((() => { e.style.visibility = "hidden" }), 500) })), setTimeout((() => { t.value = parseInt(f.g.alpha, 16) }), 500) })).j().j().j().j().m({ id: "bgz-error-highlight", style: "gap: 5px; align-items: center; padding: 4px; border-radius: 6px; border: 1px solid rgb(64, 64, 64); margin: 4px 0px; display: none;" }).$({ textContent: "HL:", style: "font-size: 11px; font-weight: bold;" }).j().ta({ type: "color", id: "bgz-error-color", className: "bgz-highlight-btn", value: "#15ff00", style: "width: 35px; height: 24px; padding: 0; border: 1px solid #404040; border-radius: 3px;", title: "highlighter color" }, ((e, t) => { t.addEventListener("change", (() => { let n = e.t?.u?.g.F?.type || 1; e.t?.u?.Ya(t.value, n, !0), document.querySelectorAll(".bgz-highlight-btn").forEach((e => { e.classList.remove("active") })), 1 == n ? document.querySelector("#bgz-square-btn")?.querySelector("rect")?.setAttribute("fill", t.value) : document.querySelector("#bgz-diamond-btn")?.querySelector("path")?.setAttribute("fill", t.value), document.querySelector(1 == n ? "#bgz-square-btn" : "#bgz-diamond-btn")?.classList.add("active"), document.getElementById("gg-wrongs").classList.add("active"), document.documentElement.style.setProperty("--color-hl", t.value) })), setTimeout((() => { let n = e?.t?.u?.g?.F?.color || "#9900ff", i = e.t?.u?.g?.F?.type || 1; t.value = n, document.documentElement.style.setProperty("--color-hl", n), document.getElementById("gg-wrongs").setAttribute("t", i) }), 250) })).j().m({ style: "display: flex; gap: 8px; grid-column: 1 / -1; align-items: center; justify-content: space-between;" }).k({ id: "bgz-square-btn", className: "bgz-highlight-btn", style: "width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;", title: "Square mode", innerHTML: '<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <rect x="3" y="3" width="10" height="10" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>' }, ((e, t) => { t.onclick = () => { e.t?.u?.Ga(1) }, setTimeout((() => { e.t?.u?.g?.F?.active && 1 == e.t?.u?.g.F.type && (t.classList.add("active"), t.querySelector("rect")?.setAttribute("fill", e.t?.u?.g.F.color), document.getElementById("gg-wrongs").classList.toggle("active")) }), 500) })).j().k({ id: "bgz-diamond-btn", className: "bgz-highlight-btn", style: "width: 20px; height: 20px; padding: 0px; min-width: auto; border: 1px solid;border-radius: 3px;", title: "Diamond mode", innerHTML: '<svg style="width: 100%; height: 100%; display: block;" width="16" height="16" viewBox="0 0 16 16" style="display: block;">\n            <path d="M8 3 L13 8 L8 13 L3 8 Z" fill="currentColor" stroke="#64b5f6" stroke-width="1"/></svg>' }, ((e, t) => { t.onclick = () => { e.t?.u?.Ga(2) }, setTimeout((() => { e.t?.u?.g?.F?.active && 2 == e.t?.u?.g.F.type && (t.classList.add("active"), t.querySelector("path")?.setAttribute("fill", e.t?.u?.g.F.color), document.getElementById("gg-wrongs").classList.toggle("active")) }), 500) })).j().j().j().m({ id: "bgz-stats", style: "display: none; justify-content: center" }).m({ id: "bgz-9", style: "position: relative;" }).m({ style: "display:flex; flex-direction: row; flex-wrap: wrap; align-content: center; justify-content: center; align-items: center; gap: 2px; padding: 4px" }).k({ id: "bgz-3", textContent: "Full🎨", title: "Activate all colors", style: "min-width: 47px" }, ((e, t) => { t.onclick = () => { const t = f.H[0]; t?.B && (Object.values(t.B).forEach((e => e.enabled = !0)), f.za(), e.A("⟐ Enabled all colors")), setTimeout((() => { f.Da(!0) }), 1e3) } })).j().k({ id: "bgz-0", textContent: "No🎨", title: "Deactivate all colors", style: "min-width: 47px" }, ((e, t) => { t.onclick = () => { const t = f.H[0]; t?.B && (Object.values(t.B).forEach((e => e.enabled = !1)), f.za(), e.A("⟐ Disabled all colors")) } })).j().k({ id: "bgz-96", textContent: "Single🎨", title: "Single selection mode", style: "min-width: 47px" }, ((e, t) => { t.onclick = () => { f.Ca(t) }, setTimeout((() => { f.g.V ? t.style = "background-color:#063912;" : t.style = "background-color:#2d2d2d;" }), 200) })).j().k({ id: "bgz-dock-btn", style: "width: 25px;padding: 0px;min-width: 20px;border: 0px solid;border-radius: 6px;min-height: 20px;font-size:medium;background-color: #4F1D6F;", title: "Dock/Undock panel", textContent: "⇱" }, ((e, t) => { t.onclick = () => { e.t?.u?.ra() } })).j().j().m({ id: "bgz-69", style: "animation: pulseProgress 2s ease-in-out infinite;" }).j().m({ id: "bgz-g", className: "bgz-scroll" }).j().j().j().j().m({ id: "bgz-options", style: "border: 1px solid #8a70a3;border-radius:5px;margin-top: 10px;padding: 0px 5px 5px 5px;font-size: x-small;background: #1a1a1a;", innerHTML: '<label style="position:relative;top:-8px;background: #1a1a1a;">⚙️OPTIONS</label>' }).ha({ id: "bgz-op1", textContent: "Use premium colors in image conversion.", style: "margin-right:5px;" }, ((e, t) => { t.style.display = "flex", t.querySelector("input").addEventListener("change", (function () { f.g.G.h = !f.g.G.h, f.o() })), setTimeout((() => { f.g.G.h && (t.querySelector("input").checked = !0) }), 500) })).j().ha({ id: "bgz-op2", textContent: "Use background overlay when painting.", style: "margin-right:5px;" }, ((e, t) => { t.style.display = "flex", t.querySelector("input").addEventListener("change", (function () { f.g.G.na = !f.g.G.na, f.o() })), setTimeout((() => { f.g.G.na && (t.querySelector("input").checked = !0) }), 500) })).j().ha({ id: "bgz-op3", textContent: "Use highlighter on unpainted pixels.", style: "margin-right:5px;" }, ((e, t) => { t.style.display = "flex", t.querySelector("input").addEventListener("change", (function () { f.g.G.la = !f.g.G.la, f.o() })), setTimeout((() => { f.g.G.la && (t.querySelector("input").checked = !0) }), 500) })).j().ha({ id: "bgz-op4", textContent: "Disable auto select by color.", style: "margin-right:5px;" }, ((e, t) => { t.style.display = "flex", t.querySelector("input").addEventListener("change", (function () { f.g.G.select = !f.g.G.select, f.o() })), setTimeout((() => { f.g.G.select && (t.querySelector("input").checked = !0) }), 500) })).j().j().Ha({ id: "bgz-o", placeholder: `⟐ Status: Sleeping...\nVersion: ${GM_info.script.version.toString()}`, readOnly: !0 }).j().m({ id: "bgz-6" }).m().k({ id: "bgz-m", className: "bgz-D", innerHTML: "🎨", title: "Template Color Converter" }, ((e, t) => { t.addEventListener("click", (() => { window.open("https://pepoafonso.github.io/color_converter_wplace/", "_blank", "noopener noreferrer") })) })).j().k({ id: "bgz-n", className: "bgz-D", innerHTML: "🌐", title: "My GibHub page" }, ((e, t) => { t.addEventListener("click", (() => { window.open("https://github.com/yui-ho/WPlace-GGliz/", "_blank", "noopener noreferrer") })) })).j().j().fb().j().j().p(document.body), b.m({ id: "bgz-9-overlay" }, ((e, t) => { new ResizeObserver((t => { if (e.t?.u?.K) for (let n of t) e.t?.u?.xb(n) })).observe(t) })).m({ id: "bgz-dockerDrag" }).j().m({ id: "bgz-dockerContent" }).p(document.body), b.m({ id: "floating-bottons", style: "position: fixed;left: 5px;top: 35%;transform: translateY(-50%);max-width: 180px;height: auto;display:grid;align-content:space-around;gap:4px;z-index:51" }).m({ id: "menu-wrapper-bg", className: "menu-wrapper", style: "height:40px; display:flex;" }).m({ className: "gg-izi", id: "bg-bg", title: "Background [On/Off]" }).m({ className: "arrow", textContent: "»", style: "color: var(--color-bg);" }).j().k({ id: "bg-btn", className: "toggle-button-gg", innerHTML: '<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.1893 1.75H4.5C2.98122 1.75 1.75 2.98122 1.75 4.5V10.1893L10.1893 1.75ZM1.75 12.3107V15.6893L15.6893 1.75H12.3107L1.75 12.3107ZM17.8107 1.75L1.75 17.8107V19.5C1.75 19.9869 1.87652 20.4442 2.09848 20.8409L20.8409 2.09848C20.4442 1.87652 19.9869 1.75 19.5 1.75H17.8107ZM21.9015 3.15914L3.15914 21.9015C3.55582 22.1235 4.01313 22.25 4.5 22.25H6.18934L22.25 6.18934V4.5C22.25 4.01313 22.1235 3.55582 21.9015 3.15914ZM22.25 8.31066L8.31066 22.25H11.6893L22.25 11.6893V8.31066ZM22.25 13.8107L13.8107 22.25H19.5C21.0188 22.25 22.25 21.0188 22.25 19.5V13.8107Z" fill="currentColor"/></svg>', style: "color: var(--color-bg);" }, ((e, t) => { setTimeout((() => { e.t?.u?.Za(t, "bg") }), 1e3) })).j().j().j().m({ id: "menu-wrapper-wb", className: "menu-wrapper", style: "height:40px; display:flex;" }).m({ className: "gg-izi", id: "gg-wrongs", title: "Highlighter [On/Off]" }).m({ className: "arrow", textContent: "»", style: "color: var(--color-hl);" }).j().k({ id: "wrongs", className: "toggle-button-gg", innerHTML: '<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2045 2.96963C13.4974 2.67677 13.9723 2.67679 14.2652 2.96967L22.0299 10.7344C22.1705 10.875 22.2495 11.0658 22.2495 11.2647C22.2495 11.4637 22.1705 11.6544 22.0298 11.7951L17.795 16.0292C17.5021 16.3221 17.0273 16.3221 16.7344 16.0292L8.96967 8.26448C8.82901 8.12382 8.74999 7.93304 8.75 7.73412C8.75001 7.53519 8.82904 7.34442 8.96971 7.20377L13.2045 2.96963ZM8.26071 9.32422L7.20313 10.3818C7.00457 10.5804 6.93375 10.873 7.0189 11.14C7.03956 11.3177 7.09106 11.8189 7.03675 12.1628C6.92988 12.8396 6.56515 13.8433 5.43842 14.97C5.14553 15.2629 5.14553 15.7378 5.43842 16.0307L8.96645 19.56C9.25935 19.8529 9.73422 19.8529 10.0271 19.56C11.1538 18.4333 12.1575 18.0685 12.8343 17.9617C13.1783 17.9074 13.6795 17.9588 13.8572 17.9795C14.1242 18.0647 14.4168 17.9938 14.6153 17.7953L15.6736 16.7371L8.26071 9.32422ZM1.96238 19.9755L4.74997 17.1094L7.87102 20.2315L7.01621 21.0425C6.87687 21.1747 6.6921 21.2484 6.50002 21.2484H2.50002C2.19857 21.2484 1.92641 21.0679 1.80912 20.7902C1.69183 20.5125 1.7522 20.1916 1.96238 19.9755Z" fill="currentColor"/></svg>', style: "color: var(--color-hl);" }, ((e, t) => { setTimeout((() => { e.t?.u?.Za(t, "wrongs") }), 1e3) })).j().j().j().m({ className: "gg-izi", id: "bgz-colorList", title: "List colors [hide/unhide]" }).k({ id: "colorList-btn", className: "toggle-button-gg", innerHTML: '<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512" fill="currentColor"><path d="M416,352c-12.6-.84-21-4-28-12-14-16-14-36,5.49-52.48l32.82-29.14c50.27-44.41,50.27-117.21,0-161.63C389.26,64.14,339.54,48,287.86,48c-60.34,0-123.39,22-172,65.11-90.46,80-90.46,210.92,0,290.87,45,39.76,105.63,59.59,165.64,60h1.84c60,0,119.07-19.5,161.2-56.77C464,390,464,385,444.62,355.56,440,348,431,353,416,352ZM112,208a32,32,0,1,1,32,32A32,32,0,0,1,112,208Zm40,135a32,32,0,1,1,32-32A32,32,0,0,1,152,343Zm40-199a32,32,0,1,1,32,32A32,32,0,0,1,192,144Zm64,271a48,48,0,1,1,48-48A48,48,0,0,1,256,415Zm72-239a32,32,0,1,1,32-32A32,32,0,0,1,328,176Z"/></svg>', style: "border: 3px solid #404040;background:#2d2d2d; color: #6b9af1" }, ((e, t) => { t.onclick = () => { f.g.I.enabled ? (document.querySelector("#bgz-9-overlay").style.display = "flex" == document.querySelector("#bgz-9-overlay").style.display ? "none" : "flex", document.getElementById("bgz-colorList").classList.toggle("active")) : document.querySelector("#bgz-dock-btn")?.click() } })).j().j().j().m({ className: "gg-izi", id: "bgz-template", title: "Template [On/Off]" }).k({ id: "template-btn", className: "toggle-button-gg", innerHTML: '<svg style="width:35px;height:35px;padding:5px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M17 2C17.5523 2 18 2.44772 18 3V6H21C21.5523 6 22 6.44772 22 7C22 7.55228 21.5523 8 21 8H18V16H21C21.5523 16 22 16.4477 22 17C22 17.5523 21.5523 18 21 18H18V21C18 21.5523 17.5523 22 17 22C16.4477 22 16 21.5523 16 21V18H8V21C8 21.5523 7.55228 22 7 22C6.44772 22 6 21.5523 6 21V18H3C2.44772 18 2 17.5523 2 17C2 16.4477 2.44772 16 3 16H6V8H3C2.44772 8 2 7.55228 2 7C2 6.44772 2.44772 6 3 6H6V3C6 2.44772 6.44772 2 7 2C7.55228 2 8 2.44772 8 3V6H16V3C16 2.44772 16.4477 2 17 2ZM8 16H16V8H8V16Z" fill="currentColor"/></svg>', style: "border: 3px solid #404040;background:#2d2d2d;color:white" }, ((e, t) => { t.onclick = () => { e.t.u.Ea = !e.t.u.Ea, e.t?.u?.Ea ? (e.t?.u?.Ja(!0), e.A("⟐ Enabled templates!")) : (e.t?.u?.Ja(!1), e.A("⟐ Disabled templates!")), document.getElementById("bgz-template").classList.toggle("active") }, setTimeout((() => { document.getElementById("bgz-template").classList.toggle("active"), ["floating-bottons", "floating-bottons-right", "top-bar", "bgz-A"].forEach((t => { (t = document.querySelector(`#${t}`)) && e.t?.u?.Va(t) })) }), 100) })).p(document.body), b.m({ id: "bgz-image-preview" }).j().m({ id: "preview" }).m({ style: "color: white; margin-bottom: 15px; font-family: Arial, sans-serif;", innerHTML: "<h3>Color reduction was applied.</h3>" }).j().Ia({ id: "bgz-iv" }).j().m({ style: "margin-top: 15px;display: flex;gap: 10px;justify-content: center;" }).k({ className: "bgz-preview", style: "background: #27ae60;", textContent: "💾 Save" }, ((e, t) => { t.addEventListener("click", (function () { const e = document.createElement("a"); e.href = document.querySelector("#bgz-iv") ? document.querySelector("#bgz-iv").src : "", e.download = `WGliz-${Date.now()}.png`, e.click() })) })).j().k({ className: "bgz-preview", style: "background: #e74c3c;", textContent: "❌ Close" }, ((e, t) => { t.addEventListener("click", (function () { document.querySelector("#bgz-image-preview") && (document.querySelector("#bgz-image-preview").style.display = "none") })) })).p(document.body), b.m({ id: "top-bar", className: "top-bar" }).p(document.body), b.m({ id: "floating-bottons-right", className: "floating-bottons", style: "position: fixed;right: 5px;top: 50%;transform: translateY(-50%);max-width: 170px;height: auto;display:grid;align-content:space-around;gap:4px;z-index:500" }).m({ className: "gg-izi right", id: "gliz-search", title: "Fnd a place" }).k({ id: "search-btn", className: "toggle-button-gg", innerHTML: '<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor"><path d="M408 120C408 174.6 334.9 271.9 302.8 311.1C295.1 321.6 280.9 321.6 273.2 311.1C241.1 271.9 168 174.6 168 120C168 53.73 221.7 0 288 0C354.3 0 408 53.73 408 120zM288 152C310.1 152 328 134.1 328 112C328 89.91 310.1 72 288 72C265.9 72 248 89.91 248 112C248 134.1 265.9 152 288 152zM425.6 179.8C426.1 178.6 426.6 177.4 427.1 176.1L543.1 129.7C558.9 123.4 576 135 576 152V422.8C576 432.6 570 441.4 560.9 445.1L416 503V200.4C419.5 193.5 422.7 186.7 425.6 179.8zM150.4 179.8C153.3 186.7 156.5 193.5 160 200.4V451.8L32.91 502.7C17.15 508.1 0 497.4 0 480.4V209.6C0 199.8 5.975 190.1 15.09 187.3L137.6 138.3C140 152.5 144.9 166.6 150.4 179.8H150.4zM327.8 331.1C341.7 314.6 363.5 286.3 384 255V504.3L192 449.4V255C212.5 286.3 234.3 314.6 248.2 331.1C268.7 357.6 307.3 357.6 327.8 331.1L327.8 331.1z"/></svg>', style: "color: #4BE1C0; opacity:1" }).j().j().m({ className: "gg-izi right", id: "gliz-home", title: "Go to home" }).k({ id: "home-btn", className: "toggle-button-gg pulsar", innerHTML: '<svg style="width:35px;height:35px;padding:7px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"> <g> <d="M0 0h24v24H0z"/> <path fill-rule="nonzero" d="M20 20a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9H1l10.327-9.388a1 1 0 0 1 1.346 0L23 11h-3v9zm-2-1V9.157l-6-5.454-6 5.454V19h12zm-6-2l-3.359-3.359a2.25 2.25 0 1 1 3.182-3.182l.177.177.177-.177a2.25 2.25 0 1 1 3.182 3.182L12 17z"/> </g> </svg>', style: "color: #E95F7D; opacity:1;" }, ((e, t) => { t.addEventListener("click", (function () { const e = f.zb(f.g.fa); e && (window.location.href = `https://wplace.live/?lat=${e.kb}&lng=${e.lb}&zoom=12`) })) })).p(document.body), window.o = function (e) { var t = document.querySelector("#bgz-69"); const n = document.querySelector("#bgz-g"), i = f.H?.[0]; if (n && i?.B) { var a = Object.entries(i.B).sort(((e, t) => (t[1].count || 0) - (e[1].count || 0))); n.innerHTML = "", t.innerHTML = ""; var o = document.createElement("div"); o.id = "dbz-1", o.style.cssText = "font-size: 12px; font-weight: bold; padding: 1px; border-radius: 4px; text-align: center;overflow:hidden;"; var s = e.L > 0 ? Math.round(e.R / e.L * 100) : 0; o.innerHTML = `⟐ <span style="color: #64b5f6">${e.R.toLocaleString()}</span>/<span>${e.L.toLocaleString()}</span> • <span style="color: ${s >= 80 ? "#4caf50" : s >= 50 ? "#ff9800" : "#f44336"}">${s}%</span> ⟐`, t.appendChild(o); for (const [r, l] of a) { const c = l; t = e.O[r] || { required: 0, oa: 0, left: 0 }, (o = document.createElement("div")).style.cssText = "display: flex; align-items: center; gap: 8px; margin: 4px 0; padding: 3px; font-size: 11px;", (s = document.createElement("div")).id = "box-color", s.style.cssText = "width: 14px; height: 14px; border: 1px solid rgba(255,255,255,0.5); border-radius: 2px; flex-shrink: 0; " + (c.enabled ? "" : "opacity: 0.4;"); const d = document.createElement("div"); d.style.cssText = "display: flex; flex-direction: column; gap: 2px; flex-grow: 1; min-width: 0; cursor: pointer;"; const h = document.createElement("span"); h.style.cssText = "font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; " + (c.enabled ? "" : "opacity: 0.6;"); const g = document.createElement("span"); if (g.style.cssText = "font-size: 9px; opacity: 0.8;", "other" === r) s.style.background = "#888", h.textContent = "Other"; else if ("222,250,206" === r) s.style.background = "#deface", h.textContent = "Template Guide"; else { const [e, t, n] = r.split(",").map(Number); s.style.background = `rgb(${e},${t},${n})`; const a = i.ba?.get(r); h.textContent = a ? `${a.h ? "💧" : "✅"}${a.name}` : `rgb(${e},${t},${n})`, d.setAttribute("name", a.name) } g.innerHTML = c.enabled ? `<span style="color: #64b5f6">${t.oa.toLocaleString()}</span>/<span>${t.required.toLocaleString()}</span> • <span style="color: ${t.left > 0 ? "#f44336" : "#4caf50"}">${t.left.toLocaleString()}</span>` : `<span style="opacity: 0.6">0</span>/<span style="opacity: 0.6">${c.count.toLocaleString()}</span> • <span style="opacity: 0.6;color: ${t.left > 0 ? "#f44336" : "#4caf50"};">${t.left.toLocaleString()}</span>`; const u = document.createElement("input"); u.type = "checkbox", u.className = "check", u.checked = c.enabled, u.style.cssText = "flex-shrink: 0;", u.addEventListener("change", (async () => { if (f.g.V) { document.querySelectorAll(".check").forEach((e => { e !== this && (e.checked = !1) })); for (let e in a) a.hasOwnProperty(e) && (a[e][1].enabled = !1); u.checked = !0, c.enabled = u.checked, b.A(`⟐ Enabled color ${r}.`) } else c.enabled = u.checked, b.A(`⟐ ${u.checked ? "Enabled" : "Disabled"} color ${r}.`); f.za() })), d.addEventListener("click", (async () => { var e = document.getElementsByClassName("mb-4 mt-3"); if (e = e[0] ? e[0] : document.getElementById("paleta")) { const t = d.getAttribute("name"); (e = e.querySelector(t ? `[aria-label="${t}"]` : "[aria-label]")) && e.dispatchEvent(f.tb) } f.g.V && (e = new Event("change", { bubbles: !0 }), d.parentNode.querySelector("input").checked = !d.parentNode.querySelector("input").checked, d.parentNode.querySelector("input").dispatchEvent(e)) })), d.appendChild(h), d.appendChild(g), o.appendChild(u), o.appendChild(s), o.appendChild(d), n.appendChild(o) } e = Math.min(50 * Object.keys(a).length + 60, .4 * window.screen.height), f.g.I.U.j = 0 == f.g.I.U.j || f.S ? e : f.g.I.U.j, document.querySelector("#bgz-9-overlay").style.height = `${f.g.I.U.j}px`, f.o(), f.S = !1, f.K && document.querySelector("#bgz-9").classList.add("detached"), f.Da(!0) } else n && (n.innerHTML = "<small>No template colors to display.</small>") }, window.addEventListener("message", (() => { })), setInterval((() => { f.Da(); const e = document.querySelector("#bgz-69"); e && e.childElementCount > 0 && document.querySelector("#home-btn").classList.remove("pulsar") }), 1500), setTimeout((() => { f.Ra() }), 150) }(), b.o(), a.mb(b), new MutationObserver((async e => { var n = document.querySelector("#color-1"), i = document.querySelector("#bgz-t"); n && !i && ((i = document.createElement("button")).id = "bgz-t", i.textContent = "Move ↑", i.className = "btn btn-soft", i.onclick = function () { const e = this.parentNode.parentNode.parentNode.parentNode, t = "Move ↑" == this.textContent; e.parentNode.className = e.parentNode.className.replace(t ? "bottom" : "top", t ? "top" : "bottom"), e.style.borderTopLeftRadius = t ? "0px" : "var(--radius-box)", e.style.borderTopRightRadius = t ? "0px" : "var(--radius-box)", e.style.borderBottomLeftRadius = t ? "var(--radius-box)" : "0px", e.style.borderBottomRightRadius = t ? "var(--radius-box)" : "0px", this.textContent = t ? "Move ↓" : "Move ↑" }, n.parentNode.parentNode.parentNode.parentNode.querySelector("h2").parentNode?.appendChild(i)), n = document.getElementsByClassName("gg-izi"), i = document.getElementById("gg-pin"), n.length > 2 && !i && document.querySelectorAll(".gg-izi:not(.right)").forEach((e => { const t = document.createElement("div"); t.id = "gg-pin", e.appendChild(t) })), n = document.querySelector("#top-bar"), i = document.querySelector("#bgz-69"), n && i && (n.id = "top-bar-dock", n.style.zIndex = "29", n.appendChild(i)); for (let n of e) "childList" === n.type && (n.addedNodes.forEach((e => { if (e.classList && e.classList.contains("maplibregl-marker") && !e.classList.contains("text-yellow-400")) { const s = document.createElement("div"); s.id = "gg-shot", s.style = "position: fixed;"; var n = document.createElement("div"); n.className = "toggle-button-gg", n.style = "overflow:hidden;padding:15px; min-width:80px; min-height: 80px;opacity:1", n.innerHTML = '<svg style="width:35px;height:35px" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.67857 1.75H15.5V4H14.25C13.0074 4 12 5.00736 12 6.25C12 7.49264 13.0074 8.5 14.25 8.5H15.5V9.75C15.5 10.9926 16.5074 12 17.75 12C18.9926 12 20 10.9926 20 9.75V8.5H22.25V19.3214C22.25 20.9388 20.9388 22.25 19.3214 22.25H4.67857C3.06117 22.25 1.75 20.9388 1.75 19.3214V4.67857C1.75 3.06117 3.06117 1.75 4.67857 1.75ZM8.75001 11.002C9.23023 11.002 9.69078 11.1927 10.0303 11.5323L14 15.502L15.9697 13.5323C16.3092 13.1927 16.7698 13.002 17.25 13.002C17.7302 13.002 18.1908 13.1927 18.5303 13.5323L20.2976 15.2996V19.3214C20.2976 19.8606 19.8606 20.2976 19.3214 20.2976H4.67858C4.13945 20.2976 3.70239 19.8606 3.70239 19.3214V15.2996L7.46968 11.5323C7.80925 11.1927 8.26979 11.002 8.75001 11.002Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M17.75 1.75C18.3023 1.75 18.75 2.19772 18.75 2.75V5.25H21.25C21.8023 5.25 22.25 5.69772 22.25 6.25C22.25 6.80228 21.8023 7.25 21.25 7.25H18.75V9.75C18.75 10.3023 18.3023 10.75 17.75 10.75C17.1977 10.75 16.75 10.3023 16.75 9.75V7.25H14.25C13.6977 7.25 13.25 6.80228 13.25 6.25C13.25 5.69772 13.6977 5.25 14.25 5.25H16.75V2.75C16.75 2.19772 17.1977 1.75 17.75 1.75Z" fill="currentColor"/></svg>'; const r = document.createElement("img"); let l; r.style = "position:absolute;z-index:49;border-radius:50%;object-fit:cover;", n.addEventListener("click", (function () { l.click() })), document.querySelector("#bgz-imageInput") ? l = document.querySelector("#bgz-imageInput") : (l = document.createElement("input"), l.id = "bgz-imageInput", l.type = "file", l.accept = "image/*", l.style.display = "none", document.querySelector("#bgz-A")?.appendChild(l), l.addEventListener("change", (function () { const e = l.files[0]; if (e && e.type.startsWith("image/")) { var n = new FileReader; n.onload = function (e) { const n = document.getElementById("gg-shot")?.querySelector("img"); n && (n.src = e.target.result, document.getElementById("gg-shot").querySelector("svg").style.display = "none", document.querySelector("#bgz-paint").style.color = "#00ff74", "GG" == t && (t = null, setTimeout((() => { d.click() }), 500))) }, n.readAsDataURL(e) } }))); const c = document.createElement("button"); c.className = "toggle-button-gg", c.style = "padding:2px;min-width:40px; min-height: 40px; color: #ffffff;opacity:1;position:absolute;right:-50%;bottom:-5%", c.innerHTML = '<svg style="width:40px;height:40px;padding:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.71,6.29a1,1,0,0,0-1.42,0L20,7.59V2a1,1,0,0,0-2,0V7.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3A1,1,0,0,0,22.71,6.29ZM19,13a1,1,0,0,0-1,1v.38L16.52,12.9a2.79,2.79,0,0,0-3.93,0l-.7.7L9.41,11.12a2.85,2.85,0,0,0-3.93,0L4,12.6V7A1,1,0,0,1,5,6h8a1,1,0,0,0,0-2H5A3,3,0,0,0,2,7V19a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V14A1,1,0,0,0,19,13ZM5,20a1,1,0,0,1-1-1V15.43l2.9-2.9a.79.79,0,0,1,1.09,0l3.17,3.17,0,0L15.46,20Zm13-1a.89.89,0,0,1-.18.53L13.31,15l.7-.7a.77.77,0,0,1,1.1,0L18,17.21Z"/></svg>', c.addEventListener("click", (async function () { const e = document.createElement("a"); e.href = r.src, e.download = `WGliz-${Date.now()}.png`, e.click() })); const d = document.createElement("button"); if (d.id = "bgz-paint", d.className = "toggle-button-gg", d.style = "padding:2px;min-width:40px; min-height: 40px; color: rgb(141 217 172 / 68%);opacity:1;position:absolute;right:-50%;bottom:55%", d.innerHTML = '<svg style="width:40px;height:40px;padding:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" fill="currentColor"><path d="M224 263.3C224.2 233.3 238.4 205.2 262.4 187.2L499.1 9.605C517.7-4.353 543.6-2.965 560.7 12.9C577.7 28.76 580.8 54.54 568.2 74.07L406.5 324.1C391.3 347.7 366.6 363.2 339.3 367.1L224 263.3zM320 400C320 461.9 269.9 512 208 512H64C46.33 512 32 497.7 32 480C32 462.3 46.33 448 64 448H68.81C86.44 448 98.4 429.1 96.59 411.6C96.2 407.8 96 403.9 96 400C96 339.6 143.9 290.3 203.7 288.1L319.8 392.5C319.9 394.1 320 397.5 320 400V400z"/></svg>', d.addEventListener("click", (async function () { if (l.files[0]) { const n = l.files[0]?.name.replace(/\.[^/.]+$/, "") || "WGliz_img"; let i = document.querySelector("#bgz-h").textContent; if (i && (i = i.match(/\d+/g).map(Number)), !i || i.length < 4) f.v.A("⟐ Error getting coordinates."); else if (t = !1, !0 === (await f.ca(l.files[0], n, i)).pa) { f.v.A("⟐ Drew to canvas!"), f.g.fa = i, f.o(), f.K || f.ra(), l.classList.remove("dithering"); var e = new FileReader; e.onload = async function (e) { h.C(e.target.result, n, i) }, e.readAsDataURL(l.files[0]) } else (e = new FileReader).onload = async function (e) { const a = new Image; a.onload = async function () { var e = f.ab(a); t = !0; const o = e.toDataURL(); e.toBlob((function (e) { e = new File([e], n + ".png", { type: "image/png" }); const t = new DataTransfer; t.items.add(e), l.files = t.files }), "image/png"), r.src = o, l.classList.add("dithering"), s.appendChild(c), document.querySelector("#bgz-iv").src = o, document.querySelector("#bgz-image-preview").style.display = "flex", (e = await f.ca(e, n, i)) ? f.v.A("⟐ Drew! successfully reduced palette!") : f.v.A("⟐ Something went wrong..."), e.pa && e.ja && (h.C(o, n, i), f.K || f.ra()) }, a.src = e.target.result }, e.readAsDataURL(l.files[0]) } else l.click(), t = "GG" })), l.files[0]) { var i = l.files[0]; const g = new FileReader; g.onload = function (e) { r.src = e.target.result }, g.readAsDataURL(i), d.style.color = "#00ff74", l.classList.contains("dithering") && s.appendChild(c) } n.appendChild(r), s.appendChild(n), s.appendChild(d), document.body.appendChild(s), f.Va(s), f.wb(e, s) } if (e.classList && e.classList.contains("z-50") && document.querySelector("#color-1")) { function a() { var t = Object.entries(f.H[0].B).sort(((e, t) => (t[1].count || 0) - (e[1].count || 0))); for (const [n, i] of t) { const a = f.H[0].ba?.get(n); if (!(t = e.querySelector(`[aria-label="${a.name}"]`))) continue; t.addEventListener("focus", (function () { if (f.C != a.name && !f.g.G.select) { f.Ca(document.getElementById("bgz-96") || null, !0); var e = document.getElementById("bgz-g").querySelector(`[name="${a.name}"]`); e && (e.parentElement.querySelector("input").checked = !0, e.parentElement.querySelector("input")?.dispatchEvent(o), f.C = a.name) } })); const s = (i.ga / i.count * 100).toFixed(1), r = document.createElement("div"); r.id = "bgz-666", r.getAttribute, r.className = "font-bold text-center", r.style = "position:absolute;font-size:11px;", r.innerHTML = `<span style="color: ${s >= 80 ? "lime" : s >= 50 ? "darkorange" : "crimson"}">${s}%</span>`, t.appendChild(r) } } if (f.ya = !0, document.querySelector("#floating-bottons-right").style.display = "none", document.querySelector("#bgz-A").style.display = "none", f.H?.[0]) { var o = new Event("change", { bubbles: !0 }); (n = Object.values(e.querySelectorAll("path")).filter((e => e.getAttribute("d").includes("12.5L705-555l76")))) && n.length > 0 && n[0].addEventListener("click", (function () { document.querySelector("#bgz-3")?.click(), f.C = "" })), n = e.querySelector(`[aria-label="${f.C}"]`), i = document.getElementById("bgz-g").querySelector(`[name="${f.C}"]`), n && i && "" != f.C && !f.g.G.select && (f.Ca(document.getElementById("bgz-96") || null, !0), i.parentElement.querySelector("input").checked = !0, i.parentElement.querySelector("input")?.dispatchEvent(o)), a(), (n = Object.values(e.querySelectorAll("path")).filter((e => ["300-300l58-58", "m356-160-56-56"].some((t => e.getAttribute("d").includes(t)))))) && n.length <= 0 || (n = n[0].parentNode.parentNode).addEventListener("click", (function () { setTimeout((() => { document.querySelectorAll("#bgz-666").forEach((e => { e.remove() })), a() }), 500) })) } } })), n.removedNodes.forEach((e => { e.classList && e.classList.contains("maplibregl-marker") && document.querySelectorAll("#gg-shot").forEach((e => { e?.remove() })), e.classList && e.classList.contains("z-50") && e.querySelector("#color-1") && (document.querySelector("#bgz-3")?.click(), document.querySelector("#floating-bottons-right").style.display = "grid", document.querySelector("#bgz-A").style.display = "", f.ya = !1) }))); const a = document.querySelector("#bgz-bg-controls"); e = document.querySelector("#menu-wrapper-bg"), a && e && (a.id = "zbg-controls", a.style = "", a.style.display = "none", a.className = "menu-bar", e.appendChild(a), document.addEventListener("mousedown", (function (e) { !a.contains(e.target) && e.target !== a && a.classList.contains("active") && (a.classList.remove("active"), setTimeout((() => { a.style.display = "none" }), 250)) })), document.addEventListener("touchstart", (function (e) { !a.contains(e.target) && e.target !== a && a.classList.contains("active") && (a.classList.remove("active"), setTimeout((() => { a.style.display = "none" }), 250)) }))); const o = document.querySelector("#bgz-error-highlight"); e = document.querySelector("#menu-wrapper-wb"), o && e && (o.id = "z-error-highlight", o.style = "", o.style.display = "none", o.className = "menu-bar", e.appendChild(o), document.addEventListener("mousedown", (function (e) { !o.contains(e.target) && e.target !== o && o.classList.contains("active") && (o.classList.remove("active"), setTimeout((() => { o.style.display = "none" }), 250)) })), document.addEventListener("touchstart", (function (e) { !o.contains(e.target) && e.target !== o && o.classList.contains("active") && (o.classList.remove("active"), setTimeout((() => { o.style.display = "none" }), 250)) }))) })).observe(document.body, { childList: !0, subtree: !0 }), (0, console.log)(`%c${GM_info.script.name.toString()}%c (${GM_info.script.version.toString()}) userscript has loaded!`, "color: cornflowerblue;", "") })();

